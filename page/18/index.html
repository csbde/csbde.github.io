<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="这里是外宅，备份用的">
<meta property="og:type" content="website">
<meta property="og:title" content="九王爷">
<meta property="og:url" content="http://yoursite.com/page/18/index.html">
<meta property="og:site_name" content="九王爷">
<meta property="og:description" content="这里是外宅，备份用的">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="九王爷">
<meta name="twitter:description" content="这里是外宅，备份用的">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/18/"/>





  <title> 九王爷 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">九王爷</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">九王爷的府邸</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/20/自己使用的VIM配置文件和插件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/20/自己使用的VIM配置文件和插件/" itemprop="url">
                  自己使用的VIM配置文件和插件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-20T18:04:45+08:00">
                2008-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>见附件<a href="http://www.9wy.net/wp-content/uploads/2008/03/vim.zip" title="vim.zip" target="_blank" rel="external">vim.zip</a></p>
<p><a href="http://insenvim.sourceforge.net/" target="_blank" rel="external">http://insenvim.sourceforge.net/</a></p>
<p>只是这个目前只能在windows下面用，试过的，好用<br>支持Java<br>C++<br>C#<br>JSP<br>XML<br>HTML<br>SQL</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/20/本站插件-wp-CJK-excerpt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/20/本站插件-wp-CJK-excerpt/" itemprop="url">
                  本站插件-wp-CJK-excerpt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-20T15:56:56+08:00">
                2008-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="http://yskin.net/2006/07/mulberrykit.html" target="_blank" rel="external">转自:Yskin’s blog</a><br>我刚接触Wordpress的时候——大约在今年3月份或者更早吧——除了Wordpress自带的插件，最先装的插件应该就是桑葚的中文WordPress工具箱中文WordPress工具箱了。(一个小发现，我用紫光V5打出来的是“桑椹”，而他的网站上写出来的是“桑葚”，在金山词霸查了一下，好像紫光打出来的是正确的，桑椹——英文mulberry…汗了)</p>
<p>这个插件提供了很多功能，都是一些国人喜欢的功能——最新文章，最新评论，评论数最多的文章，发表评论最多的网友，随机文章以及适合中文环境的摘要功能。这些功能我感觉并不实用，虽然国内的大多BSP都提供这些功能。最新文章功能Wordpress自带，最新评论功能倒还有点用，随机文章功能对于专门讨论某个方面的Blog还行，而我一直的观点是一个Blog对应一个人，个人的所有文章应该发在同一个Blog上，文章的分类应该靠Blog系统的分类功能解决，而非建立多个Blog。我的研究方向比较多，所以我的Blog分类很广，这样的情况下，一个设计的比较好的相关文章功能可能比随机文章好的多。</p>
<p>最近一直困扰于百度的收录问题。我的策略是：存档页、分类页、tag页、搜索页都不应该被搜索引擎收录，因为搜索引擎会进行重复页面检测。(桑葚的网站好像没有做这方面的设置，经常在Google里搜到他的tag页)对于Google，可以在所有要禁止收录的页面设置meta标签robots为”noindex,follow”，这样Google就会只访问这些页面而不收录，既禁止了收录，又可以让Google顺着这些页面查找独立文章页面。不过，同样的办法对百度就行不通，因为百度不支持meta标签robots，所以只好用 robots.txt文件。分类页和tag页分别在category和tag目录下，只要禁止这两个目录就可以了，而存档页却是类似”<a href="http://yskin.net/2006/07/&quot;这样的结构，禁了这些目录，下面的独立文章页面也会被一起禁掉，百度又只支持" target="_blank" rel="external">http://yskin.net/2006/07/&quot;这样的结构，禁了这些目录，下面的独立文章页面也会被一起禁掉，百度又只支持</a> Disallow，不支持Allow。</p>
<p>解决的办法嘛，狠一点的话就在存档页中检测来访的是不是百度，如果是就直接输出个404。我想的权宜之计是：由于存档页显示的是文章的摘要，想办法让摘要更短一些，这样可能就检测不出来重复了。我弟弟的Blog用了中文WordPress工具箱，他那儿显示的摘要就很短，所以跑去下了这个插件，研究一下Wordpress的摘要算法。</p>
<p>研究的结果是这样：在中文WordPress工具箱的说明里有提到：</p>
<p>某些情况下需要输出摘要，比如搜索结果、档案，还有 rss 输出，这样可以节省流量资源。但是，如果你的文章是中文的话，官方 WordPress 输出的其实并不是摘要，它只是把文章里的 html 代码过滤掉了，但所有文字都还是原样输出了。</p>
<p>激活这个插件后，输出的就是真正截断的摘要了。</p>
<p>(顺便提一下，rss输出还是不要用摘要方式的好，人家订阅了你的rss不是为了看个摘要的，节约流量可以用feedburner烧录一下嘛。当然，由于网站放置了广告而希望用户访问页面的除外，够狠的话也可以把广告加到rss里)</p>
<p>桑葚的这段话是有错误地。Wordpress输出摘要时，先将文章里的html代码过滤掉了，然后对文章进行了摘要并输出，并没有因为你写的是中文就不摘要了。不过，摘要算法只考虑了英文以及其他西方语言，因为这些语言用空格做单词的分隔符，所以就用空格做区分，截取前55个单词。但是这个算法对中文日文这些不用空格分隔单词的语言就不合适了，中文文章里很难找到一个空格，摘要算法要找够55个空格才截断，所以最终只会输出整篇文章。</p>
<p>Wordpress通过the_excerpt()函数输出摘要(rss里通过the_excerpt_rss()函数输出摘要)，这个函数中只有一行代码：echo apply_filters(‘the_excerpt’, get_the_excerpt());就是说对get_the_excerpt()函数返回的字符串执行转换器操作并输出。the_excerpt有转换字符、转换表情、加</p>
<p>标签等几个默认转换器。get_the_excerpt()函数中检验了一下文章是否有密码，然后将用户自定的文章摘要传给 wp_trim_excerpt()函数。wp_trim_excerpt()函数收到用户自定的文章摘要则直接返回，否则根据文章内容生成摘要。他先把文章过一遍文章内容的转换器，再用strip_tags()函数去掉所有html和PHP标签，再用explode()函数以一个空格做分隔符，把文章分成最多56段。如果不够56段则原样输出，否则就把最后一段替换成”[…]”，用implode()函数以空格做分隔符重新组装起来。很明显，这个方法对英文文章很有效，而对不用空格做单词间分隔符的中文则没什么作用。很少有中文文章包含55个空格，所以给大家以中文文章摘要无效的印象。(好像代码里没有对
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/03/20/本站插件-wp-CJK-excerpt/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/19/几款Firefox扩展/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/19/几款Firefox扩展/" itemprop="url">
                  几款Firefox扩展
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-19T21:41:46+08:00">
                2008-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p><a href="http://adblockplus.org/en/" target="_blank" rel="external">Adblock plus</a><br>可以过滤网页广告，是 Adblock 的增强版。增加了白名单和过滤规则同步功能。</p>
</li>
<li><h4 id="Download-Statusbar"><a href="#Download-Statusbar" class="headerlink" title="Download Statusbar"></a><span style="text-decoration: line-through;"><a href="http://downloadstatusbar.mozdev.org/" target="_blank" rel="external">Download Statusbar</a></span></h4><p><span style="color: #ff0000;">实际使用除了好看没有什么意义,所以删除掉了</span><br><span style="text-decoration: line-through;">在浏览器底部显示一个状态栏，可以方便地查看和管理下载项。</span></p>
</li>
</ul>
<p><span style="text-decoration: line-through;">主要功能：</span></p>
<p><span style="text-decoration: line-through;">* 没有下载时自动隐藏</span></p>
<p><span style="text-decoration: line-through;">* 单击暂停/恢复</span></p>
<p><span style="text-decoration: line-through;">* 通过操作扩展的上下文菜单暂停、恢复、取消全部下载和移除完成的下载项</span></p>
<p><span style="text-decoration: line-through;">* 双击完成对话框可以运行一个下载完的文件。</span></p>
<p><span style="text-decoration: line-through;">* 更新的工具提示能提供当前下载的比较详细的内容，包括源、目的、大小和剩余时间</span></p>
<p><span style="text-decoration: line-through;">* 能在选项中定制查看完成百分比、下载速度、完成量和剩余时间</span></p>
<p><span style="text-decoration: line-through;">* 从上下文菜单复制源 URL</span></p>
<p><span style="text-decoration: line-through;">* 可以停止下载并保存，下次浏览器启动时重新下载</span></p>
<p><span style="text-decoration: line-through;">* 通过系统的上下文菜单删除一个文件</span></p>
<p><span style="text-decoration: line-through;">* 定制和查看保留最后 N 条下载项</span></p>
<p><span style="text-decoration: line-through;">* 在选项中设置当一个下载完成时启动病毒扫描</span></p>
<p><span style="text-decoration: line-through;">* 在选项中设置当浏览器关闭时继续在下载管理器中下载 </span></p>
<ul>
<li><h2 id="IE-Tab"><a href="#IE-Tab" class="headerlink" title="IE Tab"></a><strong><small><a href="https://addons.mozilla.org/zh-CN/firefox/addon/1419/" target="_blank" rel="external"><small>IE Tab</small></a></small></strong></h2><p>让您可以直接在 Firefox 的标签页中以内嵌的 IE 引擎浏览网页。</p>
</li>
<li><p><a href="http://chrispederick.com/work/user-agent-switcher/" target="_blank" rel="external">User Agent Switcher</a><br>增加一个菜单项和一个工具栏按钮来转换浏览器的用户标识。通过改变浏览器标识，你可以访问一些禁止非 IE 浏览器访问的网址。它是为<br>Firefox、Flock 以及 Mozilla 设计的，而且可以在 Windows、Mac OS X 及 Linux 等任意平台上运行。特别是和IE TAB配合，可以说任何地方都不需要再开IE了</p>
</li>
<li><p><a href="http://chrispederick.com/work/web-developer/" target="_blank" rel="external">Web Develope</a><br><span style="color: #ff0000;"><br></span></p>
</li>
</ul>
<p>在菜单和工具栏加上多种网页开发工具。</p>
<ul>
<li><span style="text-decoration: line-through;"><big><big><a href="https://addons.mozilla.org/en-US/firefox/addon/1730" target="_blank" rel="external"><strong><small><small>ScribeFire</small></small></strong></a></big></big></span><br><span style="color: #ff0000;">使用了Emacs,写日志也不用这个写了,所以删除掉了</span></li>
</ul>
<p><span style="text-decoration: line-through;">Scribefire（以前叫做 Performancing for Firefox）是一个嵌入在 Firefox 浏览器中的全功能博客编辑器，他可以方便您提交博客。您可以从当前正在浏览的页面中拖放格式化文字到编辑器中，象提交博客那样方便地保存草稿…</span></p>
<p><span style="text-decoration: line-through;">适用于:</span></p>
<p><span style="text-decoration: line-through;"><br></span></p>
<table border="0" summary="Compatible applications and their versions."><br><tbody><br><tr><br><td></td><br><td><span style="text-decoration: line-through;">Firefox</span></td><br><td><span style="text-decoration: line-through;">2.0 - 3.0b4</span></td><br><td><span style="text-decoration: line-through;"><img src="http://addons.mozine.cn/images/icons/all_icon_16.png" alt="ALL" title="ALL"></span></td><br></tr><br><tr><br><td></td><br><td></td><br><td><span style="text-decoration: line-through;">1.0 - 1.1.*</span></td><br><td><span style="text-decoration: line-through;"><img src="http://addons.mozine.cn/images/icons/all_icon_16.png" alt="ALL" title="ALL"></span></td><br></tr><br></tbody></table>

<ul>
<li><a href="http://addons.mozine.cn/firefox/116/" target="_blank" rel="external"><span style="text-decoration: line-through;">MediaWrap<br></span></a><br><span style="color: #ff6600;">实际使用的机会很少,所以一般都处于禁用状态</span></li>
</ul>
<p><small>mediawrap 是一个很小的 Firefox 扩展。它能够将 ActiveX 控件方式的网页内嵌媒体转换成 Firefox 能够支持的<br>Plugin 方式，从而使 Firefox 也能够象 IE 一样正常播放 Wmplayer、Rmplayer、QtPlayer 和<br>FlashPlayer 格式的媒体文件。当然，你的系统中首先要安装过相应的播放软件及解码器，比如，Windows Media Player 和<br>RealPlayer 等。</small></p>
<p><small>很多网站使用了 ActiveX 控件方式来播放网页内嵌媒体，但是Firefox 浏览器本身并不支持 ActiveX<br>控件。如果你经常在这样的网站观看视频或者听音乐，那么 mediawrap 扩展绝对是有用的。而且，mediawrap 不会给你带来任何安全问题。</small></p>
<p><small>0.1.7.0 版：</small></p>
<p><small>1、兼容 Firefox 3.0b4；</small></p>
<p><small>2、修复了一些 bug；</small></p>
<p><small>3、支持语言：en-US，es-ES，de-DE，fr-FR，it-IT，pt-BR , nl-NL ,zh-CN，zh-TW。</small></p>
<ul>
<li><h2 id="FireFTP"><a href="#FireFTP" class="headerlink" title="FireFTP"></a><span style="text-decoration: line-through;"><small><small><a href="http://fireftp.mozdev.org/" target="_blank" rel="external"><strong>FireFTP</strong></a></small></small></span></h2><span style="color: #ff0000;">兼容性不是很好,功能也不是很强,所以卸载掉了,使用MzillaFTP作为FTP工具</span></li>
</ul>
<p>FireFTP 是一个基于 Mozilla Firefox 的免费, 安全, 跨平台 FTP 客户端。</p>
<ul>
<li><strong><a href="http://addons.mozine.cn/firefox/7/" target="_blank" rel="external">FlashGot</a> </strong></li>
</ul>
<p>允许 Firefox、Mozilla Suite、Netscape 和 Thunderbird 使用大多数流行的外部下载管理器处理单一的和全部(“全部” 和 “选择”)下载，支持 Windows, Mac OS X, Linux 和 FreeBSD 系统。</p>
<ul>
<li><strong><a href="http://addons.mozine.cn/firefox/19/" target="_blank" rel="external"><span style="text-decoration: line-through;">All-In-One Sidebar 0.7.4</span></a></strong><br><strong><a href="http://addons.mozine.cn/firefox/19/" target="_blank" rel="external">（后来删除了，感觉用处不大）</a></strong></li>
</ul>
<p>AIOS(All-In-One Sidebar)<br>使您在侧边栏中就可以快速切换书签、下载项和扩展等面板，或者在侧边栏登陆网站、查看源代码；另外，AIOS<br>还拥有侧栏切换柄和工具栏，单击浏览器一侧的突起边缘，即可打开/关闭 AIOS。所有这些都允许用户自由定制。AIOS 支持众多扩展，<br>包括Translation Panel, ScrapBook, Sage, Enhanced History Manager,<br>Advanced Search Sidebar, QuickNote 等等。</p>
<p>注意! 在安装 AIOS 新版本前一定要先卸载 0.5.5 以前的版本! 否则将损坏配置文件! 请千万小心，不要在旧版上自动更新升级。如果忘记卸载而导致配置文件损坏，您在作者主页上可以找到补救方法。</p>
<p>补救方法: <a href="http://firefox.exxile.net/aios/knownissues.php#destroyedprofile" target="_blank" rel="external">http://firefox.exxile.net/aios/knownissues.php#destroyedprofile</a></p>
<ul>
<li><a href="http://dafizilla.sourceforge.net/viewsourcewith/" target="_blank" rel="external"><strong>ViewSourceWith(我主要用来设置用VIM查看和编辑源码)</strong></a><br><small>主要的目的是使用外部程序浏览页面原代码，但是你还可以⋯⋯</small></li>
</ul>
<p><small>- 以 DOM 文件的方式打开页面原代码，参见 faq</small></p>
<ul>
<li>打开页面使用的 CSS 和 JS 文件</li>
<li>用你指定的图像浏览软件（比如 GIMP 或者 ACDSee）打开图像</li>
<li>用 Acrobat Reader 或 Foxit Reader 或者你指定的程序打开 PDF 链接</li>
<li>用你喜欢的文本编辑器编辑 textbox 中的内容，并且在将焦点切换回 textbox 的时候你可以在浏览器中立刻看见修改后的文字，简化了 wiki 页面的编辑，参见 faq</li>
<li>打开服务器端生成浏览器内容的页面，简化了 web 开发者的 debug 工作，参见 server-faq</li>
<li>打开 Javascript 控制台中列出</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/16/linux用户的权限管理详细说明/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/16/linux用户的权限管理详细说明/" itemprop="url">
                  linux用户的权限管理详细说明
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-16T11:39:21+08:00">
                2008-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>只能有一个ROOT帐号。&nbsp;想要普通用户有权限，以ROOT帐号登陆，然后输入chmod&nbsp;o&nbsp;+rw&nbsp;[fileName]。建议你用man&nbsp;chmod看看chmod的详细说明。&nbsp;&nbsp;</p>
<p><strong>修改权限</strong>：&nbsp;&nbsp;<br>1）管理用户（user）的工具或命令；&nbsp;&nbsp;<br>useradd&nbsp;注：添加用户&nbsp;&nbsp;<br>adduser&nbsp;注：添加用户&nbsp;&nbsp;<br>passwd&nbsp;注：为用户设置密码&nbsp;&nbsp;<br>usermod&nbsp;注：修改用户命令，可以通过usermod&nbsp;来修改登录名、用户的家目录等等；&nbsp;&nbsp;<br>pwcov&nbsp;注：同步用户从/etc/passwd&nbsp;到/etc/shadow&nbsp;&nbsp;<br>pwck&nbsp;注：pwck是校验用户配置文件/etc/passwd&nbsp;和/etc/shadow&nbsp;文件内容是否合法或完整；&nbsp;&nbsp;<br>pwunconv&nbsp;注：是pwcov&nbsp;的立逆向操作，是从/etc/shadow和&nbsp;/etc/passwd&nbsp;创建/etc/passwd&nbsp;，然后会删除&nbsp;/etc/shadow&nbsp;文件；&nbsp;&nbsp;<br>finger&nbsp;注：查看用户信息工具&nbsp;&nbsp;<br>id&nbsp;注：查看用户的UID、GID及所归属的用户组&nbsp;&nbsp;<br>chfn&nbsp;注：更改用户信息工具&nbsp;&nbsp;<br>su&nbsp;注：用户切换工具&nbsp;&nbsp;<br>sudo&nbsp; 注：sudo&nbsp;是通过另一个用户来执行命令（execute&nbsp;a&nbsp;command&nbsp;as&nbsp;another&nbsp;user），su&nbsp;是用来切换用户，然后通过切 换到的用户来完成相应的任务，但sudo&nbsp;能后面直接执行命令，比如sudo&nbsp;不需要root&nbsp;密码就可以执行root&nbsp;赋与的执行只有root才能执行 相应的命令；但得通过visudo&nbsp;来编辑/etc/sudoers来实现；&nbsp;&nbsp;<br>visudo&nbsp;注：visodo&nbsp;是编辑&nbsp;/etc/sudoers&nbsp;的命令；也可以不用这个命令，直接用vi&nbsp;来编辑&nbsp;/etc/sudoers&nbsp;的效果是一样的；&nbsp;&nbsp;<br>sudoedit&nbsp;注：和sudo&nbsp;功能差不多。&nbsp;&nbsp;</p>
<p>2）管理用户组（group）的工具或命令；&nbsp;&nbsp;<br>groupadd&nbsp;注：添加用户组；&nbsp;&nbsp;<br>groupdel&nbsp;注：删除用户组；&nbsp;&nbsp;<br>groupmod&nbsp;注：修改用户组信息&nbsp;&nbsp;<br>groups&nbsp;注：显示用户所属的用户组&nbsp;&nbsp;<br>grpck&nbsp;&nbsp;<br>grpconv&nbsp;注：通过/etc/group和/etc/gshadow&nbsp;的文件内容来同步或创建/etc/gshadow&nbsp;，如果/etc/gshadow&nbsp;不存在则创建；&nbsp;&nbsp;<br>grpunconv&nbsp;注：通过/etc/group&nbsp;和/etc/gshadow&nbsp;文件内容来同步或创建/etc/group&nbsp;，然后删除gshadow文件。&nbsp;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/14/proftpd+mysql用户认证+quota磁盘限额/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/14/proftpd+mysql用户认证+quota磁盘限额/" itemprop="url">
                  proftpd+mysql用户认证+quota磁盘限额
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-14T10:44:56+08:00">
                2008-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <font id="zoom" class="f14">proftpd+mysql用户认证+quota磁盘限额  </font><font id="zoom" class="f14">整理编辑：mars (mars_diy@21cn.com) </font><font id="zoom" class="f14">网上关于proftpd的安装文章实在是不少，我只是稍微整理了一下，并且使用了新的 quota磁盘限额模块 </font><font id="zoom" class="f14">由于proftpd最新版1.2.8目前还是RC版，加上有些设置不能通用， 所以在这里还是使用1.2.7版<br><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/03/14/proftpd+mysql用户认证+quota磁盘限额/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/14/proftpd_+_mysql_安装参考资料/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/14/proftpd_+_mysql_安装参考资料/" itemprop="url">
                  proftpd + mysql 安装参考资料
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-14T10:29:51+08:00">
                2008-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="proftpd-mysql-安装流水笔记"><a href="#proftpd-mysql-安装流水笔记" class="headerlink" title="proftpd + mysql 安装流水笔记"></a>proftpd + mysql 安装流水笔记</h2><pre><code>&lt;div id=&quot;postmessage_626939&quot; class=&quot;t_msgfont&quot;&gt;一。准备工做
</code></pre><p>1。你的机器上已调试好了apache+php+mysql环境<br>2。下载PROFTPD<br> wget <a href="ftp://ftp.proftpd.org/distrib/source/proftpd-1.2.10rc3.tar.bz2" target="_blank" rel="external">ftp://ftp.proftpd.org/distrib/source/proftpd-1.2.10rc3.tar.bz2</a><br>因为发现1.2.10直接支持sql和quota<br>二。安装<br>tar -jxvf proftpd-1.2.10rc3.tar.bz2<br>cd proftpd*<div class="quote">&gt; ./configure –prefix=/usr/local/proftpd \</div></p>
<blockquote>
<p>–with-modules=mod_sql:mod_sql_mysql:mod_quotatab:mod_quotatab_sql \<br>–with-includes=/usr/local/mysql/include/mysql \<br>–with-libraries=/usr/local/mysql/lib/mysql<br>make<br>make install<br>修改proftpd配置<br>vim /usr/local/proftpd/etc/proftpd.conf<br>内容改为：<br>ServerName “mail2004.3322.org”<br>ServerType standalone<br>DefaultServer on</p>
<h1 id="用户登陆时不显示ftp服务器版本信息"><a href="#用户登陆时不显示ftp服务器版本信息" class="headerlink" title="用户登陆时不显示ftp服务器版本信息"></a>用户登陆时不显示ftp服务器版本信息</h1><p> ServerIdent off</p>
<h1 id="Port-21-is-the-standard-FTP-port"><a href="#Port-21-is-the-standard-FTP-port" class="headerlink" title="Port 21 is the standard FTP port."></a>Port 21 is the standard FTP port.</h1><p> Port 21</p>
<h1 id="Umask-022-is-a-good-standard-umask-to-prevent-new-dirs-and-files"><a href="#Umask-022-is-a-good-standard-umask-to-prevent-new-dirs-and-files" class="headerlink" title="Umask 022 is a good standard umask to prevent new dirs and files"></a>Umask 022 is a good standard umask to prevent new dirs and files</h1><h1 id="from-being-group-and-world-writable"><a href="#from-being-group-and-world-writable" class="headerlink" title="from being group and world writable."></a>from being group and world writable.</h1><p> Umask 022<br>MaxLoginAttempts 3<br> TimeoutLogin 120<br> TimeoutIdle 600<br> TimeoutNoTransfer 900<br> TimeoutStalled 3600<br> MaxClients 100</p>
<h1 id="设置每台主机最多并发连接数"><a href="#设置每台主机最多并发连接数" class="headerlink" title="设置每台主机最多并发连接数"></a>设置每台主机最多并发连接数</h1><p> MaxClientsPerHost 3<br> AllowOverwrite no<br> AllowStoreRestart on<br> UseReverseDNS off</p>
<h1 id="设置如果shell为空时允许用户登录"><a href="#设置如果shell为空时允许用户登录" class="headerlink" title="设置如果shell为空时允许用户登录"></a>设置如果shell为空时允许用户登录</h1><p> RequireValidShell off</p>
<h1 id="将用户限制在自己的主目录下"><a href="#将用户限制在自己的主目录下" class="headerlink" title="将用户限制在自己的主目录下"></a>将用户限制在自己的主目录下</h1><p> DefaultRoot ~</p>
<h1 id="To-prevent-DoS-attacks-set-the-maximum-number-of-child-processes"><a href="#To-prevent-DoS-attacks-set-the-maximum-number-of-child-processes" class="headerlink" title="To prevent DoS attacks, set the maximum number of child processes"></a>To prevent DoS attacks, set the maximum number of child processes</h1><h1 id="to-30-If-you-need-to-allow-more-than-30-concurrent-connections"><a href="#to-30-If-you-need-to-allow-more-than-30-concurrent-connections" class="headerlink" title="to 30. If you need to allow more than 30 concurrent connections"></a>to 30. If you need to allow more than 30 concurrent connections</h1><h1 id="at-once-simply-increase-this-value-Note-that-this-ONLY-works"><a href="#at-once-simply-increase-this-value-Note-that-this-ONLY-works" class="headerlink" title="at once, simply increase this value. Note that this ONLY works"></a>at once, simply increase this value. Note that this ONLY works</h1><h1 id="in-standalone-mode-in-inetd-mode-you-should-use-an-inetd-server"><a href="#in-standalone-mode-in-inetd-mode-you-should-use-an-inetd-server" class="headerlink" title="in standalone mode, in inetd mode you should use an inetd server"></a>in standalone mode, in inetd mode you should use an inetd server</h1><h1 id="that-allows-you-to-limit-maximum-number-of-processes-per-service"><a href="#that-allows-you-to-limit-maximum-number-of-processes-per-service" class="headerlink" title="that allows you to limit maximum number of processes per service"></a>that allows you to limit maximum number of processes per service</h1><h1 id="such-as-xinetd"><a href="#such-as-xinetd" class="headerlink" title="(such as xinetd)."></a>(such as xinetd).</h1><p> MaxInstances 30</p>
<h1 id="Set-the-user-and-group-under-which-the-server-will-run"><a href="#Set-the-user-and-group-under-which-the-server-will-run" class="headerlink" title="Set the user and group under which the server will run."></a>Set the user and group under which the server will run.</h1><p> User nobody<br> Group nobody</p>
<h1 id="Normally-we-want-files-to-be-overwriteable"><a href="#Normally-we-want-files-to-be-overwriteable" class="headerlink" title="Normally, we want files to be overwriteable."></a>Normally, we want files to be overwriteable.</h1><p> &lt;Directory /&gt;<br> AllowOverwrite on<br> &lt;/Directory&gt;</p>
<h1 id="A-basic-anonymous-configuration-no-upload-directories"><a href="#A-basic-anonymous-configuration-no-upload-directories" class="headerlink" title="A basic anonymous configuration, no upload directories."></a>A basic anonymous configuration, no upload directories.</h1><h1 id="匿名登录设置。匿名用户目录为-ftp"><a href="#匿名登录设置。匿名用户目录为-ftp" class="headerlink" title="匿名登录设置。匿名用户目录为/ftp"></a>匿名登录设置。匿名用户目录为/ftp</h1><p> &lt;Anonymous /ftp&gt;<br> User ftp<br> Group ftp</p>
<h1 id="We-want-clients-to-be-able-to-login-with-“anonymous”-as-well-as-“ftp”"><a href="#We-want-clients-to-be-able-to-login-with-“anonymous”-as-well-as-“ftp”" class="headerlink" title="We want clients to be able to login with “anonymous” as well as “ftp”"></a>We want clients to be able to login with “anonymous” as well as “ftp”</h1><h1 id="UserAlias-anonymous-ftp-nbsp-nbsp-停了它"><a href="#UserAlias-anonymous-ftp-nbsp-nbsp-停了它" class="headerlink" title="UserAlias anonymous ftp&nbsp; &nbsp; 停了它"></a>UserAlias anonymous ftp&nbsp; &nbsp; 停了它</h1><h1 id="Limit-the-maximum-number-of-anonymous-logins"><a href="#Limit-the-maximum-number-of-anonymous-logins" class="headerlink" title="Limit the maximum number of anonymous logins"></a>Limit the maximum number of anonymous logins</h1><p> MaxClients 10</p>
<h1 id="We-want-‘welcome-msg’-displayed-at-login-and-‘-message’-displayed"><a href="#We-want-‘welcome-msg’-displayed-at-login-and-‘-message’-displayed" class="headerlink" title="We want ‘welcome.msg’ displayed at login, and ‘.message’ displayed"></a>We want ‘welcome.msg’ displayed at login, and ‘.message’ displayed</h1><h1 id="in-each-newly-chdired-directory"><a href="#in-each-newly-chdired-directory" class="headerlink" title="in each newly chdired directory."></a>in each newly chdired directory.</h1><p> DisplayLogin welcome.msg<br> DisplayFirstChdir .message</p>
<h1 id="Limit-WRITE-everywhere-in-the-anonymous-chroot"><a href="#Limit-WRITE-everywhere-in-the-anonymous-chroot" class="headerlink" title="Limit WRITE everywhere in the anonymous chroot"></a>Limit WRITE everywhere in the anonymous chroot</h1><p> #&lt;Limit WRITE&gt;</p>
<h1 id="DenyAll"><a href="#DenyAll" class="headerlink" title="DenyAll"></a>DenyAll</h1><p> #&lt;/Limit&gt;<br>&lt;/Anonymous&gt;<br>以上是PROFTPD.conf</p>
<p>下面加入sql和quota</p>
<h1 id="数据库联接的信息，proftpdb是数据库名，localhost是主机名，proftpd是连接数据库的用户名，"><a href="#数据库联接的信息，proftpdb是数据库名，localhost是主机名，proftpd是连接数据库的用户名，" class="headerlink" title="数据库联接的信息，proftpdb是数据库名，localhost是主机名，proftpd是连接数据库的用户名，"></a>数据库联接的信息，proftpdb是数据库名，localhost是主机名，proftpd是连接数据库的用户名，</h1><p>#proftpdb是密码</p>
<p>#（如果没有密码留空）<br>SQLConnectInfo proftpdb@localhost proftp proftpdb&nbsp;&nbsp;</p>
<h1 id="数据库认证的类型"><a href="#数据库认证的类型" class="headerlink" title="数据库认证的类型"></a>数据库认证的类型</h1><p>SQLAuthTypes Backend Plaintext</p>
<h1 id="数据库的鉴别"><a href="#数据库的鉴别" class="headerlink" title="数据库的鉴别"></a>数据库的鉴别</h1><p>SQLAuthenticate users<em> groups</em></p>
<h1 id="指定用来做用户认证的表的有关信息。"><a href="#指定用来做用户认证的表的有关信息。" class="headerlink" title="指定用来做用户认证的表的有关信息。"></a>指定用来做用户认证的表的有关信息。</h1><p>SQLUserInfo ftpuser userid passwd uid gid homedir shell<br>SQLGroupInfo ftpgroup groupname gid members</p>
<h1 id="如果home目录不存在，则系统会根据它的home项新建一个目录"><a href="#如果home目录不存在，则系统会根据它的home项新建一个目录" class="headerlink" title="如果home目录不存在，则系统会根据它的home项新建一个目录"></a>如果home目录不存在，则系统会根据它的home项新建一个目录</h1><p> SQLHomedirOnDemand on<br>这是目录所有者，我觉得这个很重要。所以我用nobody来做，在此我的nobody为99.<br>SQLDefaultGID&nbsp; &nbsp; &nbsp; &nbsp; 99<br>SQLDefaultUID&nbsp; &nbsp; &nbsp; &nbsp; 99</p>
<p>SQLLog PASS updatecount<br>SQLNamedQuery updatecount UPDATE “count=count+1,accessed=now() WHERE userid=’%u’” ftpuser</p>
<h1 id="Update-modified-everytime-user-uploads-or-deletes-a-file"><a href="#Update-modified-everytime-user-uploads-or-deletes-a-file" class="headerlink" title="Update modified everytime user uploads or deletes a file"></a>Update modified everytime user uploads or deletes a file</h1><p>SQLLog STOR,DELE modified<br>SQLNamedQuery modified UPDATE “modified=now() WHERE userid=’%u’” ftpuser</p>
<h1 id="启用磁盘限额"><a href="#启用磁盘限额" class="headerlink" title="启用磁盘限额"></a>启用磁盘限额</h1><p> QuotaDirectoryTally on</p>
<h1 id="磁盘限额单位-b”-”Kb”-”Mb”-”Gb”"><a href="#磁盘限额单位-b”-”Kb”-”Mb”-”Gb”" class="headerlink" title="磁盘限额单位 b”|”Kb”|”Mb”|”Gb”"></a>磁盘限额单位 b”|”Kb”|”Mb”|”Gb”</h1><p>QuotaDisplayUnits “Kb”<br>QuotaEngine on</p>
<h1 id="磁盘限额日志记录"><a href="#磁盘限额日志记录" class="headerlink" title="磁盘限额日志记录"></a>磁盘限额日志记录</h1><p> QuotaLog “/var/log/quota.log”</p>
<h1 id="打开磁盘限额信息，当登陆FTP帐户后，使用命令-“quote-SITE-QUOTA”-后可显示当前用-户的磁盘限额"><a href="#打开磁盘限额信息，当登陆FTP帐户后，使用命令-“quote-SITE-QUOTA”-后可显示当前用-户的磁盘限额" class="headerlink" title="打开磁盘限额信息，当登陆FTP帐户后，使用命令 “quote SITE QUOTA” 后可显示当前用#户的磁盘限额"></a>打开磁盘限额信息，当登陆FTP帐户后，使用命令 “quote SITE QUOTA” 后可显示当前用#户的磁盘限额</h1><p>QuotaShowQuotas on<br>以下为sql语句：<br>SQLNamedQuery get-quota-limit SELECT “name, quota_type, per_session, limit_type, bytes_in_avail,bytes_out_ava<br>il, bytes_xfer_avail, files_in_avail, files_out_avail, files_xfer_avail FROM ftpquotalimits WHERE name = ‘%{0<br>}’AND quota_type = ‘%{1}’”</p>
<p>SQLNamedQuery get-quota-tally SELECT “name, quota_type, bytes_in_used, bytes_out_used, bytes_xfer_used, files<br>_in_used, files_out_used, files_xfer_used FROM ftpquotatallies WHERE name = ‘%{0}’ AND quota_type = ‘%{1}’”<br>SQLNamedQuery update-quota-tally UPDATE “bytes_in_used = bytes_in_used + %{0}, bytes_out_used = bytes_out_used + %{1}, bytes_xfer_used = bytes_xfer_used + %{2}, files_in_used = files_in_used + %{3}, files_out_used = files_out_used + %{4}, files_xfer_used = files_xfer_used + %{5} WHERE name = ‘%{6}’ AND quota_type = ‘%{7}’” ftpquotatallies</p>
<p>SQLNamedQuery insert-quota-tally INSERT “%{0}, %{1}, %{2}, %{3}, %{4}, %{5}, %{6}, %{7}” ftpquotatallies</p>
<p>QuotaLimitTable sql:/get-quota-limit<br>QuotaTallyTable sql:/get-quota-tally/update-quota-tally/insert-quota-tally</p>
<p>下面可以用phpmyadmin在mysql里加入，我的sql为以下<br>CREATE TABLE <code>ftpgroup</code> (<br> <code>groupname</code> varchar(16) NOT NULL default ‘’,<br> <code>gid</code> smallint(6) NOT NULL default ‘99’,<br> <code>members</code> varchar(16) NOT NULL default ‘’,<br> KEY <code>groupname</code> (<code>groupname</code>)<br> ) TYPE=MyISAM COMMENT=’ProFTP group table’;</p>
<p>INSERT INTO <code>ftpgroup</code> VALUES (‘nobody’, 99, ‘nobody’);</p>
<p>CREATE TABLE <code>ftpquotalimits</code> (<br> <code>name</code> varchar(30) default NULL,<br> <code>quota_type</code> enum(‘user’,’group’,’class’,’all’) NOT NULL default ‘user’,<br> <code>per_session</code> enum(‘false’,’true’) NOT NULL default ‘false’,<br> <code>limit_type</code> enum(‘soft’,’hard’) NOT NULL default ‘soft’,<br> <code>bytes_in_avail</code> float NOT NULL default ‘0’,<br> <code>bytes_out_avail</code> float NOT NULL default ‘0’,<br> <code>bytes_xfer_avail</code> float NOT NULL default ‘0’,<br> <code>files_in_avail</code> int(10) unsigned NOT NULL default ‘0’,<br> <code>files_out_avail</code> int(10) unsigned NOT NULL default ‘0’,<br> <code>files_xfer_avail</code> int(10) unsigned NOT NULL default ‘0’<br> ) TYPE=MyISAM;</p>
<p>CREATE TABLE <code>ftpquotatallies</code> (<br> <code>name</code> varchar(30) NOT NULL default ‘’,<br> <code>quota_type</code> enum(‘user’,’group’,’class’,’all’) NOT NULL default ‘user’,<br> <code>bytes_in_used</code> float NOT NULL default ‘0’,<br> <code>bytes_out_used</code> float NOT NULL default ‘0’,<br> <code>bytes_xfer_used</code> float NOT NULL default ‘0’,<br> <code>files_in_used</code> int(10) unsigned NOT NULL default ‘0’,<br> <code>files_out_used</code> int(10) unsigned NOT NULL default ‘0’,<br> <code>files_xfer_used</code> int(10) unsigned NOT NULL default ‘0’<br> ) TYPE=MyISAM;</p>
<p>CREATE TABLE <code>ftpuser</code> (<br> <code>id</code> int(10) unsigned NOT NULL auto_increment,<br> <code>userid</code> varchar(32) NOT NULL default ‘’,<br> <code>passwd</code> varchar(32) NOT NULL default ‘’,<br> <code>uid</code> smallint(6) NOT NULL default ‘99’,<br> <code>gid</code> smallint(6) NOT NULL default ‘99’,<br> <code>homedir</code> varchar(255) NOT NULL default ‘’,<br> <code>shell</code> varchar(16) NOT NULL default ‘/sbin/nologin’,<br> <code>count</code> int(11) NOT NULL default ‘0’,<br> <code>accessed</code> datetime NOT NULL default ‘0000-00-00 00:00:00’,<br> <code>modified</code> datetime NOT NULL default ‘0000-00-00 00:00:00’,<br> PRIMARY KEY (<code>id</code>)<br> ) TYPE=MyISAM COMMENT=’ProFTP user table’ ；启动proftpd<br>/usr/local/proftpd/sbin/proftpd start<br>在数据数中的ftpuser中加入用户，密码他路径就可以了。<br>以上只是一个流水笔记   <div class="flockcredit" style="text-align: right; color: #CCC; font-size: x-small;">Blogged with the <a href="http://www.flock.com/blogged-with-flock" title="Flock Browser" target="_blank" rel="external">Flock Browser</a></div></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/13/bitdefenderV10最新注册码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/13/bitdefenderV10最新注册码/" itemprop="url">
                  bitdefenderV10最新注册码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-13T11:53:33+08:00">
                2008-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最新BitDefender Antivirus Plus v10注册码用到2010.01.14<br> 注册码：6C672565540A021DDDAA<br>注册码：5401DEF806AF0B8A5B11<br>注册码：19E4243E56FFCADCC83C<br>注册码：A2AF1ED8ADAFAAAB94D8<br>注册码：366A693F50A77BD98D17</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/12/将FireFox伪装成MSIE的方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/12/将FireFox伪装成MSIE的方法/" itemprop="url">
                  将FireFox伪装成MSIE的方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-12T09:19:53+08:00">
                2008-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span class="postbody">在firefox地址栏输入about:config<br>在filter(过滤)栏中输入general.useragent.extra.firefox<br>双击value项中的firefox字样，弹出修改value的对话框<br>将其值改为Mozilla/4.0 (compatible; MSIE 6.0) </span></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/10/在_Linux_上进行自动备份/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/10/在_Linux_上进行自动备份/" itemprop="url">
                  在 Linux 上进行自动备份
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-10T11:54:54+08:00">
                2008-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>级别： 初级</p>
<p>Carlos Justiniano (Carlos.Justiniano@ecuityinc.com), 软件设计师, Ecuity Inc.</p>
<p>2004 年 8 月 08 日</p>
<p>重要数据的丢失可能意味着致命的破坏。尽管如此，还是有无数专业人员忽视了对他们的数据的备份。虽然原因可能各不相同，但是，最常见的一个解释是，执行例行备份确实烦琐。由于机器擅长于完成普通而重复的任务，因此，自动化备份的过程是降低工作内在的枯燥性和人们与生俱来的拖延倾向的关键所在。<br>如果您使用 Linux，那么您就已经可以使用那些创建定制备份解决方案的极其强大的工具。本文中的方案，可以让您使用几乎每个 Linux 发行版本都附带的开放源代码工具来执行从简单的到更高级而且安全的网络备份。</p>
<p>简单备份</p>
<p>本文按照一步一步的方法来进行讲述，只要您遵循那些基本的步骤，此方法会是非常直观的。</p>
<p>在研究更高级的分布式备份解决方案之前，让我们首先来看一个简单而强大的存档机制。让我们来分析一个名为 arc 的方便的脚本，它可以让我们在 Linux shell 提示符中创建备份快照。</p>
<p>清单 1. arc shell 脚本</p>
<p>   #!/bin/sh<br>   tar czvf $1.$(date +%Y%m%d%-H%M%S).tgz $1<br>   exit $?</p>
<p>arc 脚本接收一个单独的文件或目录名作为参数，创建一个压缩的存档文件，同时将当前日期嵌入到生成的存档文件的名字之中。例如，如果您有一个名为 beoserver 的目录，您可以调用 arc 脚本，将 beoserver 目录名传递给它以创建一个压缩的存档文件，如： beoserver.20040321-014844.tgz</p>
<p>使用 date 命令是为了嵌入一个日期和时间戳以帮助您组织存档文件。日期的格式是年、月、日、小时、分、秒 —— 虽然秒域的使用有一些多余。查看 data 命令的手册（ man date ）来了解其他选项。另外，在清单 1 中，我们向 tar 传递了 -v （verbose）选项。这就使得 tar 显示出它正在存档的文件。如果您喜欢静默地进行备份，那么删除这个 -v 选项。</p>
<p>清单 2. 存档 beoserver 目录<br>   $ ls<br>   arc  beoserver<br>   $ ./arc beoserver<br>   beoserver/<br>   beoserver/bookl.dat<br>   beoserver/beoserver_ab_off<br>   beoserver/beoserver_ab_on<br>   $ ls<br>   arc  beoserver  beoserver.20040321-014844.tgz</p>
<p>高级备份</p>
<p>这个简单备份是实用的；不过，它仍然包含一个人工备份的过程。行业最佳经验通常建议将数据备份到多个媒体上，并备份到分开的不同地理位置。中心思想是避免依赖于任何一个单独的存储媒体或单独的位置。</p>
<p>在下一个例子中我们将应对这一挑战，我们将分析一个如图 1 所示的假想的分布式网络，它展示了对两台远程服务器和一台离线存储服务器的系统管理。</p>
<p>图 1. 分布式网络</p>
<p>服务器 #1 和 #2 上的备份文件将安全地传输到离线存储服务器上，而且整个分布式备份过程将在没有人工干涉的情况下定期进行。我们将使用一组标准的工具（开放安全 shell 工具套件（OpenSSH）的一部分），以及磁带存档器（tar）和 cron 任务调度服务。我们的全部计划是，使用 cron 进行调度，使用 shell 程序和 tar 应用程序完成备份过程，使用 OpenSSH 安全 shell（ssh）加密进行远程访问、认证、安全 shell 拷贝（scp）以自动完成文件传输。要获得另外的资料请务必查看每个工具的手册。</p>
<p>使用公钥/私钥进行安全的远程访问</p>
<p>在数字安全的上下文中，密钥（key）指的是用来加密或解密其他数据片断的一个数据片断。公钥私钥模式的有趣之处在于，使用公钥加密的数据，只有用相应的私钥才可以解密。您可以自由地发布一个公钥，这样别人就可以对发送给您的消息进行加密。公钥/私钥模式彻底改变了数字安全的原因之一是，发送者和接收者不必再共享一个通用的密码。除了其他方面的贡献，公钥/私钥加密使用电子商务和其他安全传输成为可能。在本文中，我们将创建并使用公钥和私钥来创建一个非常安全的分布式备份解决方案。</p>
<p>要进行备份过程的每台机器都必须运行 OpenSSH 安全 shell 服务（sshd），同时让 22 端口可以通过任何内部防火墙被访问。如果您访问远程的服务器，那么很有可能您正在使用安全 shell。</p>
<p>我们的目标将是，不需要人工提供密码就可以安全地访问机器。一些人认为最简单的办法是设置无密码的访问：不要这样做。这样做不安全。不用那样，本文中我们将使用的方法可能会占用您大约一个小时的时间，建立起一个与使用“无密码”帐号同样方便的系统 —— 不过它是公认非常安全的。</p>
<p>让我们首先确保 OpenSSH 已经安装，接下来查看它的版本号。完成本文时，最新的发行的 OpenSSH 是 2004 年 2 月 24 日发布的版本 3.8。您应该考虑使用一个较新的而且稳定的发布版本，至少所用的版本应该要比版本 2.x 新。访问 OpenSSH Security 网页以获得关于特定旧版本的缺陷的细节（请参阅本文后面的 参考资料 中的链接）。到目前为止，OpenSSH 是非常稳定的，而且已经证明不存在其他 SSH 工具所报告的很多缺陷。</p>
<p>在 shell 提示符中，输入 ssh 并给出重要的 V 选项来检查版本号：</p>
<p>$ ssh -V<br>OpenSSH_3.5p1, SSH protocols 1.5/2.0, OpenSSL 0x0090701f</p>
<p>如果 ssh 返回的版本号大于 2.x，则机器处于相对良好的状态。无论如何，建议您所有的软件都使用最新的稳定版本，这对于安全相关的软件来说尤其重要。</p>
<p>我们的第一个步骤是，使用将会有特权访问服务器 1 和 2 的帐号登录到离线存储服务器机器（见图 1）。</p>
<p>$ ssh accountname@somedomain.com</p>
<p>登录到离线存储服务器以后，使用 ssh-keygen 程序并给出 -t dsa 选项来创建一个公钥/密钥对。 -t 选项是必须的，用来指定我们要生成的密钥类型。我们将使用数字签名算法（Digital Signature Algorithm，DSA），它让我们可以使用更新的 SSH2 协议。参阅 ssh-keygen 手册以获得更多细节。</p>
<p>在 ssh-keygen 执行的过程中，在询问您口令（passphrase）之前，将提示您输入 ssh 密钥存储的位置。当询问在何处存储密钥时只需要按下回车键，然后 ssh-keygen 程序将创建一个名为 .ssh 的隐藏目录（如果原来不存在），以及两个文件，一个公钥文件和一个私钥文件。</p>
<p>ssh-keygen 的一个有趣特性是，当提示输入一个口令时，它让您可以只是简单地按下回车键。如果您没有给出口令，那么 ssh-keygen 将生成没有加密的密钥!如您所想，这不是个好主意。当要求输入口令时，确保输入一个足够长的字符消息，最好包含混合字符而不仅仅是一个简单的密码字符串。</p>
<p>清单 3. 永远选择好的口令<br>   [offsite]:$ ssh-keygen -t dsa<br>   Generating public/private dsa key pair.<br>   Enter file in which to save the key (/home/accountname/.ssh/id_dsa):<br>   Enter passphrase (empty for no passphrase): (enter passphrase)<br>   Enter same passphrase again: (enter passphrase)<br>   Your identification has been saved in /home/accountname/.ssh/id_dsa.<br>   Your public key has been saved in /home/accountname/.ssh/id_dsa.pub.<br>   The key fingerprint is:<br>   7e:5e:b2:f2:d4:54:58:6a:fa:6b:52:9c:da:a8:53:1b accountname@offsite</p>
<p>由于 ssh-keygen 生成的 .ssh 目录是一个隐藏的“dot”目录，所以要给 ls 命令传入一个 -a 选项来查看新创建的目录：</p>
<p>[offsite]$ ls -a<br>. .. .bash_logout .bash_profile .bashrc .emacs .gtkrc .ssh</p>
<p>进入隐藏的 .ssh 目录并列出其内容：</p>
<p>[offsite]$ cd .ssh<br>[offsite]$ ls -lrt<br>id_dsa id_dsa.pub</p>
<p>现在，在隐藏的 .ssh 目录中，我们已经拥有了一个私钥（id_dsa）和一个公钥（id_dsa.pub）。您可以使用 vi 或 emacs 等文本编辑工具或者简单地使用 less 或 cat 命令来分析每个密钥文件的内容。您将看到由混合字符构成的内容已经经过了 base64 编码。</p>
<p>然后，我们需要将公钥拷贝并安装到服务器 1 和 2 上。不要使用 ftp。更合理的是，使用安全拷贝程序来将公钥传送到每一台远程机器上。</p>
<p>清单 4. 将公钥安装到远程服务器上<br>   [offsite]$ scp .ssh/id_dsa.pub accountname@server1.com:offsite.pub<br>   accountname@server1.com’s password: (enter password, not new<br>   passphrase!)<br>   id_dsa.pub 100% |<strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong>| 614 00:00<br>   [offsite]$ scp .ssh/id_dsa.pub accountname@server2.com:offsite.pub<br>   accountname@server2.com’s password: (enter password, not new<br>   passphrase!)<br>   id_dsa.pub 100% |<strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong>| 614 00:00</p>
<p>在安装完新的公钥后，我们就可以使用创建私钥和公钥时指定的口令来登录到每一台机器。现在，登录到每台机器，并将 offsite.pub 文件的内容附加到一个名为 authorized_keys 的文件中，这个文件存储在每台远程机器的 .ssh 目录下。我们可以使用一个文本编辑器或者简单地使用 cat 命令来将 offsite.pub 文件的内容附加到 authorized_keys 文件：</p>
<p>清单 5. 将 offsite.pub 添加到已授权密钥列表<br>   [offsite]$ ssh accountname@server1.com<br>   accountname@server1.com’s password: (enter password, not new<br>   passphrase!)<br>   [server1]$ cat offsite.pub &gt;&gt; ./ssh/authorized_keys</p>
<p>接下来的步骤是考虑一些额外的安全性。首先，我们修改 .ssh 的访问权限，以使得只有所有者有读、写和执行的权限。然后，我们确保 authorized_keys 文件只能由所有者来访问。最后，将先前上传的 offsite.pub 密钥文件删除，因为再也不需要它了。确保设置适当的访问权限很重要，因为 OpenSSH 服务器可能会拒绝使用具有不安全访问权限的密钥。</p>
<p>清单 6. 使用 chmod 修改权限<br>   [server1]$ chmod 700 .ssh<br>   [server1]$ chmod 600 ./ssh/authorized_keys<br>   [server1]$ rm offsite.pub<br>   [server1]$ exit</p>
<p>在服务器 2 上完成同样的步骤后，我们就可以返回到离线存储机器上来测试新的口令类型的访问。在离线服务器上您可以输入下面的内容：</p>
<p>[offsite]$ ssh -v accountname@server1.com</p>
<p>在检验您的帐号现在可以使用新的口令而不是原来的密码来访问远程的服务器时，使用 -v 或 verbose 标记选项来显示调试信息。调试输出除了能让您在一个高的层面上观察到认证过程是如何工作的之外，还可以显示出您可以以其他方式无法得到的重要信息。在以后的连接中您可能并不需要指定 -v 标记；但是在测试连接时它相当有用。</p>
<p>使用 ssh-agent 自动化机器访问</p>
<p>ssh-agent 程序如同一个看门人，它根据需要安全地提供对安全密钥的访问。ssh-agent 启动后，它就会在后台运行，并且可以由 ssh 和 scp 程序等其他 OpenSSH 应用程序所使用。这就使得 ssh 程序可以请求一个已经解密了的密钥，而不是在每次需要时向您询问私钥的安全口令。</p>
<p>让我们来仔细研究一下 ssh -agent。ssh-agent 运行时它会输出 shell 命令：</p>
<p>清单 7. ssh-agent 应用<br>   [offsite]$ ssh-agent<br>   SSH_AUTH_SOCK=/tmp/ssh-XX1O24LS/agent.14179; export SSH_AUTH_SOCK;<br>   SSH_AGENT_PID=14180; export SSH_AGENT_PID;<br>   echo Agent pid 14180;</p>
<p>我们可以使用 shell 的 eval 命令来让 shell 执行 ssh-agent 显示的输出命令：</p>
<p>[offsite]$ eval <code>ssh-agent</code><br>Agent pid 14198</p>
<p>eval 命令告诉 shell 去评价（执行）ssh-agent 程序生成的命令。确保您指定的是反引号（<code>）而不是单引号！执行后， eval</code>ssh-agent` 语句将返回代理的进程标识符。在幕后， SSH_AUTH_SOCK 和 SSH_AGENT_PID shell 变量已经被导出而可以使用。您可以将它们显示在 shell 控制台中来查看它们的值：</p>
<p>[offsite]$ echo $SSH_AUTH_SOCK<br>/tmp/ssh-XX7bhIwq/agent.14197</p>
<p>$SSH_AUTH_SOCK （SSH Authentication Socket 的缩写）是一个本地套接字的位置，应用程序可以通过它来与 ssh-agent 通信。将 eval <code>ssh-agent</code> 语句加入到您的 ~/.bash_profile 文件以确保 SSH_AUTH_SOCK 和 SSH_AGENT_PID 始终被注册。</p>
<p>ssh-agent 现在就已经成为一个后台进程，可以用 top 和 ps 命令查看得到。</p>
<p>现在我们就已经可以使用 ssh-agent 共享我们的口令。为此，我们必须使用一个名为 ssh-add 的程序，这个程序将我们的口令添加（发送）到运行着的 ssh-agent 程序。</p>
<p>清单 8. 用于免口令登录的 ssh-add<br>   [offsite]$ ssh-add<br>   Enter passphrase for /home/accountname/.ssh/id_dsa: (enter passphrase)<br>   Identity added: /home/accountname/.ssh/id_dsa<br>   (/home/accountname/.ssh/id_dsa)</p>
<p>现在，当我们访问 server1 时，不会再被提示输入口令：</p>
<p>[offsite]$ ssh accountname@server1.com<br>[server1]$ exit</p>
<p>如果您还不相信，那么尝试去掉（ kill -9 ）ssh-agent 进程，然后重新连接 server1。这一次，您将注意到，server1 将会询问存储在 .ssh 目录下 id_dsa 中的私钥的口令：</p>
<p>[offsite]$ kill -9 $SSH_AGENT_PID<br>[offsite]$ ssh accountname@server1.com<br>Enter passphrase for key ‘/home/accountname/.ssh/id_dsa’:</p>
<p>使用 keychain 简化密钥访问</p>
<p>到现在为止，我们已经了解了几个 OpenSSH 程序（ssh、scp、ssh-agent 和 ssh-add），而且我们已经创建并安装了私钥和公钥来启用一个安全而且自动的登录过程。您可能已经意识到，大部分设置工作只需要进行一次。例如，创建密钥、安装密钥、通过 .bash_profile 执行 ssh-agent 的过程在每台机器只需要进行一次。那真是好消息。</p>
<p>不太理想的消息是，我们每次登录到离线的机器上时，都必须调用 ssh-add，而且，ssh-agent 与我们将要用来自动化备份工作的 cron 调度进程并不直接兼容。cron 进程不能与 ssh-agent 通信的原因是，cron 作业是作为 cron 的子进程来执行，这样它们就不会继承 $SSH_AUTH_SOCK shell 变量。</p>
<p>幸运的是，有一个解决方案不但可以消除 ssh-agent 和 ssh-add 的局限，而且可以让我们使用 cron 来自动进行各种需要对其他机器进行安全地无密码访问的过程。在他 2001 年发表的三篇 developerWorks 系列文章中，即 OpenSSH key management（参阅 参考资料 以获得链接），Daniel Robbins 介绍了一个名为 keychain 的 shell 脚本，它是 ssh-add 和 ssh-agent 的一个前端，简化了整个无密码的过程。随着时间的过去，keychain 脚本已经经历了很多改进，现在由 Aron Griffis 维护，其最新的 2.3.2-1 发布版本公布于 2004 年 6 月 17 日。</p>
<p>keychain shell 脚本太长以致于无法在本文中列出，因为精心编写的脚本中包括了很多错误检测、丰富的文档以及非常多的跨平台代码。不过，keychain 可以自项目的 Web 站点上方便地下载得到（参阅 参考资料以获得链接）。</p>
<p>下载并安装了 keychain 后，使用它就很简单了。只需要登录到每台机器并将下面两行添加到每个 .bash_profile 文件：</p>
<p>keychain id_dsa<br>. ~/.keychain/$HOSTNAME-sh</p>
<p>在您第一次重新登录到每台机器时，keychain 将向您询问口令。不过，除非机器被重新启动，否则，以后再登录时，keychain 将不会再要求您重新输入口令。最好的是，cron 任务现在可以使用 OpenSSH 命令来安全地访问远程的机器，而不需要交互地使用口令。更好的安全和更容易的使用，现在我们已经兼得。</p>
<p>清单 9. 在每台机器上初始化<br>   KeyChain 2.3.2; <a href="http://www.gentoo.org/projects/keychain" target="_blank" rel="external">http://www.gentoo.org/projects/keychain</a><br>   Copyright 2002-2004 Gentoo Technologies, Inc.; Distributed under the<br>   GPL</p>
<ul>
<li>Initializing /home/accountname/.keychain/localhost.localdomain-sh<br>file…</li>
<li>Initializing /home/accountname/.keychain/localhost.localdomain-csh<br>file…</li>
<li>Starting ssh-agent</li>
<li>Adding 1 key(s)…<br>Enter passphrase for /home/accountname/.ssh/id_dsa: (enter passphrase)</li>
</ul>
<p>脚本化备份过程</p>
<p>我们的下一个任务是创建执行必要的备份过程的 shell 脚本。目标是执行服务器 1 和 2 的完全数据库备份。在我们的例子中，每个服务器都运行着 MySQL 数据库服务器，我们使用 mysqldump 命令行工具来将一些数据库表导出到一个 SQL 输入文件中。</p>
<p>清单 10. 服务器 1 的 dbbackup.sh shell 脚本</p>
<p>   #!/bin/sh</p>
<h1 id="change-into-the-backup-agent-directory-where-data-files-are-stored"><a href="#change-into-the-backup-agent-directory-where-data-files-are-stored" class="headerlink" title="change into the backup_agent directory where data files are stored."></a>change into the backup_agent directory where data files are stored.</h1><p>   cd /home/backup_agent</p>
<h1 id="use-mysqldump-utility-to-export-the-sites-database-tables"><a href="#use-mysqldump-utility-to-export-the-sites-database-tables" class="headerlink" title="use mysqldump utility to export the sites database tables"></a>use mysqldump utility to export the sites database tables</h1><p>   mysqldump -u sitedb -pG0oDP@sswrd –add-drop-table sitedb –tables<br>   tbl_ccode tbl_machine tbl_session tbl_stats &gt; userdb.sql</p>
<h1 id="compress-and-archive"><a href="#compress-and-archive" class="headerlink" title="compress and archive"></a>compress and archive</h1><p>   tar czf userdb.tgz userdb.sql</p>
<p>在服务器 2 上，我们将设置一个类似的脚本来备份站点数据库中给出的独有表单。每个脚本都通过下面的步骤标记为可执行的：</p>
<p>[server1]:$ chmod +x dbbackup.sh</p>
<p>在服务器 1 和 2 上设置了 dbbackup.sh 后，我们返回到离线的数据服务器，在那里我们将创建一个 shell 脚本来调用各个远程 dbbackup.sh 脚本并随后传输压缩的（.tgz）数据文件。</p>
<p>清单 11. 用在离线的数据服务器上的 backup_remote_servers.sh shell 脚本</p>
<p>   #!/bin/sh</p>
<h1 id="use-ssh-to-remotely-execute-the-dbbackup-sh-script-on-server-1"><a href="#use-ssh-to-remotely-execute-the-dbbackup-sh-script-on-server-1" class="headerlink" title="use ssh to remotely execute the dbbackup.sh script on server 1"></a>use ssh to remotely execute the dbbackup.sh script on server 1</h1><p>   /usr/bin/ssh backup_agent@server1.com “/home/backup_agent/dbbackup.sh”</p>
<h1 id="use-scp-to-securely-copy-the-newly-archived-userdb-tgz-file"><a href="#use-scp-to-securely-copy-the-newly-archived-userdb-tgz-file" class="headerlink" title="use scp to securely copy the newly archived userdb.tgz file"></a>use scp to securely copy the newly archived userdb.tgz file</h1><h1 id="from-server-1-Note-the-use-of-the-date-command-to-timestamp"><a href="#from-server-1-Note-the-use-of-the-date-command-to-timestamp" class="headerlink" title="from server 1.  Note the use of the date command to timestamp"></a>from server 1.  Note the use of the date command to timestamp</h1><h1 id="the-file-on-the-offsite-data-server"><a href="#the-file-on-the-offsite-data-server" class="headerlink" title="the file on the offsite data server."></a>the file on the offsite data server.</h1><p>   /usr/bin/scp backup_agent@server1.com:/home/backup_agent/userdb.tgz<br>   /home/backups/userdb-$(date +%Y%m%d-%H%M%S).tgz</p>
<h1 id="execute-dbbackup-sh-on-server-2"><a href="#execute-dbbackup-sh-on-server-2" class="headerlink" title="execute dbbackup.sh on server 2"></a>execute dbbackup.sh on server 2</h1><p>   /usr/bin/ssh backup_agent@server2.com “/home/backup_agent/dbbackup.sh”</p>
<h1 id="use-scp-to-transfer-transdb-tgz-to-offsite-server"><a href="#use-scp-to-transfer-transdb-tgz-to-offsite-server" class="headerlink" title="use scp to transfer transdb.tgz to offsite server."></a>use scp to transfer transdb.tgz to offsite server.</h1><p>   /usr/bin/scp backup_agent@server2.com:/home/backup_agent/transdb.tgz<br>   /home/backups/transdb-$(date +%Y%m%d-%H%M%S).tgz</p>
<p>backup_remote_servers.sh shell 脚本使用 ssh 命令来执行远程服务器上的脚本。由于我们已经设置的无密码的访问，ssh 命令可以通过离线的服务器在服务器 1 和 2 上远程地执行命令。感谢 keychain，整个认证过程现在可以自动完成。</p>
<p>调度</p>
<p>我们的下一个步骤，也是最后一个步骤，是调度 backup_remote_servers.sh shell 脚本在离线的数据存储服务器上的执行。我们将向 cron 调度服务器中添加两个条目，以要求每天执行备份脚本两次，3:34 执行一次，8:34 再执行一次。在离线的服务器上使用 edit（ -e ）选项调用 crontab 程序。</p>
<p>[offsite]:$ crontab -e</p>
<p>crontab 调用 VISUAL 或 EDITOR shell 环境变量所指定的默认的编辑器。然后，输入两个条目并保存和关闭文件。</p>
<p>清单 12. 离线的服务器上的 Crontab 条目<br>   34 3 <em> </em> <em> /home/backups/remote_db_backup.sh<br>   34 20 </em> <em> </em> /home/backups/remote_db_backup.sh</p>
<p>一个 crontab 行包括两个主要部分，时间表部分和后面的命令部分。时间表分为多个域，用来指定一个命令应该何时执行：</p>
<p>清单 13. Crontab 格式<br>          +—- minute<br>          | +—– hour<br>          | | +—— day of the month<br>          | | | +—— month<br>          | | | | +—- day of the week<br>          | | | | | +– command to execute<br>          | | | | | |<br>         34 3 <em> </em> * /home/backups/remote_db_backup.sh</p>
<p>检验您的备份</p>
<p>您应该对备份进行例行地检查，以确保程序正确进行。自动程序可以使烦琐的工作得到避免，但是永远不能因此而懒惰。如果您的数据值得备份，那么它也值得您时常进行抽样检查。</p>
<p>考虑添加一个 cron 作业来提醒您自己至少每个月对备份进行一次检查。另外，经常修改安全密钥也是一个好主意，同样您也可以调度一个 cron 作业来提醒您做这件事。</p>
<p>另外的安全防范</p>
<p>要获得更高的安全性，可以考虑在每台机器上安装并配置一个入侵检测系统（ntrusion Detection System，IDS），比如 Snort。可以预见，当入侵正在发生或者近期发生过时，IDS 将会通知您。IDS 到位后，您将可以添加其他层次上的安全，比如对您的备份进行数字签名和加密。</p>
<p>GNU Privacy Guard（GnuPG）、OpenSSL 和 ncrypt 等流行的开放源代码工具可以支持通过 shell 脚本对存档文件进行加密，不过不建议在没有 IDS 提供的额外层次保护的情况下这样做（参阅 参考资料 以获得关于 Snort 的更多信息）。</p>
<p>结束语</p>
<p>本文向您展示了如何让您的脚本在远程服务器执行以及如何执行安全自动的文件传输。我希望您能由此得到灵感而开始考虑保护您自己的重要数据，并使用 OpenSSH 和 Snort 等开放源代码工具来构建新的解决方案。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/03/09/数据库的自动备份与数据库被破坏后的恢复（_mysqlhotcopy_）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/03/09/数据库的自动备份与数据库被破坏后的恢复（_mysqlhotcopy_）/" itemprop="url">
                  数据库的自动备份与数据库被破坏后的恢复（ mysqlhotcopy ）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-03-09T16:58:13+08:00">
                2008-03-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当数据库服务器建立好以后，我们首先要做的不是考虑要在这个支持数据库的服务器运行哪些受MySQL提携的程序，而是当数据库遭到破坏后，怎样安然恢复到最后一次正常的状态，使得数据的损失达到最小。</p>
<p>　　或者说，仅仅是数据库服务器的建立，只能说明它能做些什么，并不代表它能稳定的做些什么。灾难恢复的效率及全面性，也是系统的稳定性的一个准因素，尤其对于一个服务器系统。</p>
<p>　　这一节，介绍数据库自动备份以及数据库被破坏后的恢复的方法。在这里，我们使用mysqlhotcopy，并且定义一段Shell脚本来实现数据库的自动备份，并且，让整个数据自动备份与数据恢复过程都基于Shell</p>
<p><table border="0" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#4665a6"></td></p>
<p><table border="0"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#333333" class="table-title">建立数据库备份所需条件</td><br><br><br><br><br><br>[1] 建立自动备份脚本</p>
<p>　　在这里，为了使数据库备份和恢复的符合我们的实际要求，用一段符合要求的Shell脚本来实现整个备份过程的自动化。<a name="entrymore"></a></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"><span style="color: #6600cc"><span class="message">[root@sample ~]#</span> <span class="command">vi mysql-backup.sh</span>　 <span class="intro">← 建立数据库自动备份脚本，如下：</span></span></td></p>
<p></p>
<p><span style="color: #6600cc">#!/bin/bash</span></p>
<p><span style="color: #6600cc">PATH=/usr/local/sbin:/usr/bin:/bin</span></p>
<p><span style="color: #6600cc"># The Directory of Backup<br>BACKDIR=/backup/mysql</span></p>
<p></p><p class="conffile"><span style="color: #6600cc"># The Password of MySQL<br>ROOTPASS=<span class="att1"><strong><em>**</em></strong></span>　 <span class="intro">← 将星号替换成MySQL的root密码</span></span></p>
<p></p><p class="conffile"><span style="color: #6600cc"># Remake the Directory of Backup<br>rm -rf $BACKDIR<br>mkdir -p $BACKDIR</span></p>
<p></p><p class="conffile"><span style="color: #6600cc"># Get the Name of Database<br>DBLIST=<code>ls -p /var/lib/mysql | grep / | tr -d /</code></span></p>
<p><span class="message"><span style="color: #6600cc"># Backup with Database<br>for dbname in $DBLIST<br>do<br>mysqlhotcopy $dbname -u root -p $ROOTPASS $BACKDIR | logger -t mysqlhotcopy<br>done</span></span><br><br><br><span style="color: #6600cc">[2] 运行数据库自动备份脚本</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000" class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">chmod 700 mysql-backup.sh</span>　 <span class="intro">← 改变脚本属性，让其只能让root用户执行</span></span></td></p>
<p>[root@sample ~]# <span class="command">./mysql-backup.sh</span> 　 <span class="intro">← 运行脚本</span></p>
<p>[root@sample ~]# <span class="command">ls -l /backup/mysql/</span> 　 <span class="intro">← 确认一下是否备份成功</span></p>
<p>total 8<br>drwxr-x— 2 mysql mysql 4096 Sep 1 16:54 <span class="att1">mysql</span> 　 <span class="intro">← 已成功备份到/backup/mysql目录中</span><br><br><br><span style="color: #6600cc">[3] 让数据库备份脚本每天自动运行</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"><span style="color: #6600cc"><span class="message">[root@sample ~]#</span> <span class="command">crontab -e</span>　 </span><span style="color: #6600cc"><span class="intro">← 编辑自动运行规则（然后会出现编辑窗口，操作同vi）<br></span><br><span class="after">00 03 <em> </em> * /root/mysql-backup.sh</span> 　 <span class="intro">← 添加这一行到文件中，让数据库备份每天凌晨3点进行</span></span></td><br><br></p>
<p><table border="0" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#4665a6"></td></p>
<p><table border="0"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#333333" class="table-title"><span style="color: #6600cc">测试自动备份正常运转与否（备份恢复的方法）</span></td><br><br><br><br><br><br><span style="color: #6600cc">　　这里，以通过实际操作的过程来介绍问题出现后的恢复方法。</span></p>
<p>[1] 当数据库被删除后的恢复方法</p>
<p>　　首先建立一个测试用的数据库。</p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"><span style="color: #6600cc"><span class="message">[root@sample ~]#</span> <span class="command">mysql -u root -p</span> 　 <span class="intro">← 用root登录到MySQL服务器</span><br><span class="message">Enter password:</span>　 <span class="intro">← 输入MySQL的root用户密码</span><br></span><span class="message"><br><span style="color: #6600cc">Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 8 to server version: 4.1.20 </span></span></td></p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p><span style="color: #6600cc">mysql&gt; <span class="command">create database test;</span>　 <span class="intro">← 建立一个测试用的数据库test</span><br>Query OK, 1 row affected (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到这个数据库 </span><br>Database changed</span></p>
<p>mysql&gt; <span class="command">create table test(num int, name varchar(50));</span>　 <span class="intro">← 在数据库中建立一个表</span><br>Query OK, 0 rows affected (0.07 sec)</p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">insert into test values(1,’Hello,BSD’);</span>　 <span class="intro">← 插入一个值到这个表（这里以“Hello,BSD”为例）</span><br>Query OK, 1 row affected (0.02 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">select * from test;</span>　 <span class="intro">← 查看数据库中的内容</span><br>+——+————-+<br>| num | name 　　 |<br>+——+————-+<br>|1　　 | <span class="att1">Hello,BSD</span> |　 <span class="intro">← 确认刚刚插入到表中的值的存在</span><br>+——+————-+<br>1 row in set (0.01 sec)</span></p>
<p><span style="color: #6600cc"><span class="message">mysql&gt;</span> <span class="command">exit</span>　 <span class="intro">← 退出MySQL服务器</span><br><span class="message">Bye</span></span><br><br><br><span style="color: #6600cc">　　然后，运行刚才建立的数据库备份脚本，备份刚刚建立的测试用的数据库。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"><span style="color: #6600cc"><span class="message">[root@sample ~]#</span> <span class="command">cd</span>　<span class="intro">← 回到脚本所在的root用户的根目录</span></span></td></p>
<p><span class="message">[root@sample ~]#</span> <span class="command">./mysql-backup.sh</span>　 <span class="intro">← 运行脚本进行数据库备份</span><br><br><br><br><span style="color: #6600cc">　　接下来，我们再次登录到MySQL服务器中，删除刚刚建立的测试用的数据库test，以便于测试数据恢复能否成功。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"></td></p>
<p></p><p class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">mysql -u root -p</span>　 <span class="intro">← 用root登录到MySQL服务器</span><br>Enter password:　<span class="intro"> ← 输入MySQL的root用户密码</span></span></p>
<p>Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 13 to server version: 4.1.20</p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到测试用的test数据库</span><br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</span></p>
<p></p><p class="message"><span style="color: #6600cc">Database changed<br>mysql&gt; <span class="command">drop table test;</span>　 <span class="intro">← 删除数据中的表</span><br>Query OK, 0 rows affected (0.04 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">drop database test;</span>　 <span class="intro">← 删除测试用数据库test</span><br>Query OK, 0 rows affected (0.01 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">show databases;</span><br>+————-+<br>| Database |<br>+————-+<br>| mysql　　 |　 <span class="intro">← 确认测试用的test数据库已不存在、已被删除</span><br>+————-+<br>1 row in set (0.01 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">exit</span>　 <span class="intro">← 退出MySQL服务器</span><br>Bye </span><br><br><br><span style="color: #6600cc">　　以上，我们就等于模拟了数据库被破坏的过程。接下来，是数据库被“破坏”后，用备份进行恢复的方法。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000" class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">/bin/cp -Rf /backup/mysql/test/ /var/lib/mysql/</span>　 <span class="intro">← 复制备份的数据库test到相应目录</span></span></td></p>
<p>[root@sample ~]# <span class="command">chown -R mysql:mysql /var/lib/mysql/test/</span>　<span class="intro"> ← 改变数据库test的归属为mysql</span></p>
<p>[root@sample ~]# <span class="command">chmod 700 /var/lib/mysql/test/</span>　 <span class="intro">← 改变数据库目录属性为700</span></p>
<p>[root@sample ~]# <span class="command">chmod 660 /var/lib/mysql/test/*</span>　 <span class="intro">← 改变数据库中数据的属性为660</span><br><br><br><span style="color: #6600cc">　　然后，再次登录到MySQL服务器上，看是否已经成功恢复了数据库。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"></td></p>
<p></p><p class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">mysql -u root -p</span>　 <span class="intro">← 用root登录到MySQL服务器</span><br>Enter password:　 <span class="intro">← 输入MySQL的root用户密码</span></span></p>
<p>Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 14 to server version: 4.1.20</p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p><span style="color: #6600cc">mysql&gt; <span class="command">show databases;</span>　 <span class="intro">← 查看当前存在的数据库</span><br>+————-+<br>| Database |<br>+————-+<br>| mysql　　 |<br>| <span class="att1">test</span>　　　 |　 <span class="intro">← 确认刚刚被删除的test数据库已经成功被恢复回来！</span><br>+————+<br>2 rows in set (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到test数据库</span><br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</span></p>
<p></p><p class="message"><span style="color: #6600cc">Database changed<br>mysql&gt; <span class="command">show tables;</span>　<span class="intro"> ← 查看test数据库中存在的表</span><br>+——————-+<br>| Tables_in_test |<br>+——————-+<br>| test 　　　　　|<br>+——————-+<br>1 row in set (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">select * from test;</span>　 <span class="intro">← 查看数据库中的内容</span><br>+——+————–+<br>| num | name　　　 |<br>+——+————–+<br>| 1 　　| <span class="att1">Hello,BSD</span> |　 <span class="intro">← 确认数据表中的内容与删除前定义的“Hello,BSD”一样！</span><br>+——+————–+<br>1 row in set (0.01 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">exit</span>　 <span class="intro">← 退出MySQL服务器</span><br>Bye </span><br><br><br><span style="color: #6600cc">　　以上结果表示，数据库被删除后，用备份后的数据库成功的将数据恢复到了删除前的状态。</span></p>
<p>[2] 当数据库被修改后的恢复方法</p>
<p>　　数据库被修改，可能存在着多方面的原因，被入侵、以及相应程序存在Bug等等，这里不作详细介绍。这里将只介绍在数据库被修改后，如果恢复到被修改前状态的方法。</p>
<p>　　具体和上面所述的“数据库被删除后的恢复方法”相类似。这里，测试用数据库接着使用刚刚在前面用过的test。这里为了使刚刚接触数据库的朋友不至于理解混乱，我们再次登录到MySQL服务器上确认一下刚刚建立的测试用的数据库test的相关信息。</p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"></td></p>
<p></p><p class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">mysql -u root -p</span>　 <span class="intro">← 用root登录到MySQL服务器</span><br>Enter password:　 ← 输入MySQL的root用户密码</span></p>
<p>Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 14 to server version: 4.1.20</p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p><span style="color: #6600cc">mysql&gt; <span class="command">show databases;</span>　 <span class="intro">← 查看当前存在的数据库</span><br>+————-+<br>| Database |<br>+————-+<br>| mysql　　 |<br>| test　　　 |<br>+————+<br>2 rows in set (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到test数据库</span><br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</span></p>
<p></p><p class="message"><span style="color: #6600cc">Database changed<br>mysql&gt; <span class="command">show tables;</span>　 <span class="intro">← 查看test数据库中存在的表</span><br>+——————-+<br>| Tables_in_test |<br>+——————-+<br>| test 　　　　　|<br>+——————-+<br>1 row in set (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">select * from test;</span>　<span class="intro"> ← 查看数据库中的内容</span><br>+——+————–+<br>| num | name　　　 |<br>+——+————–+<br>| 1 　　| Hello,BSD |<br>+——+————–+<br>1 row in set (0.01 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">exit</span>　 <span class="intro">← 退出MySQL服务器</span><br>Bye </span><br><br><br><span style="color: #6600cc">　　然后，我们再次运行数据库备份脚本，将当前状态的数据库，再做一次备份。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000" class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">cd</span> 　<span class="intro">← 回到脚本所在的root用户的根目录</span></span></td></p>
<p>[root@sample ~]# <span class="command">./mysql-backup.sh</span>　 <span class="intro">← 运行脚本进行数据库备份</span><br><br><br><span style="color: #6600cc">　　接下来，我们再次登录到MySQL服务器中，对测试用的数据库test进行一些修改，以便于测试数据恢复能否成功。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"></td></p>
<p></p><p class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">mysql -u root -p</span>　 <span class="intro">← 用root登录到MySQL服务器</span><br>Enter password:　 <span class="intro">← 输入MySQL的root用户密码</span></span></p>
<p>Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 15 to server version: 4.1.20</p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到test数据库</span><br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</span></p>
<p></p><p class="message"><span style="color: #6600cc">Database changed<br>mysql&gt; <span class="command">update test set name=’Shit,Windows’;</span>　 <span class="intro">← 然后将test中表的值重新定义为“Shit,Windows”（原来为“Hello,BSD”）</span><br>Query OK, 1 row affected (0.07 sec)<br>Rows matched: 1 Changed: 1 Warnings: 0</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">select * from test;</span>　 <span class="intro">← 确认test中的表被定义的值</span><br>+——+——————–+<br>| num | name 　　　　　|<br>+——+——————-+<br>| 1　　 | <span class="att1">Shit,Windows</span> |　 <span class="intro">← 确认已经将原test数据库表中的值修改为新的值“Shit,Windows”</span><br>+——+——————-+<br>1 row in set (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">exit</span>　 <span class="intro">← 退出MySQL服务器</span><br>Bye</span><br><br><br><span style="color: #6600cc">　　以上，我们就等于模拟了数据库被篡改的过程。接下来，是数据库被“篡改”后，用备份进行恢复的方法。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000" class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">/bin/cp -Rf /backup/mysql/test/ /var/lib/mysql/</span>　 <span class="intro">← 复制备份的数据库test到相应目录</span></span></td><br><br><br><span style="color: #6600cc">　　然后，再次登录到MySQL服务器上，看数据库是否被恢复到了被“篡改”之前的状态。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"></td></p>
<p></p><p class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">mysql -u root -p</span>　 <span class="intro">← 用root登录到MySQL服务器</span><br>Enter password:　 </span><span style="color: #6600cc"><span class="intro">← 输入MySQL的root用户密码<br></span><br>Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 16 to server version: 4.1.20</span></p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到test数据库</span><br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</span></p>
<p></p><p class="message"><span style="color: #6600cc">Database changed<br>mysql&gt; <span class="command">select * from test;</span>　 <span class="intro">← 查看数据库中的内容</span><br>+——+—————-+<br>| num | name　　　 |<br>+——+—————-+<br>| 1　　| <span class="att1">Hello,BSD </span>　|　<span class="intro">← 确认数据表中的内容与被修改前定义的“Hello,BSD”一样！</span><br>+——+—————-+<br>1 row in set (0.01 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">exit</span>　 <span class="intro">← 退出MySQL服务器</span><br>Bye</span><br><br><br><span style="color: #6600cc">　　以上结果表示，数据库被修改后，用备份后的数据库成功的将数据恢复到了被“篡改”前的状态。</span></p>
<p></p>
<p><table border="0" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#4665a6"></td></p>
<p><table border="0"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#333333" class="table-title"><span style="color: #6600cc">测试后…</span></td><br><br><br><br><br><br><span style="color: #6600cc">　　测试完成后，将测试用过的遗留信息删除。</span></p>
<p></p>
<p><table border="2" width="100%"></table></p>
<p><tr></tr></p>
<p><td bgcolor="#000000"></td></p>
<p></p><p class="message"><span style="color: #6600cc">[root@sample ~]# <span class="command">mysql -u root -p</span>　 <span class="intro">← 用root登录到MySQL服务器</span><br>Enter password:　 <span class="intro">← 输入MySQL的root用户密码</span></span></p>
<p>Welcome to the MySQL monitor. Commands end with ; or g.<br>Your MySQL connection id is 19 to server version: 4.1.20</p>
<p></p><p class="message"><span style="color: #6600cc">Type ‘help;’ or ‘h’ for help. Type ‘c’ to clear the buffer.</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">use test</span>　 <span class="intro">← 连接到test数据库</span><br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</span></p>
<p></p><p class="message"><span style="color: #6600cc">Database changed<br>mysql&gt; <span class="command">drop table test;</span>　 <span class="intro">← 删除test数据库中的表</span><br>Query OK, 0 rows affected (0.01 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">drop database test;</span>　 <span class="intro">← 删除测试用数据库test</span><br>Query OK, 0 rows affected (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; <span class="command">show databases;</span>　 <span class="intro">← 查看当前存在的数据库</span><br>+————-+<br>| Database |<br>+————-+<br>| mysql 　　|　 <span class="intro">← 确认测试用数据库test不存在、已被删除</span><br>+————-+<br>1 row in set (0.00 sec)</span></p>
<p></p><p class="message"><span style="color: #6600cc">mysql&gt; exit　 <span class="intro">← 退出MySQL服务器</span><br>Bye</span><br><br><br><span style="color: #6600cc">——–<br>　　以上介绍了用我们自己建立的一段Shell脚本，通过mysqlhotcopy来备份数据库的方法。</span></p>
<p>　　对于许多个人爱好者来说，组建服务器可能不是很考虑数据被破坏以及数据被破坏后的恢复工作。但不能不说，对于服务器来说，数据破坏后的恢复效率也是区 别业余和专业的因素之一。所以笔者建议，在您配置好了Web服务器以及MySQL服务器等等的时候，千万不要急于应用它，而要想办法在有限的（硬件、软 件）条件下使它“坚不可摧”之后，再考虑应用的问题。</p>
<p>　　而且，以上介绍的方法中提到的数据库自动备份脚本虽然被设置为每天定时运行，但当您运行某些与MySQL相关联的程序（论坛、社区等等）时，做一些可 能危及数据安全的操作的时候，运行数据库备份脚本即时备份当前状态数据库，也是非常有帮助的，至少可以在出现问题后保证数据库方面的可恢复性。<br><!-- Added by RelatedTopic, plugin for Bo-Blog 2.0.0 --></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/17/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/19/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="九王爷" />
          <p class="site-author-name" itemprop="name">九王爷</p>
           
              <p class="site-description motion-element" itemprop="description">这里是外宅，备份用的</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">268</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">九王爷</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
