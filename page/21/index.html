<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="这里是外宅，备份用的">
<meta property="og:type" content="website">
<meta property="og:title" content="九王爷">
<meta property="og:url" content="http://yoursite.com/page/21/index.html">
<meta property="og:site_name" content="九王爷">
<meta property="og:description" content="这里是外宅，备份用的">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="九王爷">
<meta name="twitter:description" content="这里是外宅，备份用的">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/21/"/>





  <title> 九王爷 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">九王爷</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">九王爷的府邸</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/15/e5-9c-a8-e9-bc-a0-e6-a0-87-e5-8f-b3-e9-94-ae-e4-b8-ad-e5-8a-a0-e5-85-a5cygwin-e7-9a-84-e5-bf-ab-e9-80-9f-e5-90-af-e5-8a-a8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/15/e5-9c-a8-e9-bc-a0-e6-a0-87-e5-8f-b3-e9-94-ae-e4-b8-ad-e5-8a-a0-e5-85-a5cygwin-e7-9a-84-e5-bf-ab-e9-80-9f-e5-90-af-e5-8a-a8/" itemprop="url">
                  在鼠标右键中加入cygwin的快速启动
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-15T16:51:24+08:00">
                2008-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Uncategorized/" itemprop="url" rel="index">
                    <span itemprop="name">Uncategorized</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>经常需要在cygwin下完成一些工作，每次都CD过去太慢了，而且有中文的地方就非常的不方便，找到一个在鼠标右键中加cygwin的方法</p>
<p>1、运行regedit，找到HKEY_CLASSES_ROOT /Directory/shell 中有一个 find，在 shell 处添加一个与之平行的 项，其值设为 “命令行”. 在 此项 下建一个项 command，其值为：cmd.exe /k c:cygwinunix.bat %1</p>
<p>unix.bat 的内容为：@c:cygwinbinbash –login -c “cd ‘%1’; exec bash –rcfile ~/.bashrc”</p>
<p>2、右击目录后就运行命令行，直接转到当前目录，但会有个问题目录中文会乱码在.bashrc找到alias ls行改为alias ls=’ls -hF –show-control-chars –color=tty’ # classify files in colour</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/14/dos-e7-bd-91-e7-bb-9c-e5-91-bd-e4-bb-a4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/14/dos-e7-bd-91-e7-bb-9c-e5-91-bd-e4-bb-a4/" itemprop="url">
                  DOS网络命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-14T18:04:54+08:00">
                2008-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Uncategorized/" itemprop="url" rel="index">
                    <span itemprop="name">Uncategorized</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/01/14/dos-e7-bd-91-e7-bb-9c-e5-91-bd-e4-bb-a4/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/13/e5-b7-a7-e7-94-a8find-e5-91-bd-e4-bb-a4-e7-ae-a1-e7-90-86-e6-96-87-e4-bb-b6-e5-90-8d-e4-b8-ba-e4-b9-b1-e7-a0-81-e7-9a-84-e6-96-87-e4-bb-b6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/13/e5-b7-a7-e7-94-a8find-e5-91-bd-e4-bb-a4-e7-ae-a1-e7-90-86-e6-96-87-e4-bb-b6-e5-90-8d-e4-b8-ba-e4-b9-b1-e7-a0-81-e7-9a-84-e6-96-87-e4-bb-b6/" itemprop="url">
                  巧用find命令管理文件名为乱码的文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-13T23:35:09+08:00">
                2008-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>当文件名为乱码的时候，无法通过键盘输入文件名，所以在终端下就不能直接利用rm，mv等命令管理文件了。<br>但是我们知道每个文件都有一个i节点号，我们可以考虑通过i节点号来管理文件。首先，我们要取得文件的<br>i节点号。这个可以通过ls命令的-i选项获得得。
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/01/13/e5-b7-a7-e7-94-a8find-e5-91-bd-e4-bb-a4-e7-ae-a1-e7-90-86-e6-96-87-e4-bb-b6-e5-90-8d-e4-b8-ba-e4-b9-b1-e7-a0-81-e7-9a-84-e6-96-87-e4-bb-b6/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/11/proftpd-e6-9c-8d-e5-8a-a1-e5-99-a8-e9-85-8d-e7-bd-ae-e8-bf-87-e7-a8-8b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/11/proftpd-e6-9c-8d-e5-8a-a1-e5-99-a8-e9-85-8d-e7-bd-ae-e8-bf-87-e7-a8-8b/" itemprop="url">
                  ProFTPD服务器配置过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-11T17:16:08+08:00">
                2008-01-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FTPserver/" itemprop="url" rel="index">
                    <span itemprop="name">FTPserver</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><span style="font-family: 宋体"> 看到这篇还写得不错，拿过来欣赏下，我最喜欢拿来主义了：-）</span></p>
<p><span style="font-family: 宋体">另外今天被网上的以篇文章给误导了一上午，差点发飙，居然是因为COPY得太流畅了，连小错误都没发现。就是那篇网上流传得很广的proftp配置文章，里面有个建立新用户的过程，不自主的就发扬了COPY精神，弄了过来改个名字就用上了，结果里面有笔误？或者是作者系统比较特别将false 写成了fales，哈哈，估计不只我一个中招，记录下来，万一有朋友找到这里来还能知道是啥原因
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/01/11/proftpd-e6-9c-8d-e5-8a-a1-e5-99-a8-e9-85-8d-e7-bd-ae-e8-bf-87-e7-a8-8b/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/11/proftp-e5-ae-8c-e6-95-b4-e9-85-8d-e7-bd-ae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/11/proftp-e5-ae-8c-e6-95-b4-e9-85-8d-e7-bd-ae/" itemprop="url">
                  proftp--完整配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-11T15:30:30+08:00">
                2008-01-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FTPserver/" itemprop="url" rel="index">
                    <span itemprop="name">FTPserver</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p></p><p align="justify">shell&gt;tar -zxvf proftpd-1.2.10.tar.gz<br>shell&gt;./configure –prefix=/usr/local/proftp<br>shell&gt;make<br>shell&gt;make install<br>如果想让系统启动时自动启动proftpd，具体配置如下：<br>shell&gt;cd proftpd-1.2.10<br>shell&gt;cp contrib/dist/rpm/proftpd.init.d /etc/rc.d/init.d/proftpd<br>shell&gt;chkconfig –add proftpd
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/01/11/proftp-e5-ae-8c-e6-95-b4-e9-85-8d-e7-bd-ae/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/11/centos-5-e5-85-a8-e5-8a-9f-e8-83-bdwww-e6-9c-8d-e5-8a-a1-e5-99-a8-e6-90-ad-e5-bb-ba-e5-85-a8-e6-95-99-e7-a8-8b-v30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/11/centos-5-e5-85-a8-e5-8a-9f-e8-83-bdwww-e6-9c-8d-e5-8a-a1-e5-99-a8-e6-90-ad-e5-bb-ba-e5-85-a8-e6-95-99-e7-a8-8b-v30/" itemprop="url">
                  CentOS 5 全功能WWW服务器搭建全教程 V3.0
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-11T09:18:14+08:00">
                2008-01-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CentOS 5 全功能WWW服务器搭建全教程</p>
<font color="#ff0000">请注意，附件中的word文件由于有文档格式很麻烦，不会即时更新，请下载者直接复制本网页内容。</font>

<p>V3.0 2007年11月11日 将搭建教程划分阶段以适应不同需要。加入程序优化，程序安全，加入memcache，squid, mod_security等高级应用, 安装vBulletin+vBseo, 服务器安全设置，以及日常管理功能。</p>
<p>V2.0 2007年10月18日 操作系统更新为centos 5.0 apache 更新为2.2.6版本，php更新为5.2.5, mysql 更新为5.0.46, Zend Optimizer 更新为3.3.0。解决新平台下的一些问题。修正文字错误。</p>
<p>v1.2 2007年2月12日 apache 更新为2.2.4版本，增加mod_ssl和openssl支持，增加apr和apr-util的编译， php更新为5.2.1,增加集成Suhosin补丁，mysql 更新为5.0.33, Zend Optimizer 更新为3.2.2，增加phpmyadmin。修改一些文字错误。</p>
<p>v1.0 2007年1月11日</p>
<p>V3.0版本文字文明在<br><a href="http://www.cnprint.org/bbs/blogs/1/blog66.html" target="_blank" rel="external">http://www.cnprint.org/bbs/blogs/1/blog66.html</a><br>长期在线维护。欢迎转帖，转帖时请勿删除本说明。<br>By 二戒</p>
<p>先声明，以下的这些文字个人的安装笔记，是参考了网上许多高手的成功经验组合而成的，说实话我自己的东西不多 ：）我想把这些经验写下来，既可以对其他跟我一样摸索的兄弟一个经验，也可以防止以后自己都忘记了，嘿嘿。<br>所以如果某个大虾看到我借用了你的资源，请不要生气。同时欢迎大家指出错误。<br>一、基本系统安装<br>1、下载CentOS 5<br>我是下载的DVD版本，大家也可以下载服务器CD安装版本，其实都差不多。大家可以到这儿下载，速度很快的。<br><a href="http://ftp.iasi.roedu.net/mirrors/centos.org/5/isos/i386/CentOS-5.0-i386-bin-DVD.iso" target="_blank" rel="external">http://ftp.iasi.roedu.net/mirrors/centos.org/5/isos/i386/CentOS-5.0-i386-bin-DVD.iso</a><br>建议在windows下用BT或迅雷下载，速度会快很多。<br>下载后刻录成光盘。我建议你刻录DVD啦，如果是菜鸟，把图形界面也装上，可以在图形界面进行学习，当然强烈不建议在服务器上装桌面。<br>Centos 5系列任何一个版本就行了，安装后可以通过yum upgrade直接更新为最新版本。</p>
<p>2、安装CentOS 5<br>作为服务器，不安装不需要的组件，所以在选择组件的时候，除了选择FTP SERVER外取消所有组件的选择。也不要选web服务器。因为我们后面要手动编译安装。<br>系统约定RPM包和源码包存放位置<br>RPM包和源码包存放位置 /usr/local/src<br>源码包编译安装位置(prefix) /usr/local/xxx<br>脚本以及维护程序存放位置 /usr/local/sbin<br>MySQL 数据库位置 /var/lib/mysql<br>Apache 网站根目录 /usr/local/apache2/htdocs<br>Apache 虚拟主机日志根目录 /data/logs/www<br>yum RPM包信息文件 /etc/yum.list</p>
<p>3、系统环境部署及调整<br>（1）检查系统是否正常</p>
<h1 id="more-var-log-messages-检查有无系统内核级错误信息"><a href="#more-var-log-messages-检查有无系统内核级错误信息" class="headerlink" title="more /var/log/messages //检查有无系统内核级错误信息"></a>more /var/log/messages //检查有无系统内核级错误信息</h1><h1 id="demesg-检查硬件设备是否有错误信息"><a href="#demesg-检查硬件设备是否有错误信息" class="headerlink" title="demesg //检查硬件设备是否有错误信息"></a>demesg //检查硬件设备是否有错误信息</h1><h1 id="ifconfig-检查网卡设置是否正确"><a href="#ifconfig-检查网卡设置是否正确" class="headerlink" title="ifconfig //检查网卡设置是否正确"></a>ifconfig //检查网卡设置是否正确</h1><h1 id="ping-www-163-com-检查网络是否正常"><a href="#ping-www-163-com-检查网络是否正常" class="headerlink" title="ping www.163.com // 检查网络是否正常"></a>ping www.163.com // 检查网络是否正常</h1><p>（2）关闭不需要的服务</p>
<h1 id="export-LANG-’en-US’-设置语言"><a href="#export-LANG-’en-US’-设置语言" class="headerlink" title="export LANG=’en_US’ //设置语言"></a>export LANG=’en_US’ //设置语言</h1><h1 id="setup-选择启动的服务"><a href="#setup-选择启动的服务" class="headerlink" title="setup //选择启动的服务"></a>setup //选择启动的服务</h1><p>进入system service 选项。<br>以space 键选定所需服务。<br>以下仅列出需要启动的服务，未列出的服务一律关闭：<br>crond<br>irqbalance 仅当服务器CPU为S.M.P架构或支持双核心、HT技术时，才需开启，否则关闭。<br>microcode_ctl<br>network<br>iptables<br>vsftpd<br>sshd<br>syslog<br>yum-updatesd<br>（3）修改/etc/yum.repos.d/CentOS-Base.repo，将镜象站点地址改为在中国的镜象站点地址。不然我们通过yum安装软件速度会极慢。修改如下：</p>
<h1 id="CentOS-Base-repo"><a href="#CentOS-Base-repo" class="headerlink" title="CentOS-Base.repo"></a>CentOS-Base.repo</h1><p>#</p>
<h1 id="This-file-uses-a-new-mirrorlist-system-developed-by-Lance-Davis-for-CentOS"><a href="#This-file-uses-a-new-mirrorlist-system-developed-by-Lance-Davis-for-CentOS" class="headerlink" title="This file uses a new mirrorlist system developed by Lance Davis for CentOS."></a>This file uses a new mirrorlist system developed by Lance Davis for CentOS.</h1><h1 id="The-mirror-system-uses-the-connecting-IP-address-of-the-client-and-the"><a href="#The-mirror-system-uses-the-connecting-IP-address-of-the-client-and-the" class="headerlink" title="The mirror system uses the connecting IP address of the client and the"></a>The mirror system uses the connecting IP address of the client and the</h1><h1 id="update-status-of-each-mirror-to-pick-mirrors-that-are-updated-to-and"><a href="#update-status-of-each-mirror-to-pick-mirrors-that-are-updated-to-and" class="headerlink" title="update status of each mirror to pick mirrors that are updated to and"></a>update status of each mirror to pick mirrors that are updated to and</h1><h1 id="geographically-close-to-the-client-You-should-use-this-for-CentOS-updates"><a href="#geographically-close-to-the-client-You-should-use-this-for-CentOS-updates" class="headerlink" title="geographically close to the client. You should use this for CentOS updates"></a>geographically close to the client. You should use this for CentOS updates</h1><h1 id="unless-you-are-manually-picking-other-mirrors"><a href="#unless-you-are-manually-picking-other-mirrors" class="headerlink" title="unless you are manually picking other mirrors."></a>unless you are manually picking other mirrors.</h1><p>#</p>
<h1 id="If-the-mirrorlist-does-not-work-for-you-as-a-fall-back-you-can-try-the"><a href="#If-the-mirrorlist-does-not-work-for-you-as-a-fall-back-you-can-try-the" class="headerlink" title="If the mirrorlist= does not work for you, as a fall back you can try the"></a>If the mirrorlist= does not work for you, as a fall back you can try the</h1><h1 id="remarked-out-baseurl-line-instead"><a href="#remarked-out-baseurl-line-instead" class="headerlink" title="remarked out baseurl= line instead."></a>remarked out baseurl= line instead.</h1><p>#<br>#<br>[base]<br>name=CentOS-$releasever - Base<br>baseurl=<a href="http://mirrors.shlug.org/centos/$releasever/os/$basearch/" target="_blank" rel="external">http://mirrors.shlug.org/centos/$releasever/os/$basearch/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5" target="_blank" rel="external">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5</a><br>protect=1</p>
<p>#released updates<br>[updates]<br>name=CentOS-$releasever - Updates<br>baseurl=<a href="http://mirrors.shlug.org/centos/$releasever/updates/$basearch/" target="_blank" rel="external">http://mirrors.shlug.org/centos/$releasever/updates/$basearch/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5" target="_blank" rel="external">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5</a><br>protect=1</p>
<p>#packages used/produced in the build but not released<br>[addons]<br>name=CentOS-$releasever - Addons<br>baseurl=<a href="http://mirrors.shlug.org/centos/$releasever/addons/$basearch/" target="_blank" rel="external">http://mirrors.shlug.org/centos/$releasever/addons/$basearch/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5" target="_blank" rel="external">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5</a><br>protect=0</p>
<p>#additional packages that may be useful<br>[extras]<br>name=CentOS-$releasever - Extras<br>baseurl=<a href="http://mirrors.shlug.org/centos/$releasever/extras/$basearch/" target="_blank" rel="external">http://mirrors.shlug.org/centos/$releasever/extras/$basearch/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5" target="_blank" rel="external">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5</a><br>protect=0</p>
<p>#additional packages that extend functionality of existing packages<br>[centosplus]<br>name=CentOS-$releasever - Plus<br>baseurl=<a href="http://mirrors.shlug.org/centos/$releasever/centosplus/$basearch/" target="_blank" rel="external">http://mirrors.shlug.org/centos/$releasever/centosplus/$basearch/</a><br>gpgcheck=1<br>enabled=0<br>gpgkey=<a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5" target="_blank" rel="external">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5</a><br>protect=1</p>
<p>#contrib - packages by Centos Users<br>[contrib]<br>name=CentOS-$releasever - Contrib<br>baseurl=<a href="http://mirrors.shlug.org/centos/$releasever/contrib/$basearch/" target="_blank" rel="external">http://mirrors.shlug.org/centos/$releasever/contrib/$basearch/</a><br>gpgcheck=1<br>enabled=0<br>protect=0<br>gpgkey=<a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5" target="_blank" rel="external">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5</a><br>保存文件。<br>（4）更新系统，我们使用yum,<br>运行：</p>
<h1 id="yum-upgrade"><a href="#yum-upgrade" class="headerlink" title="yum upgrade"></a>yum upgrade</h1><p>建议更新所有列出的程序，包括内核，rhel 5.X的稳定性还要继续努力呢。<br>（5）定时校正服务器时间</p>
<h1 id="yum-install-–y-ntp"><a href="#yum-install-–y-ntp" class="headerlink" title="yum install –y ntp"></a>yum install –y ntp</h1><h1 id="crontab-e"><a href="#crontab-e" class="headerlink" title="crontab -e"></a>crontab -e</h1><p>0 23 <em> </em> * /usr/sbin/ntpdate 210.72.145.44<br>以上命令设置好后存盘。</p>
<h1 id="sbin-service-crond-reload"><a href="#sbin-service-crond-reload" class="headerlink" title="/sbin/service crond reload"></a>/sbin/service crond reload</h1><p>重载计划任务配置<br>您的机器将在每天的23:00根据中国国家授时中心的NTP服务器时间自动校准时间。<br>（6）FTP服务器的配置<br>vi /etc/vsftpd/vsftpd.conf<br>把anonymous_enable=YES<br>修改为anonymous_enable=No不允许匿名登录。<br>添加两句<br>chroot_local_user=yes<br>listen_port=2121<br>将用户锁定在主目录，并将FTP监听端口修改为2121<br>把ftpd_banner=<em>前的注释去掉。后面改成你的欢迎信息(这样设置可以避免显示ftp服务器的版本信息)<br>然后保存，service vsftpd start就可以了。<br>这时应当添加用户，因为root默认不能通过FTP方式登录，也不安全。<br>groupadd upload<br>useradd upload -g upload -d /usr/local/apache2/htdocs/ -M<br>如果FTP登录时出现<br>ftp服务器连接失败,错误提示:<br>500 OOPS: cannot change directory:/home/<strong>**</strong></em><br>500 OOPS: child died<br>解决方法:</p>
<h1 id="setsebool-ftpd-disable-trans-1"><a href="#setsebool-ftpd-disable-trans-1" class="headerlink" title="setsebool ftpd_disable_trans 1"></a>setsebool ftpd_disable_trans 1</h1><h1 id="service-vsftpd-restart"><a href="#service-vsftpd-restart" class="headerlink" title="service vsftpd restart"></a>service vsftpd restart</h1><p>这样对于我们上传一些文件到系统中很方便。<br>大家有兴趣的可以看下这篇文章对vsftpd进行一个比较详细的了解<br><a href="http://blog.chinaunix.net/u/10047/showart_198837.html" target="_blank" rel="external">http://blog.chinaunix.net/u/10047/showart_198837.html</a><br>4、重新启动系统</p>
<h1 id="init-6"><a href="#init-6" class="headerlink" title="init 6"></a>init 6</h1><p>此时系统启动成功，可以删除老的内核</p>
<p>二、安装mysql, apache, php, Zend Optimizer等基本环境<br>5. 使用 yum 程序安装所需开发包（以下为标准的rpm包名称）</p>
<h1 id="yum-install-gcc-gcc-c-gcc-g77-flex-bison-autoconf-automake-bzip2-devel-zlib-devel-ncurses-devel-libjpeg-devel-libpng-devel-libtiff-devel-freetype-devel-pam-devel-openssl-devel-libxml2-devel-gettext-devel-pcre-devel"><a href="#yum-install-gcc-gcc-c-gcc-g77-flex-bison-autoconf-automake-bzip2-devel-zlib-devel-ncurses-devel-libjpeg-devel-libpng-devel-libtiff-devel-freetype-devel-pam-devel-openssl-devel-libxml2-devel-gettext-devel-pcre-devel" class="headerlink" title="yum install gcc gcc-c++ gcc-g77 flex bison autoconf automake bzip2-devel zlib-devel ncurses-devel libjpeg-devel libpng-devel libtiff-devel freetype-devel pam-devel openssl-devel libxml2-devel gettext-devel pcre-devel"></a>yum install gcc gcc-c++ gcc-g77 flex bison autoconf automake bzip2-devel zlib-devel ncurses-devel libjpeg-devel libpng-devel libtiff-devel freetype-devel pam-devel openssl-devel libxml2-devel gettext-devel pcre-devel</h1><p>#这里我们将编译GD所必须的一些小软件比如libpng,libtiff,freetype,libjpeg,gettext-devel等先用RPM 的方式一并安装好，避免手动编译浪费时间，同时也能避免很多错误，这几个小软件的编译很麻烦。这几个小软件编译错误了，GD当然安装不了，php5的编译当然也没戏了。所以我们抓大放小，对这些小牛鬼蛇神采取快速简洁的方式进行安装。并且对服务器的性能也不能产生什么影响。<br>另外libxml2系统已经默认安装了，所以我们不需要手工编译了，直接安装它的开发包就行了。<br>6. 源码编译安装所需包 (Source)<br>(1) GD2</p>
<h1 id="cd-usr-local-src"><a href="#cd-usr-local-src" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-www-libgd-org-releases-gd-2-0-35-tar-gz"><a href="#wget-http-www-libgd-org-releases-gd-2-0-35-tar-gz" class="headerlink" title="wget http://www.libgd.org/releases/gd-2.0.35.tar.gz"></a>wget <a href="http://www.libgd.org/releases/gd-2.0.35.tar.gz" target="_blank" rel="external">http://www.libgd.org/releases/gd-2.0.35.tar.gz</a></h1><h1 id="tar-xzvf-gd-2-0-35-tar-gz"><a href="#tar-xzvf-gd-2-0-35-tar-gz" class="headerlink" title="tar xzvf gd-2.0.35.tar.gz"></a>tar xzvf gd-2.0.35.tar.gz</h1><h1 id="cd-gd-2-0-35"><a href="#cd-gd-2-0-35" class="headerlink" title="cd gd-2.0.35"></a>cd gd-2.0.35</h1><h1 id="yum-install-libtool-libtool-ltdl"><a href="#yum-install-libtool-libtool-ltdl" class="headerlink" title="yum install libtool libtool-ltdl"></a>yum install libtool libtool-ltdl</h1><h1 id="aclocal"><a href="#aclocal" class="headerlink" title="aclocal"></a>aclocal</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-gd2-–mandir-usr-share-man"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-gd2-–mandir-usr-share-man" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/gd2 –mandir=/usr/share/man"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/gd2 –mandir=/usr/share/man</h1><p>// 注意，CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” 这个环境参数只针对intel P4 芯片，如果你的CPU是AMD的，注意不能使用。请查看相应的编译优化参数。否则程序会无法编译，即使编译成功也无法运行，嘿嘿。<br>关于其他CPU的优化参见我的BLOG的一篇转贴：<br><a href="http://www.cnprint.org/bbs/blogs/1/blog43.html" target="_blank" rel="external">http://www.cnprint.org/bbs/blogs/1/blog43.html</a><br>//./configure 配置。</p>
<h1 id="make-make-是用来编译的，它从-Makefile-中读取指令，然后编译。"><a href="#make-make-是用来编译的，它从-Makefile-中读取指令，然后编译。" class="headerlink" title="make //make 是用来编译的，它从 Makefile 中读取指令，然后编译。"></a>make //make 是用来编译的，它从 Makefile 中读取指令，然后编译。</h1><h1 id="make-install-make-install-是用来安装的，它也从-Makefile-中读取指令，安装到指定的位置。"><a href="#make-install-make-install-是用来安装的，它也从-Makefile-中读取指令，安装到指定的位置。" class="headerlink" title="make install //make install 是用来安装的，它也从 Makefile 中读取指令，安装到指定的位置。"></a>make install //make install 是用来安装的，它也从 Makefile 中读取指令，安装到指定的位置。</h1><p>(2) Apache 日志截断程序</p>
<h1 id="cd-usr-local-src-1"><a href="#cd-usr-local-src-1" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-cronolog-org-patches-cronolog-1-7-0-beta-tar-gz"><a href="#wget-http-cronolog-org-patches-cronolog-1-7-0-beta-tar-gz" class="headerlink" title="wget http://cronolog.org/patches/cronolog-1.7.0-beta.tar.gz"></a>wget <a href="http://cronolog.org/patches/cronolog-1.7.0-beta.tar.gz" target="_blank" rel="external">http://cronolog.org/patches/cronolog-1.7.0-beta.tar.gz</a></h1><h1 id="tar-cronolog-1-7-0-beta-tar-gz"><a href="#tar-cronolog-1-7-0-beta-tar-gz" class="headerlink" title="tar cronolog-1.7.0-beta.tar.gz"></a>tar cronolog-1.7.0-beta.tar.gz</h1><h1 id="cd-cronolog-1-7-0-beta"><a href="#cd-cronolog-1-7-0-beta" class="headerlink" title="cd cronolog-1.7.0-beta"></a>cd cronolog-1.7.0-beta</h1><p>#CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/cronolog &amp;&amp; make &amp;&amp; make install</p>
<p>7、编译mysql 5.0.50<br>mysql 5.0.50是企业版本，貌似双数版本都是企业版本了。个人觉得代码质量要比社区版本要好一些。大家可以下载，免费使用。并不需要向mysql公司交钱。</p>
<p>#cd /usr/local/src</p>
<h1 id="wget-http-mirror-provenscaling-com-mysql-enterprise-source-5-0-mysql-5-0-50-tar-gz"><a href="#wget-http-mirror-provenscaling-com-mysql-enterprise-source-5-0-mysql-5-0-50-tar-gz" class="headerlink" title="wget http://mirror.provenscaling.com/mysql/enterprise/source/5.0/mysql-5.0.50.tar.gz"></a>wget <a href="http://mirror.provenscaling.com/mysql/enterprise/source/5.0/mysql-5.0.50.tar.gz" target="_blank" rel="external">http://mirror.provenscaling.com/mysql/enterprise/source/5.0/mysql-5.0.50.tar.gz</a></h1><h1 id="tar-xzvf-mysql-5-0-50-tar-gz"><a href="#tar-xzvf-mysql-5-0-50-tar-gz" class="headerlink" title="tar xzvf mysql-5.0.50.tar.gz"></a>tar xzvf mysql-5.0.50.tar.gz</h1><h1 id="cd-mysql-5-0-50"><a href="#cd-mysql-5-0-50" class="headerlink" title="cd mysql-5.0.50"></a>cd mysql-5.0.50</h1><p>修改mysql 客户端最大连接数， 默认的只有100,远远达不到我们的要求。</p>
<h1 id="vi-sql-mysqld-cc"><a href="#vi-sql-mysqld-cc" class="headerlink" title="vi sql/mysqld.cc"></a>vi sql/mysqld.cc</h1><p>搜索找到下面一行：<br>{“max_connections”, OPT_MAX_CONNECTIONS,<br>“The number of simultaneous clients allowed.”, (gptr<em>) &amp;max_connections,<br>(gptr</em>) &amp;max_connections, 0, GET_ULONG, REQUIRED_ARG, 100, 1, 16384, 0, 1,<br>0},<br>将其中的100改为1500, 当然小点也可以，根据你的需要来，不建议改的太大。<br>{“max_connections”, OPT_MAX_CONNECTIONS,<br>“The number of simultaneous clients allowed.”, (gptr<em>) &amp;max_connections,<br>(gptr</em>) &amp;max_connections, 0, GET_ULONG, REQUIRED_ARG, 1500, 1, 16384, 0, 1,<br>0},<br>保存。</p>
<h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-mysql-–localstatedir-var-lib-mysql-–with-comment-Source-–with-server-suffix-enterprise-gpl-–with-mysqld-user-mysql-–without-debug-–with-big-tables-–with-charset-utf8-–with-collation-utf8-general-ci-–with-extra-charsets-gbk-latin1-–with-pthread-–enable-static-–with-client-ldflags-all-static-–with-mysqld-ldflags-all-static-–enable-assembler-–without-innodb-–without-ndb-debug-–without-isam-–enable-local-infile-–with-readline-–with-raid"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-mysql-–localstatedir-var-lib-mysql-–with-comment-Source-–with-server-suffix-enterprise-gpl-–with-mysqld-user-mysql-–without-debug-–with-big-tables-–with-charset-utf8-–with-collation-utf8-general-ci-–with-extra-charsets-gbk-latin1-–with-pthread-–enable-static-–with-client-ldflags-all-static-–with-mysqld-ldflags-all-static-–enable-assembler-–without-innodb-–without-ndb-debug-–without-isam-–enable-local-infile-–with-readline-–with-raid" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/mysql –localstatedir=/var/lib/mysql –with-comment=Source –with-server-suffix=-enterprise-gpl –with-mysqld-user=mysql –without-debug –with-big-tables –with-charset=utf8 –with-collation=utf8_general_ci –with-extra-charsets=gbk,latin1 –with-pthread –enable-static –with-client-ldflags=-all-static –with-mysqld-ldflags=-all-static –enable-assembler –without-innodb –without-ndb-debug –without-isam –enable-local-infile –with-readline –with-raid"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/mysql –localstatedir=/var/lib/mysql –with-comment=Source –with-server-suffix=-enterprise-gpl –with-mysqld-user=mysql –without-debug –with-big-tables –with-charset=utf8 –with-collation=utf8_general_ci –with-extra-charsets=gbk,latin1 –with-pthread –enable-static –with-client-ldflags=-all-static –with-mysqld-ldflags=-all-static –enable-assembler –without-innodb –without-ndb-debug –without-isam –enable-local-infile –with-readline –with-raid</h1><p>配置成功会提示：<br>MySQL has a Web site at <a href="http://www.mysql.com/" target="_blank" rel="external">http://www.mysql.com/</a> which carries details on the<br>latest release, upcoming features, and other information to make your<br>work or play with MySQL more productive. There you can also find<br>information about mailing lists for MySQL discussion.<br>Remember to check the platform specific part of the reference manual for<br>hints about installing MySQL on your platform. Also have a look at the<br>files in the Docs directory.<br>Thank you for choosing MySQL!</p>
<h1 id="make"><a href="#make" class="headerlink" title="make"></a>make</h1><p>编译的时间可能会比较长，毕竟优化的比较厉害。</p>
<h1 id="make-install"><a href="#make-install" class="headerlink" title="make install"></a>make install</h1><p>编译安装完成后执行后续操作：</p>
<h1 id="useradd-mysql-添加-mysql-用户"><a href="#useradd-mysql-添加-mysql-用户" class="headerlink" title="useradd mysql //添加 mysql 用户"></a>useradd mysql //添加 mysql 用户</h1><h1 id="cd-usr-local-mysql"><a href="#cd-usr-local-mysql" class="headerlink" title="cd /usr/local/mysql"></a>cd /usr/local/mysql</h1><h1 id="bin-mysql-install-db-–user-mysql"><a href="#bin-mysql-install-db-–user-mysql" class="headerlink" title="bin/mysql_install_db –user=mysql"></a>bin/mysql_install_db –user=mysql</h1><h1 id="chown-R-root-mysql-设置权限，注意后面有一个-“-”"><a href="#chown-R-root-mysql-设置权限，注意后面有一个-“-”" class="headerlink" title="chown -R root:mysql . //设置权限，注意后面有一个 “.”"></a>chown -R root:mysql . //设置权限，注意后面有一个 “.”</h1><h1 id="chown-R-mysql-var-lib-mysql-设置-mysql-目录权限"><a href="#chown-R-mysql-var-lib-mysql-设置-mysql-目录权限" class="headerlink" title="chown -R mysql /var/lib/mysql //设置 mysql 目录权限"></a>chown -R mysql /var/lib/mysql //设置 mysql 目录权限</h1><h1 id="chgrp-R-mysql-注意后面有一个-“-”"><a href="#chgrp-R-mysql-注意后面有一个-“-”" class="headerlink" title="chgrp -R mysql . //注意后面有一个 “.”"></a>chgrp -R mysql . //注意后面有一个 “.”</h1><h1 id="cp-share-mysql-my-medium-cnf-etc-my-cnf"><a href="#cp-share-mysql-my-medium-cnf-etc-my-cnf" class="headerlink" title="cp share/mysql/my-medium.cnf /etc/my.cnf"></a>cp share/mysql/my-medium.cnf /etc/my.cnf</h1><h1 id="cp-share-mysql-mysql-server-etc-rc-d-init-d-mysqld-开机自动启动-mysql。"><a href="#cp-share-mysql-mysql-server-etc-rc-d-init-d-mysqld-开机自动启动-mysql。" class="headerlink" title="cp share/mysql/mysql.server /etc/rc.d/init.d/mysqld //开机自动启动 mysql。"></a>cp share/mysql/mysql.server /etc/rc.d/init.d/mysqld //开机自动启动 mysql。</h1><h1 id="chmod-755-etc-rc-d-init-d-mysqld"><a href="#chmod-755-etc-rc-d-init-d-mysqld" class="headerlink" title="chmod 755 /etc/rc.d/init.d/mysqld"></a>chmod 755 /etc/rc.d/init.d/mysqld</h1><h1 id="chkconfig-–add-mysqld"><a href="#chkconfig-–add-mysqld" class="headerlink" title="chkconfig –add mysqld"></a>chkconfig –add mysqld</h1><p>#添加LIB PATH<br>echo “/usr/local/mysql/lib” &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig<br>vi /etc/my.cnf<br>修改 MySQL 配置，增加部分优化参数，如下：<br>[mysqld]<br>ft_min_word_len=2<br>运行以下命令即可启动 MySQL 服务器：</p>
<h1 id="etc-rc-d-init-d-mysqld-start-启动-MySQL"><a href="#etc-rc-d-init-d-mysqld-start-启动-MySQL" class="headerlink" title="/etc/rc.d/init.d/mysqld start //启动 MySQL"></a>/etc/rc.d/init.d/mysqld start //启动 MySQL</h1><h1 id="bin-mysqladmin-u-root-password-“password-for-root”"><a href="#bin-mysqladmin-u-root-password-“password-for-root”" class="headerlink" title="bin/mysqladmin -u root password “password_for_root”"></a>bin/mysqladmin -u root password “password_for_root”</h1><h1 id="service-mysqld-stop-关闭-MySQL"><a href="#service-mysqld-stop-关闭-MySQL" class="headerlink" title="service mysqld stop //关闭 MySQL"></a>service mysqld stop //关闭 MySQL</h1><p>8. 编译安装 Apache</p>
<h1 id="cd-usr-local-src-2"><a href="#cd-usr-local-src-2" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-www-ip97-com-apache-org-httpd-httpd-2-2-6-tar-gz"><a href="#wget-http-www-ip97-com-apache-org-httpd-httpd-2-2-6-tar-gz" class="headerlink" title="wget http://www.ip97.com/apache.org/httpd/httpd-2.2.6.tar.gz"></a>wget <a href="http://www.ip97.com/apache.org/httpd/httpd-2.2.6.tar.gz" target="_blank" rel="external">http://www.ip97.com/apache.org/httpd/httpd-2.2.6.tar.gz</a></h1><h1 id="tar-zxvf-httpd-2-2-6-tar-gz"><a href="#tar-zxvf-httpd-2-2-6-tar-gz" class="headerlink" title="tar zxvf httpd-2.2.6.tar.gz"></a>tar zxvf httpd-2.2.6.tar.gz</h1><h1 id="cd-httpd-2-2-6"><a href="#cd-httpd-2-2-6" class="headerlink" title="cd httpd-2.2.6"></a>cd httpd-2.2.6</h1><p>先依次安装apr和apr-util</p>
<h1 id="cd-srclib-apr"><a href="#cd-srclib-apr" class="headerlink" title="cd srclib/apr"></a>cd srclib/apr</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-apr-–enable-threads-–enable-other-child-–enable-static"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-apr-–enable-threads-–enable-other-child-–enable-static" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/apr –enable-threads –enable-other-child –enable-static"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/apr –enable-threads –enable-other-child –enable-static</h1><h1 id="make-amp-amp-make-install"><a href="#make-amp-amp-make-install" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><h1 id="cd-apr-util"><a href="#cd-apr-util" class="headerlink" title="cd ../apr-util"></a>cd ../apr-util</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-apr-util-–with-apr-usr-local-apr-–with-mysql-usr-local-mysql"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-apr-util-–with-apr-usr-local-apr-–with-mysql-usr-local-mysql" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/apr-util –with-apr=/usr/local/apr/ –with-mysql=/usr/local/mysql"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/apr-util –with-apr=/usr/local/apr/ –with-mysql=/usr/local/mysql</h1><h1 id="make-amp-amp-make-install-1"><a href="#make-amp-amp-make-install-1" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>cd /usr/local/src/httpd-2.2.6</p>
<h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-apache2-–enable-mods-shared-all-–with-mysql-usr-local-mysql-–enable-cache-–enable-file-cache-–enable-mem-cache-–enable-disk-cache-–enable-static-support-–enable-static-htpasswd-–enable-static-htdigest-–enable-static-rotatelogs-–enable-static-logresolve-–enable-static-htdbm-–enable-static-ab-–enable-static-checkgid-–disable-cgid-–disable-cgi-–with-apr-usr-local-apr-–with-apr-util-usr-local-apr-util-–enable-ssl-–with-ssl-usr-include-openssl-–with-pcre"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-apache2-–enable-mods-shared-all-–with-mysql-usr-local-mysql-–enable-cache-–enable-file-cache-–enable-mem-cache-–enable-disk-cache-–enable-static-support-–enable-static-htpasswd-–enable-static-htdigest-–enable-static-rotatelogs-–enable-static-logresolve-–enable-static-htdbm-–enable-static-ab-–enable-static-checkgid-–disable-cgid-–disable-cgi-–with-apr-usr-local-apr-–with-apr-util-usr-local-apr-util-–enable-ssl-–with-ssl-usr-include-openssl-–with-pcre" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/apache2 –enable-mods-shared=all –with-mysql=/usr/local/mysql –enable-cache –enable-file-cache –enable-mem-cache –enable-disk-cache –enable-static-support –enable-static-htpasswd –enable-static-htdigest –enable-static-rotatelogs –enable-static-logresolve –enable-static-htdbm –enable-static-ab –enable-static-checkgid –disable-cgid –disable-cgi –with-apr=/usr/local/apr/ –with-apr-util=/usr/local/apr-util/ –enable-ssl –with-ssl=/usr/include/openssl –with-pcre"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/apache2 –enable-mods-shared=all –with-mysql=/usr/local/mysql –enable-cache –enable-file-cache –enable-mem-cache –enable-disk-cache –enable-static-support –enable-static-htpasswd –enable-static-htdigest –enable-static-rotatelogs –enable-static-logresolve –enable-static-htdbm –enable-static-ab –enable-static-checkgid –disable-cgid –disable-cgi –with-apr=/usr/local/apr/ –with-apr-util=/usr/local/apr-util/ –enable-ssl –with-ssl=/usr/include/openssl –with-pcre</h1><h1 id="make-1"><a href="#make-1" class="headerlink" title="make"></a>make</h1><h1 id="make-install-1"><a href="#make-install-1" class="headerlink" title="make install"></a>make install</h1><p>注解：<br>./configure //配置源代码树<br>–prefix=/usr/local/apache2 //体系无关文件的顶级安装目录PREFIX ，也就Apache的安装目录。<br>–enable-module=so //打开 so 模块，so 模块是用来提 DSO 支持的 apache 核心模块<br>–enable-mods-shared=all //编译全部的模板，对于不需要我们可以在httpd.conf去掉。<br>–enable-cache //支持缓存<br>–enable-file-cache //支持文件缓存<br>–enable-mem-cache //支持记忆缓存<br>–enable-disk-cache //支持磁盘缓存<br>–enable-static-support //支持静态连接(默认为动态连接)<br>–enable-static-htpasswd //使用静态连接编译 htpasswd - 管理用于基本认证的用户文件<br>–enable-static-htdigest //使用静态连接编译 htdigest - 管理用于摘要认证的用户文件<br>–enable-static-rotatelogs //使用静态连接编译 rotatelogs - 滚动 Apache 日志的管道日志程序<br>–enable-static-logresolve //使用静态连接编译 logresolve - 解析 Apache 日志中的IP地址为主机名<br>–enable-static-htdbm //使用静态连接编译 htdbm - 操作 DBM 密码数据库<br>–enable-static-ab //使用静态连接编译 ab - Apache HTTP 服务器性能测试工具<br>–enable-static-checkgid //使用静态连接编译 checkgid<br>–disable-cgid //禁止用一个外部 CGI 守护进程执行CGI脚本<br>–disable-cgi //禁止编译 CGI 版本的 PHP<br>–enable-ssl // 编译 ssl模块。<br>我们不再使用worker模式编译apache，worker模式和php貌似有一些不协调不稳定之处。所以使用了默认的perfork模式。<br>将apache设置成开机自启动:<br>在/etc/rc.d/rc.local文件中加入一行<br>/usr/local/apache2/bin/apachectl start<br>这样每次重新启动系统以后,apache也会随系统一起启动.<br>或者将apache安装为系统服务</p>
<h1 id="cp-usr-local-apache2-bin-apachectl-etc-rc-d-init-d-httpd"><a href="#cp-usr-local-apache2-bin-apachectl-etc-rc-d-init-d-httpd" class="headerlink" title="cp /usr/local/apache2/bin/apachectl /etc/rc.d/init.d/httpd"></a>cp /usr/local/apache2/bin/apachectl /etc/rc.d/init.d/httpd</h1><p>然后 vi /etc/rc.d/init.d/httpd 添加(#!/bin/sh下面)</p>
<h1 id="chkconfig-2345-50-90"><a href="#chkconfig-2345-50-90" class="headerlink" title="chkconfig: 2345 50 90"></a>chkconfig: 2345 50 90</h1><h1 id="description-Activates-Deactivates-Apache-Web-Server"><a href="#description-Activates-Deactivates-Apache-Web-Server" class="headerlink" title="description: Activates/Deactivates Apache Web Server"></a>description: Activates/Deactivates Apache Web Server</h1><p>最后，运行chkconfig把Apache添加到系统的启动服务组里面：</p>
<h1 id="chkconfig-–add-httpd"><a href="#chkconfig-–add-httpd" class="headerlink" title="chkconfig –add httpd"></a>chkconfig –add httpd</h1><h1 id="chkconfig-httpd-on"><a href="#chkconfig-httpd-on" class="headerlink" title="chkconfig httpd on"></a>chkconfig httpd on</h1><p>9、编译php 5.2.5<br>Suhosin是php增强型安全补丁，可以编译到静态内核中，也可以编译成php动态扩展。我个人强烈你建议安装成静态内核。Suhosin已经进入 Gentoo Linux、FreeBSD、OpenSuSE Linux、Mandriva Linux、Debian Linux官方包。下面的以下先说静态安装步骤。当然你也可以在安装php后将它编译成php的动态扩展。</p>
<h1 id="cd-usr-local-src-3"><a href="#cd-usr-local-src-3" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-cn-php-net-get-php-5-2-5-tar-gz-from-this-mirror"><a href="#wget-http-cn-php-net-get-php-5-2-5-tar-gz-from-this-mirror" class="headerlink" title="wget http://cn.php.net/get/php-5.2.5.tar.gz/from/this/mirror"></a>wget <a href="http://cn.php.net/get/php-5.2.5.tar.gz/from/this/mirror" target="_blank" rel="external">http://cn.php.net/get/php-5.2.5.tar.gz/from/this/mirror</a></h1><p>wget <a href="http://www.hardened-php.net/suhosin/_media/suhosin-patch-5.2.5-0.9.6.2.patch.gz" target="_blank" rel="external">http://www.hardened-php.net/suhosin/_media/suhosin-patch-5.2.5-0.9.6.2.patch.gz</a></p>
<h1 id="tar-zxvf-php-5-2-5-tar-gz"><a href="#tar-zxvf-php-5-2-5-tar-gz" class="headerlink" title="tar zxvf php-5.2.5.tar.gz"></a>tar zxvf php-5.2.5.tar.gz</h1><h1 id="gunzip-suhosin-patch-5-2-5-0-9-6-2-patch-gz"><a href="#gunzip-suhosin-patch-5-2-5-0-9-6-2-patch-gz" class="headerlink" title="gunzip suhosin-patch-5.2.5-0.9.6.2.patch.gz"></a>gunzip suhosin-patch-5.2.5-0.9.6.2.patch.gz</h1><h1 id="cd-php-5-2-5"><a href="#cd-php-5-2-5" class="headerlink" title="cd php-5.2.5"></a>cd php-5.2.5</h1><h1 id="patch-p-1-i-suhosin-patch-5-2-5-0-9-6-2-patch"><a href="#patch-p-1-i-suhosin-patch-5-2-5-0-9-6-2-patch" class="headerlink" title="patch -p 1 -i ../suhosin-patch-5.2.5-0.9.6.2.patch"></a>patch -p 1 -i ../suhosin-patch-5.2.5-0.9.6.2.patch</h1><h1 id="buildconf-–force"><a href="#buildconf-–force" class="headerlink" title="./buildconf –force"></a>./buildconf –force</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-php-–with-apxs2-usr-local-apache2-bin-apxs-–with-pear-usr-share-php-–with-zlib-dir-–with-bz2-–with-libxml-dir-usr-–with-gd-usr-local-gd2-–enable-gd-native-ttf-–enable-gd-jis-conv-–with-freetype-dir-–with-jpeg-dir-–with-png-dir-–with-ttf-shared-usr-–enable-mbstring-–with-mysql-usr-local-mysql-–with-mysqli-usr-local-mysql-bin-mysql-config-–with-config-file-path-etc-–with-iconv-–disable-ipv6-–enable-static-–enable-zend-multibyte-–enable-inline-optimization-–enable-zend-multibyte-–enable-sockets-–enable-soap-–with-openssl-–with-gettext-–enable-suhosin"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-php-–with-apxs2-usr-local-apache2-bin-apxs-–with-pear-usr-share-php-–with-zlib-dir-–with-bz2-–with-libxml-dir-usr-–with-gd-usr-local-gd2-–enable-gd-native-ttf-–enable-gd-jis-conv-–with-freetype-dir-–with-jpeg-dir-–with-png-dir-–with-ttf-shared-usr-–enable-mbstring-–with-mysql-usr-local-mysql-–with-mysqli-usr-local-mysql-bin-mysql-config-–with-config-file-path-etc-–with-iconv-–disable-ipv6-–enable-static-–enable-zend-multibyte-–enable-inline-optimization-–enable-zend-multibyte-–enable-sockets-–enable-soap-–with-openssl-–with-gettext-–enable-suhosin" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/php –with-apxs2=/usr/local/apache2/bin/apxs –with-pear=/usr/share/php –with-zlib-dir –with-bz2 –with-libxml-dir=/usr –with-gd=/usr/local/gd2 –enable-gd-native-ttf –enable-gd-jis-conv –with-freetype-dir –with-jpeg-dir –with-png-dir –with-ttf=shared,/usr –enable-mbstring –with-mysql=/usr/local/mysql –with-mysqli=/usr/local/mysql/bin/mysql_config –with-config-file-path=/etc –with-iconv –disable-ipv6 –enable-static –enable-zend-multibyte –enable-inline-optimization –enable-zend-multibyte –enable-sockets –enable-soap –with-openssl –with-gettext –enable-suhosin"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/php –with-apxs2=/usr/local/apache2/bin/apxs –with-pear=/usr/share/php –with-zlib-dir –with-bz2 –with-libxml-dir=/usr –with-gd=/usr/local/gd2 –enable-gd-native-ttf –enable-gd-jis-conv –with-freetype-dir –with-jpeg-dir –with-png-dir –with-ttf=shared,/usr –enable-mbstring –with-mysql=/usr/local/mysql –with-mysqli=/usr/local/mysql/bin/mysql_config –with-config-file-path=/etc –with-iconv –disable-ipv6 –enable-static –enable-zend-multibyte –enable-inline-optimization –enable-zend-multibyte –enable-sockets –enable-soap –with-openssl –with-gettext –enable-suhosin</h1><p>配置成功会提示：<br>+——————————————————————–+<br>| License: |<br>| This software is subject to the PHP License, available in this |<br>| distribution in the file LICENSE. By continuing this installation |<br>| process, you are bound by the terms of this license agreement. |<br>| If you do not agree with the terms of this license, you must abort |<br>| the installation process at this point. |<br>+——————————————————————–+<br>Thank you for using PHP.</p>
<h1 id="make-2"><a href="#make-2" class="headerlink" title="make"></a>make</h1><h1 id="make-test"><a href="#make-test" class="headerlink" title="make test"></a>make test</h1><h1 id="make-install-2"><a href="#make-install-2" class="headerlink" title="make install"></a>make install</h1><h1 id="cp-php-ini-recommended-etc-php-ini"><a href="#cp-php-ini-recommended-etc-php-ini" class="headerlink" title="cp php.ini-recommended /etc/php.ini"></a>cp php.ini-recommended /etc/php.ini</h1><h1 id="echo-“-usr-local-php-lib”-gt-gt-etc-ld-so-conf-amp-amp-ldconfig"><a href="#echo-“-usr-local-php-lib”-gt-gt-etc-ld-so-conf-amp-amp-ldconfig" class="headerlink" title="echo “/usr/local/php/lib” &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig"></a>echo “/usr/local/php/lib” &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig</h1><p>在这里也顺便说一下将suhosin安装成为php的动态扩展的方法。毕竟网上根本不见它的中文安装教程。<br>虽然我个人不推荐这种方式。<br>wget <a href="http://www.hardened-php.net/suhosin/_media/suhosin-0.9.20.tgz" target="_blank" rel="external">http://www.hardened-php.net/suhosin/_media/suhosin-0.9.20.tgz</a><br>tar zxvf suhosin-0.9.20.tgz<br>cd suhosin-0.9.20<br>./configure –with-php-config=/usr/local/php/bin/php-config<br>make<br>make install<br>会提示编译的模块存在的目录，记住它。<br>Installing shared extensions: /usr/local/php/lib/php/extensions/no-debug-zts-20060613/<br>然后在php.ini中增加一行下列语句。<br>extension=”/usr/local/php/lib/php/extensions/no-debug-zts-20060613/suhosin.so”</p>
<p>10、整合apache 与php</p>
<h1 id="vi-usr-local-apache2-conf-httpd-conf"><a href="#vi-usr-local-apache2-conf-httpd-conf" class="headerlink" title="vi /usr/local/apache2/conf/httpd.conf"></a>vi /usr/local/apache2/conf/httpd.conf</h1><p>在最后一行加上：<br>AddType application/x-httpd-php .php<br>查找：(设置 WEB 默认文件)<br>DirectoryIndex index.html<br>修改为：<br>DirectoryIndex index.php index.html index.htm<br>找到这一段：</p>
<h1 id="AllowOverride-controls-what-directives-may-be-placed-in-htaccess-files"><a href="#AllowOverride-controls-what-directives-may-be-placed-in-htaccess-files" class="headerlink" title="AllowOverride controls what directives may be placed in .htaccess files."></a>AllowOverride controls what directives may be placed in .htaccess files.</h1><h1 id="It-can-be-“All”-“None”-or-any-combination-of-the-keywords"><a href="#It-can-be-“All”-“None”-or-any-combination-of-the-keywords" class="headerlink" title="It can be “All”, “None”, or any combination of the keywords:"></a>It can be “All”, “None”, or any combination of the keywords:</h1><h1 id="Options-FileInfo-AuthConfig-Limit"><a href="#Options-FileInfo-AuthConfig-Limit" class="headerlink" title="Options FileInfo AuthConfig Limit"></a>Options FileInfo AuthConfig Limit</h1><p>#<br>AllowOverride none<br>更改为AllowOverride all<br>允许apache rewrite<br>保存httpd.conf，退出。</p>
<h1 id="usr-local-apache2-bin-apachectl-restart-重启-Apache"><a href="#usr-local-apache2-bin-apachectl-restart-重启-Apache" class="headerlink" title="/usr/local/apache2/bin/apachectl restart //重启 Apache"></a>/usr/local/apache2/bin/apachectl restart //重启 Apache</h1><p>这时会出现错误：<br>/usr/local/apache2/bin/apachectl start<br>httpd: Syntax error on line 107 of /usr/local/apache2/conf/httpd.conf: Cannot load /usr/local/apache2/modules/libphp5.so into server: /usr/local/apache2/modules/libphp5.so: cannot restore segment prot after reloc: Permission denied<br>不急，我们慢慢解决。<br>这个Permission denied问题，在centos 5下面一般是Selinux引起的，作为生产用服务器，我建议你千万别草率地关掉Selinux一了百了。就像家里的防盗网，阻碍了你的猫自由进出窗户，你不能为了猫方便，就把防盗网简单拆除是同样的道理。我看见网上许多人建议把Selinux简单关闭来解决这个问题，这是削足适履的做法，不值得提倡。<br>我们可以这样操作：</p>
<h1 id="audit2allow-a-查看究竟问题出在什么地方"><a href="#audit2allow-a-查看究竟问题出在什么地方" class="headerlink" title="audit2allow -a //查看究竟问题出在什么地方"></a>audit2allow -a //查看究竟问题出在什么地方</h1><p>&lt;no matches&gt;<br>allow unconfined_t usr_t:file execmod;<br>allow useradd_t var_log_t:file { read write };<br>然后</p>
<h1 id="cd-etc-selinux-targeted-modules"><a href="#cd-etc-selinux-targeted-modules" class="headerlink" title="cd /etc/selinux/targeted/modules/"></a>cd /etc/selinux/targeted/modules/</h1><h1 id="audit2allow-M-local-d"><a href="#audit2allow-M-local-d" class="headerlink" title="audit2allow -M local -d"></a>audit2allow -M local -d</h1><p>屏幕产生如下提示：<br>Generating type enforcment file: local.te<br>Compiling policy<br>checkmodule -M -m -o local.mod local.te<br>semodule_package -o local.pp -m local.mod<br><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong> IMPORTANT <strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong><br>In order to load this newly created policy package into the kernel,<br>you are required to execute<br>semodule -i local.pp<br>我们运行</p>
<h1 id="semodule-i-local-pp"><a href="#semodule-i-local-pp" class="headerlink" title="semodule -i local.pp"></a>semodule -i local.pp</h1><p>这样就让Selinux加载了新的规则。<br>更详细的内容请看我在BLOG上的转贴：<br><a href="http://www.cnprint.org/bbs/blogs/1/blog48.html" target="_blank" rel="external">http://www.cnprint.org/bbs/blogs/1/blog48.html</a><br>重启apache<br>哈哈，apache不会再报错了吧？<br>这样我保留了selinux的功能，同时apache也能正常运行。<br>PHP5.1.x开始需要设置时区，默认时区与中国时区差8个小时，这种情况需要在php.ini中这么设置,找到date.timezone，去掉前面的分号，修改为以下值，大陆地区可用的值是：Asia/Chongqing ，Asia/Shanghai ，Asia/Urumqi （依次为重庆，上海，乌鲁木齐）<br>不然一些php程序的时间老是和中国标准时间相差8个小时。我的我的VBB论坛在windows上就是这样。这儿有亚洲地区的对应时区。<br><a href="http://www.php.net/manual/en/timezones.asia.php" target="_blank" rel="external">http://www.php.net/manual/en/timezones.asia.php</a><br>11、安装 Zend Optimizer</p>
<h1 id="cd-usr-local-src-4"><a href="#cd-usr-local-src-4" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-downloads-zend-com-optimizer-3-3-0-ZendOptimizer-3-3-0-linux-glibc21-i386-tar-gz"><a href="#wget-http-downloads-zend-com-optimizer-3-3-0-ZendOptimizer-3-3-0-linux-glibc21-i386-tar-gz" class="headerlink" title="wget http://downloads.zend.com/optimizer/3.3.0/ZendOptimizer-3.3.0-linux-glibc21-i386.tar.gz"></a>wget <a href="http://downloads.zend.com/optimizer/3.3.0/ZendOptimizer-3.3.0-linux-glibc21-i386.tar.gz" target="_blank" rel="external">http://downloads.zend.com/optimizer/3.3.0/ZendOptimizer-3.3.0-linux-glibc21-i386.tar.gz</a></h1><h1 id="tar-xzvf-ZendOptimizer-3-3-0-linux-glibc21-i386-tar-gz"><a href="#tar-xzvf-ZendOptimizer-3-3-0-linux-glibc21-i386-tar-gz" class="headerlink" title="tar xzvf ZendOptimizer-3.3.0-linux-glibc21-i386.tar.gz"></a>tar xzvf ZendOptimizer-3.3.0-linux-glibc21-i386.tar.gz</h1><h1 id="ZendOptimizer-3-3-0-linux-glibc21-i386-install-sh"><a href="#ZendOptimizer-3-3-0-linux-glibc21-i386-install-sh" class="headerlink" title="./ZendOptimizer-3.3.0-linux-glibc21-i386/install.sh"></a>./ZendOptimizer-3.3.0-linux-glibc21-i386/install.sh</h1><p>按照它的提示一步步进行就行了。<br>总之一句话。如果你的服务器环境不需要ZendOptimizer，那么能不安就不安装这个。避免和eaccelerator冲突。<br>12. 查看确认 L.A.M.P 环境信息<br>vi /usr/local/apache2/htdocs/phpinfo.php<br>新增加下面一行，并保存。<br>&lt;?php phpinfo(); ?&gt;</p>
<h1 id="chmod-755-usr-local-apache2-htdocs-phpinfo-php"><a href="#chmod-755-usr-local-apache2-htdocs-phpinfo-php" class="headerlink" title="chmod 755 /usr/local/apache2/htdocs/phpinfo.php"></a>chmod 755 /usr/local/apache2/htdocs/phpinfo.php</h1><p>用浏览器打开 <a href="http://192.168.9.150/phpinfo.php" target="_blank" rel="external">http://192.168.9.150/phpinfo.php</a><br>检查 phpinfo中的各项信息是否正确。<br>测试php与mysql的连接</p>
<h1 id="vi-usr-local-apache2-htdocs-testdb-php"><a href="#vi-usr-local-apache2-htdocs-testdb-php" class="headerlink" title="vi /usr/local/apache2/htdocs/testdb.php"></a>vi /usr/local/apache2/htdocs/testdb.php</h1><p>增加下面几行，并保存。<br>&lt;?php<br>$link=mysql_connect(‘localhost’,’root’,’yourpassword’);<br>if(!$link) echo “fail”;<br>else echo “success”;<br>mysql_close();<br>?&gt;</p>
<h1 id="chmod-755-usr-local-apache2-htdocs-testdb-php"><a href="#chmod-755-usr-local-apache2-htdocs-testdb-php" class="headerlink" title="chmod 755 /usr/local/apache2/htdocs/testdb.php"></a>chmod 755 /usr/local/apache2/htdocs/testdb.php</h1><h1 id="service-mysqld-start"><a href="#service-mysqld-start" class="headerlink" title="service mysqld start"></a>service mysqld start</h1><p>用浏览器打开 <a href="http://192.168.9.150/testdb.php" target="_blank" rel="external">http://192.168.9.150/testdb.php</a><br>如果输出success就OK了<br>到这一步，一个基本的lamp就建立完成了。如果你是初学者，下面的步骤根据需要参考，不必全部照做，记住一句话，功能越多，越容易出错，在任何领域都是这样。</p>
<p>三、LAMP环境加速，包括squid, memcache, eaccelerator<br>13、安装eaccelerator<br>eaccelerator是php的加速软件，使用后php的执行效率会有较大幅度的提升。目前eaccelerator 0.9.5.2已经和ZendOptimizer-3.3.0能够基本上兼容啦。不过我个人觉得，ZendOptimizer-3.3.0没有加速的功能，反而使php运行变慢，只是起到了运行zend加密文件的作用而已。闲话不多说了，大家有兴趣的，可以去google下。</p>
<h1 id="cd-usr-local-src-5"><a href="#cd-usr-local-src-5" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-bart-eaccelerator-net-source-0-9-5-2-eaccelerator-0-9-5-2-tar-bz2"><a href="#wget-http-bart-eaccelerator-net-source-0-9-5-2-eaccelerator-0-9-5-2-tar-bz2" class="headerlink" title="wget http://bart.eaccelerator.net/source/0.9.5.2/eaccelerator-0.9.5.2.tar.bz2"></a>wget <a href="http://bart.eaccelerator.net/source/0.9.5.2/eaccelerator-0.9.5.2.tar.bz2" target="_blank" rel="external">http://bart.eaccelerator.net/source/0.9.5.2/eaccelerator-0.9.5.2.tar.bz2</a></h1><h1 id="tar-jxvf-eaccelerator-0-9-5-2-tar-bz2"><a href="#tar-jxvf-eaccelerator-0-9-5-2-tar-bz2" class="headerlink" title="tar -jxvf eaccelerator-0.9.5.2.tar.bz2"></a>tar -jxvf eaccelerator-0.9.5.2.tar.bz2</h1><h1 id="cd-eaccelerator-0-9-5-2"><a href="#cd-eaccelerator-0-9-5-2" class="headerlink" title="cd eaccelerator-0.9.5.2"></a>cd eaccelerator-0.9.5.2</h1><p>export PHP_PREFIX=”/usr/local/php”<br>$PHP_PREFIX/bin/phpize //指定一下php的目录</p>
<h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–enable-eaccelerator-shared-–with-php-config-PHP-PREFIX-bin-php-config-–with-eaccelerator-shared-memory-设置"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–enable-eaccelerator-shared-–with-php-config-PHP-PREFIX-bin-php-config-–with-eaccelerator-shared-memory-设置" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –enable-eaccelerator=shared –with-php-config=$PHP_PREFIX/bin/php-config –with-eaccelerator-shared-memory // 设置"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –enable-eaccelerator=shared –with-php-config=$PHP_PREFIX/bin/php-config –with-eaccelerator-shared-memory // 设置</h1><h1 id="make-amp-make-install"><a href="#make-amp-make-install" class="headerlink" title="make &amp; make install"></a>make &amp; make install</h1><p>编译安装后我们会看到屏幕提示的eaccelerator.so所在的目录，php5.2.X系列是在 /usr/local/php/lib/php/extensions/no-debug-zts-20060613/eaccelerator.so，记住这个路径，待会要用到。<br>修改php.ini（安装完zend之后，php.ini存放于/usr/local/Zend/etc）<br>在文件最后，zend之前，注意，这部分内容务必放在zend之前，不然可能会出现不可预期的服务器问题。添加下列信息：<br>[eaccelerator]<br>extension=”/usr/local/php/lib/php/extensions/no-debug-zts-20060613/eaccelerator.so”<br>eaccelerator.shm_size=”32”<br>eaccelerator.cache_dir=”/tmp/eaccelerator”<br>eaccelerator.enable=”1”<br>eaccelerator.optimizer=”1”<br>eaccelerator.check_mtime=”1”<br>eaccelerator.debug=”0”<br>eaccelerator.filter=””<br>eaccelerator.shm_max=”0”<br>eaccelerator.shm_ttl=”0”<br>eaccelerator.shm_prune_period=”0”<br>eaccelerator.shm_only=”0”<br>eaccelerator.compress=”1”<br>eaccelerator.compress_level=”9”<br>然后</p>
<h1 id="mkdir-tmp-eaccelerator-建立目录"><a href="#mkdir-tmp-eaccelerator-建立目录" class="headerlink" title="mkdir /tmp/eaccelerator // 建立目录"></a>mkdir /tmp/eaccelerator // 建立目录</h1><h1 id="chmod-0777-tmp-eaccelerator-修改目录属性"><a href="#chmod-0777-tmp-eaccelerator-修改目录属性" class="headerlink" title="chmod 0777 /tmp/eaccelerator // 修改目录属性"></a>chmod 0777 /tmp/eaccelerator // 修改目录属性</h1><p>解释:<br>zend_extension 是安装完程序自动指示给我们的文件路径和文件名<br>如果您使用 thread safe 编译安装 PHP，则您必须使用 “zend_extension_ts” 代替 默认添加的“zend_extension”。我就必须修改这里，否则不起作用。<br>zend_extension_ts=”/home/php/lib/php/extensions/no-debug-zts-20060613/eaccelerator.so”<br>实际上，安装好eAccelerator以后， /home/php/lib/php/extensions/下会生成2个目录，一个是no-debug-zts-xxxxxxxx，一个是no- debug-non-zts-xxxxxxxx，2个目录下都有eaccelerator.so文件。<br>eaccelerator.shm_size=”32”<br>eAccelerator 可以使用的共享内存的数量 (以兆为单位) . “0” 是指操作系统的默认值. 默认值是 “0”.可根据服务器的实际情况来调整，16，32，64，128都是可以的。<br>eaccelerator.cache_dir=”/home/php/tmp”<br>这个目录是给磁盘缓存使用. eAccelerator 在这里储存预先编译好的代码, 进程数据, 内容以及用户的自定义内容. 同样的数据也能被储存在共享内存中 (这样可以提高访问速度). 默认的设置是 “/tmp/eaccelerator”.<br>eaccelerator.enable=”1”<br>开启或关闭 eAccelerator。”1″ 为开启，”0″ 为关闭。默认值为 “1″。<br>eaccelerator.optimizer=”1”<br>启或关闭内部优化器，可以提升代码执行速度。”1″ 为开启，”0″ 为关闭。默认值为 “1″。<br>eaccelerator.check_mtime=”1”<br>打开或者关闭 PHP 的文件修改检查. “1” 是指打开, “0” 是指关闭. 如果您在修改以后重新编译 PHP 的文件,那么您应当设置为 “1”. 默认值是 “1”.<br>eaccelerator.debug=”0”<br>开启或关闭调试日志记录。”1″ 为开启，”0″ 为关闭。默认值为 “0″。<br>eaccelerator.filter=””<br>判断哪些 PHP 文件必须缓存。您可以指定缓存和不缓存的文件类型（如 “<em>.php </em>.phtml”等）<br>如果参数以 “!” 开头，则匹配这些参数的文件被忽略缓存。默认值为 “”，即，所有 PHP 文件<br>都将被缓存。<br>eaccelerator.shm_max=”0”<br>当使用 ” eaccelerator_put() ” 函数时禁止其向共享内存中存储过大的文件。该参数指定允许<br>存储的最大值，单位：字节 (10240, 10K, 1M)。”0″ 为不限制。默认值为 “0″。<br>eaccelerator.shm_ttl=”0”<br>当 eAccelerator 获取新脚本的共享内存大小失败时，它将从共享内存中删除所有在<br>最后 “shm_ttl” 秒内无法存取的脚本缓存。默认值为 “0″，即：不从共享内春中删除<br>任何缓存文件。<br>eaccelerator.shm_prune_period=”0”<br>当 eAccelerator 获取新脚本的共享内存大小失败时，他将试图从共享内存中删除早于<br>“shm_prune_period” 秒的缓存脚本。默认值为 “0″，即：不从共享内春中删除<br>任何缓存文件。<br>eaccelerator.shm_only=”0”<br>允许或禁止将已编译脚本缓存在磁盘上。该选项对 session 数据和内容缓存无效。默认<br>值为 “0″，即：使用磁盘和共享内存进行缓存。<br>eaccelerator.compress=”1”<br>允许或禁止压缩内容缓存。默认值为 “1″，即：允许压缩。<br>eaccelerator.compress_level=”9”<br>指定内容缓存的压缩等级。默认值为 “9″，为最高等级。<br>最后重新启动apachectl<br>重启apache，phpinfo显示：<br>This program makes use of the Zend Scripting Language Engine:<br>Zend Engine v2.2.0, Copyright (c) 1998-2006 Zend Technologies<br>with eAccelerator v0.9.5.2, Copyright (c) 2004-2006 eAccelerator, by eAccelerator<br>with Zend Extension Manager v1.0.11, Copyright (c) 2003-2006, by Zend Technologies<br>with Zend Optimizer v3.3.0, Copyright (c) 1998-2006, by Zend Technologies<br>也会有eAccelerator的具体信息。</p>
<p>14、安装Squid，提供web反向代理缓存<br>Squid是一个更专业的代理服务器，性能和效率会比Apache的mod_proxy高很多。<br>Squid Internet Object Cache (Harvest Project的后续版本) 是美国政府大力助的一项研究计划，其目的为解决网络带宽不足的问题，是现在Unix系统上使用者最多功能也最完整的一套软体。Apache和 Netscape虽附有相关的Proxy模块，但因其功能简单而不够普及。有关squid的详细说明可到squid网站(http: //www.squid-cache.org)查询。<br>反向代理是和前两种代理完全不同的一种代理服务。使用它可以降低原始WEB服务器的负载。反向代理服务器承担了对原始WEB服务器的静态页面的请求，防止原始服务器过载。它位于本地WEB服务器和Internet之间，处理所有对WEB服务器的请求，组织了WEB服务器和Internet的直接通信。如果互联网用户请求的页面在代理服务器上有缓冲的话，代理服务器直接将缓冲内容发送给用户。如果没有缓冲则先向WEB服务器发出请求，取回数据，本地缓存后再发送给用户。这种方式通过降低了向WEB服务器的请求数从而降低了WEB服务器的负载。<br>下载squid</p>
<h1 id="wget-http-www-squid-cache-org-Versions-v2-2-6-squid-2-6-STABLE16-tar-bz2"><a href="#wget-http-www-squid-cache-org-Versions-v2-2-6-squid-2-6-STABLE16-tar-bz2" class="headerlink" title="wget http://www.squid-cache.org/Versions/v2/2.6/squid-2.6.STABLE16.tar.bz2"></a>wget <a href="http://www.squid-cache.org/Versions/v2/2.6/squid-2.6.STABLE16.tar.bz2" target="_blank" rel="external">http://www.squid-cache.org/Versions/v2/2.6/squid-2.6.STABLE16.tar.bz2</a></h1><h1 id="tar-jxvf-squid-2-6-STABLE16-tar-bz2"><a href="#tar-jxvf-squid-2-6-STABLE16-tar-bz2" class="headerlink" title="tar jxvf squid-2.6.STABLE16.tar.bz2"></a>tar jxvf squid-2.6.STABLE16.tar.bz2</h1><h1 id="cd-squid-2-6-STABLE16"><a href="#cd-squid-2-6-STABLE16" class="headerlink" title="cd squid-2.6.STABLE16"></a>cd squid-2.6.STABLE16</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-squid-–enable-async-io-500-–with-maxfd-65536-–disable-delay-pools-–disable-mem-gen-trace-–disable-useragent-log-–enable-kill-parent-hack-–disable-arp-acl-–enable-epoll-–disable-ident-lookups-–enable-snmp-–enable-large-cache-files-–with-large-files-–with-pthreads-–enable-underscore-–enable-storeio-”aufs-coss-diskd-ufs”-–enable-err-language-”Simplify-Chinese”-–enable-default-err-languages-”Simplify-Chinese”"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-squid-–enable-async-io-500-–with-maxfd-65536-–disable-delay-pools-–disable-mem-gen-trace-–disable-useragent-log-–enable-kill-parent-hack-–disable-arp-acl-–enable-epoll-–disable-ident-lookups-–enable-snmp-–enable-large-cache-files-–with-large-files-–with-pthreads-–enable-underscore-–enable-storeio-”aufs-coss-diskd-ufs”-–enable-err-language-”Simplify-Chinese”-–enable-default-err-languages-”Simplify-Chinese”" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/squid –enable-async-io=500 –with-maxfd=65536 –disable-delay-pools –disable-mem-gen-trace –disable-useragent-log –enable-kill-parent-hack –disable-arp-acl –enable-epoll –disable-ident-lookups –enable-snmp –enable-large-cache-files –with-large-files –with-pthreads –enable-underscore –enable-storeio=”aufs,coss,diskd,ufs” –enable-err-language=”Simplify_Chinese” –enable-default-err-languages=”Simplify_Chinese”"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/squid –enable-async-io=500 –with-maxfd=65536 –disable-delay-pools –disable-mem-gen-trace –disable-useragent-log –enable-kill-parent-hack –disable-arp-acl –enable-epoll –disable-ident-lookups –enable-snmp –enable-large-cache-files –with-large-files –with-pthreads –enable-underscore –enable-storeio=”aufs,coss,diskd,ufs” –enable-err-language=”Simplify_Chinese” –enable-default-err-languages=”Simplify_Chinese”</h1><h1 id="make-amp-amp-make-install-2"><a href="#make-amp-amp-make-install-2" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>如果是2.6的内核，才能支持epoll的IO模式，旧版本的内核则只能选择poll或其他模式了;另外，记得带上支持大文件的选项，否则在access log等文件达到2G的时候就会报错。<br>设定 squid 的配置大概如下内容：</p>
<h1 id="mv-usr-local-squid-etc-squid-conf-usr-local-squid-etc-squid-conf-bak"><a href="#mv-usr-local-squid-etc-squid-conf-usr-local-squid-etc-squid-conf-bak" class="headerlink" title="mv /usr/local/squid/etc/squid.conf /usr/local/squid/etc/squid.conf.bak"></a>mv /usr/local/squid/etc/squid.conf /usr/local/squid/etc/squid.conf.bak</h1><h1 id="vi-usr-local-squid-etc-squid-conf"><a href="#vi-usr-local-squid-etc-squid-conf" class="headerlink" title="vi /usr/local/squid/etc/squid.conf"></a>vi /usr/local/squid/etc/squid.conf</h1><p>#服务器IP 192.168.9.150</p>
<p>#监听服务器的80端口，反向代理，支持域名和IP的虚拟主机<br>http_port 192.168.9.150:80 vhost vport</p>
<p>#防止天涯盗链，转嫁给百度<br>acl tianya referer_regex -i tianya<br>http_access deny tianya<br>deny_info <a href="http://www.baidu.com/logs.gif" target="_blank" rel="external">http://www.baidu.com/logs.gif</a> tianya</p>
<p>#防止百度机器人爬死服务器，这将导致百度不能收录你的网站内容，请注意<br>acl AntiBaidu req_header User-Agent Baiduspider<br>http_access deny AntiBaidu</p>
<p>#Squid信息设置<br>visible_hostname www.cnprint.org<br>cache_mgr admin@cnprint.org</p>
<p>#squid使用的用户组和用户名<br>cache_effective_user nobody<br>cache_effective_group nobody<br>tcp_recv_bufsize 65535 bytes<br>client_persistent_connections off<br>server_persistent_connections on<br>half_closed_clients off</p>
<p>#单台使用，不使用该功能<br>icp_port 0</p>
<p>#设置Squid所能使用的内存共40MB，这个值因人而异，每次处理缓存大小为40MB，当缓存空间使用达到95%时新的内容将取代旧的而不直接添加到目录中，直到空间又下降到90%才停止这一活动<br>cache_mem 40 MB<br>cache_swap_low 90<br>cache_swap_high 95</p>
<p>#最大缓存文件大小，超过这个值则不缓存，这个值因人而异，maximum_object_size_in_memory #装入内存缓存的文件大小，这个值对Squid的性能影响比较大，因为默认值是8K,超过8K的文件都不装入内存，而实际应用中很多网页和图片等都超过 8KB, 个人认为如果缓存不装入内存而存在磁盘上，性能和apache直接读取磁盘文件没什么区别，甚至不如直接访问apache，现在设置成小于4兆的文件通通装入内存缓存.<br>maximum_object_size 4096 KB<br>minimum_object_size 0 KB<br>maximum_object_size_in_memory 4096 KB<br>ipcache_size 1024<br>ipcache_low 90<br>ipcache_high 95<br>cache_replacement_policy lru<br>memory_replacement_policy lru</p>
<p>#磁盘缓存的类型和目录，大小，一二级目录的设置，这里磁盘缓存大小是100MB，都是 16*256 级子目录<br>cache_dir ufs /usr/local/squid/var/cache 100 16 256</p>
<p>#这个设置是不记录store.log<br>cache_store_log none</p>
<p>#设置默认刷新规则<br>refresh_pattern -i ^ftp: 1440 20% 10080<br>refresh_pattern -i ^gopher: 1440 0% 1440<br>refresh_pattern . 0 20% 4320</p>
<p>#不要相信ETag 因为有gzip<br>acl apache rep_header Server ^Apache<br>broken_vary_encoding allow apache</p>
<p>#设置超时策略<br>forward_timeout 20 seconds<br>connect_timeout 15 seconds<br>read_timeout 3 minutes<br>request_timeout 1 minutes<br>persistent_request_timeout 15 seconds<br>client_lifetime 15 minutes<br>shutdown_lifetime 5 seconds<br>negative_ttl 10 seconds</p>
<p>#打开emulate_httpd_log选项,将使Squid仿照Aapche的日志格式<br>emulate_httpd_log on</p>
<p>#日志格式combined的设置<br>logformat combined %&gt;a %ui %un [%tl] “%rm %ru HTTP/%rv” %Hs %&lt;st “%{Referer}&gt;h” “%{User-Agent}&gt;h” %Ss:%Sh</p>
<p>#这里是设置pid和日志文件的位置，因人而异，同时日志格式是combined，awstats可以直接调用分析了<br>pid_filename /usr/local/squid/var/squid.pid<br>cache_log /usr/local/squid/var/logs/cache.log<br>access_log /usr/local/squid/var/logs/access.log combined</p>
<p>#设置不想缓存的目录或者文件类型<br>acl all src 0.0.0.0/0.0.0.0<br>acl QUERY urlpath_regex cgi-bin .php .cgi .avi .wmv .rm .ram .mpg .mpeg .zip .exe<br>cache deny QUERY</p>
<p>#2.6的反向代理加速配置</p>
<p>#代理到本机的80端口的服务，仅仅做为原始内容服务器<br>cache_peer 127.0.0.1 parent 80 0 no-query originserver login=PASS</p>
<p>#错误文档<br>error_directory /usr/local/squid/share/errors/Simplify_Chinese<br>保存。<br>mkdir /usr/local/squid/var/cache<br>chown -R nobody:nobody /usr/local/squid/var/cache<br>chown -R nobody:nobody /usr/local/squid/var/logs/<br>chmod 777 /usr/local/squid/var/cache<br>修改httpd.conf<br>初始化和启动squid</p>
<h1 id="usr-local-squid-sbin-squid-z"><a href="#usr-local-squid-sbin-squid-z" class="headerlink" title="/usr/local/squid/sbin/squid -z"></a>/usr/local/squid/sbin/squid -z</h1><h1 id="usr-local-squid-sbin-squid-NCd1"><a href="#usr-local-squid-sbin-squid-NCd1" class="headerlink" title="/usr/local/squid/sbin/squid -NCd1"></a>/usr/local/squid/sbin/squid -NCd1</h1><p>第一条命令是先初始化squid缓存哈希子目录，只需执行一次即可。<br>最好还编辑/etc/hosts 文件<br>添加以下内容<br>192.168.9.150 cnprint.org www cnprint.org<br>这样免去查询DNS，速度也快一些。<br>现在大家肯定急着要打开浏览器访问你的网站看看效果吧，其实没啥变化，要等到有流量访问，squid把文件都装到内存后，效果才明显。可以用top命令观察squid的内存使用情况或者用<br>cat /usr/local/squid/var/logs/access.log |grep TCP_MEM_HIT<br>如果看到很多的TCP_MEM_HIT ，这表明该文件是从内存缓存读取的，squid已经起作用了！你再用浏览器打开该文件，应该是快如闪电了。。呵呵，大功告成了！还有其他类型的HIT，如 TCP_HIT等等，这些是从磁盘读取的，我觉得加速的意义不大，只不过缓解了apache的压力而已。<br>3. 启动squid：./bin/RunCache &amp;<br>这边我使用squid附带的启动脚本来启动squid，有个好处就是，如果squid的进程死了的话，这个脚本会自动启动squid，对于运行在线上的服务器来说，这点太重要了。<br>开机自动运行squid<br>修改开机自动运行文件，将 /usr/local/squid/bin/RunCache &amp; 加进开机自动执行的程序中。<br>因为第一次是以 root 身份启动，所以，/usr/local/squid/var/squid.out 及 /usr/local/squid/var/squid.pid 的拥有者是 root ，这会造成下列以 nobody 身份启动 squid 时，会有错误出现，所以，必须在第二次由 rc.local 启动前，先行将 squid.out 及 squid.pid 两个文件的所有者(owner)改为 nobody，即是<br>chown nobody:nobody /usr/local/squid/var/squid.out<br>chown nobody:nobody /usr/local/squid/var/logs/squid.pid<br>在 /etc/rc.d/rc.local 中加入<br>/usr/local/squid/bin/RunCache &amp;</p>
<p>15、memcache + libevent 安装<br>memcached是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的hash表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。最初为了加速 LiveJournal 访问速度而开发的,后来被很多大型的网站采用。起初作者编写它可能是为了提高动态网页应用，为了减轻数据库检索的压力，来做的这个缓存系统。它的缓存是一种分布式的，也就是可以允许不同主机上的多个用户同时访问这个缓存系统，这种方法不仅解决了共享内存只能是单机的弊端，同时也解决了数据库检索的压力，最大的优点是提高了访问获取数据的速度！基于memcached作者对分布式cache的理解和解决方案。 memcached完全可以用到其他地方比如分布式数据库，分布式计算等领域。<br>Memcache是danga.com的一个项目，最早是为 LiveJournal 服务的，目前全世界不少人使用这个缓存项目来构建自己大负载的网站，来分担数据库的压力。（关于Memcache的更多信息请Google）<br>Memcache官方网站：<a href="http://www.danga.com/memcached" target="_blank" rel="external">http://www.danga.com/memcached</a><br>服务器端主要是安装memcache服务器端，目前的最新版本是 memcached-1.2.3。<br>另外，Memcache用到了libevent这个库用于Socket的处理，所以还需要安装libevent，libevent的最新版本是libevent-1.3e。（如果你的系统已经安装了libevent，可以不用安装）<br>官网：<a href="http://www.monkey.org/~provos/libevent/" target="_blank" rel="external">http://www.monkey.org/~provos/libevent/</a><br>（１）、安装memcached服务器端<br>编译安装：</p>
<h1 id="cd-usr-local-src-6"><a href="#cd-usr-local-src-6" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-monkey-org-provos-libevent-1-3e-tar-gz"><a href="#wget-http-monkey-org-provos-libevent-1-3e-tar-gz" class="headerlink" title="wget http://monkey.org/~provos/libevent-1.3e.tar.gz"></a>wget <a href="http://monkey.org/~provos/libevent-1.3e.tar.gz" target="_blank" rel="external">http://monkey.org/~provos/libevent-1.3e.tar.gz</a></h1><h1 id="tar-zxvf-libevent-1-3e-tar-gz"><a href="#tar-zxvf-libevent-1-3e-tar-gz" class="headerlink" title="tar zxvf libevent-1.3e.tar.gz"></a>tar zxvf libevent-1.3e.tar.gz</h1><h1 id="cd-libevent-1-3e"><a href="#cd-libevent-1-3e" class="headerlink" title="cd libevent-1.3e"></a>cd libevent-1.3e</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-amp-amp-make-amp-amp-make-install"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-amp-amp-make-amp-amp-make-install" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local &amp;&amp; make &amp;&amp; make install"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local &amp;&amp; make &amp;&amp; make install</h1><h1 id="echo-“-usr-local-lib”-gt-gt-etc-ld-so-conf-amp-amp-ldconfig"><a href="#echo-“-usr-local-lib”-gt-gt-etc-ld-so-conf-amp-amp-ldconfig" class="headerlink" title="echo “/usr/local/lib” &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig"></a>echo “/usr/local/lib” &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig</h1><h1 id="cd"><a href="#cd" class="headerlink" title="cd ../"></a>cd ../</h1><h1 id="wget-http-www-danga-com-memcached-dist-memcached-1-2-3-tar-gz"><a href="#wget-http-www-danga-com-memcached-dist-memcached-1-2-3-tar-gz" class="headerlink" title="wget http://www.danga.com/memcached/dist/memcached-1.2.3.tar.gz"></a>wget <a href="http://www.danga.com/memcached/dist/memcached-1.2.3.tar.gz" target="_blank" rel="external">http://www.danga.com/memcached/dist/memcached-1.2.3.tar.gz</a></h1><h1 id="tar-zxvf-memcached-1-2-3-tar-gz"><a href="#tar-zxvf-memcached-1-2-3-tar-gz" class="headerlink" title="tar zxvf memcached-1.2.3.tar.gz"></a>tar zxvf memcached-1.2.3.tar.gz</h1><h1 id="cd-memcached-1-2-3"><a href="#cd-memcached-1-2-3" class="headerlink" title="cd memcached-1.2.3"></a>cd memcached-1.2.3</h1><h1 id="CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-memcached-–with-libevent-usr-local"><a href="#CHOST-”i686-pc-linux-gnu”-CFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-mcpu-pentium4-march-pentium4-pipe-fomit-frame-pointer”-CXXFLAGS-”-O3-msse2-mmmx-Wall-W-mfpmath-sse-funroll-loops-mcpu-pentium4-march-pentium4-pipe-felide-constructors-fno-exceptions-fno-rtti-fomit-frame-pointer”-configure-–prefix-usr-local-memcached-–with-libevent-usr-local" class="headerlink" title="CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/memcached –with-libevent=/usr/local"></a>CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –prefix=/usr/local/memcached –with-libevent=/usr/local</h1><h1 id="make-amp-amp-make-install-3"><a href="#make-amp-amp-make-install-3" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>备注：如果 libevent 不是安装在 /usr 目录下，那么需要把 libevent-1.3e.so.1 拷贝/链接到 /usr/lib 中，否则 memcached 有可能无法正常加载。<br>（２）、安装php对memcache支持模块<br>安装php-memcache模块，这是memcache的php客户端，php-memcache需要pecl库的支持。</p>
<h1 id="cd-usr-local-src-7"><a href="#cd-usr-local-src-7" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-pecl-php-net-get-memcache-2-2-0-tgz"><a href="#wget-http-pecl-php-net-get-memcache-2-2-0-tgz" class="headerlink" title="wget http://pecl.php.net/get/memcache-2.2.0.tgz"></a>wget <a href="http://pecl.php.net/get/memcache-2.2.0.tgz" target="_blank" rel="external">http://pecl.php.net/get/memcache-2.2.0.tgz</a></h1><h1 id="tar-zxvf-memcache-2-2-0-tgz"><a href="#tar-zxvf-memcache-2-2-0-tgz" class="headerlink" title="tar zxvf memcache-2.2.0.tgz"></a>tar zxvf memcache-2.2.0.tgz</h1><p>#cd memcache-2.2.0</p>
<p>#export PHP_PREFIX=/usr/local/php</p>
<p>#$PHP_PREFIX/bin/phpize</p>
<p>#CHOST=”i686-pc-linux-gnu” CFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -mcpu=pentium4 -march=pentium4 -pipe -fomit-frame-pointer” CXXFLAGS=”-O3 -msse2 -mmmx -Wall -W -mfpmath=sse -funroll-loops -mcpu=pentium4 -march=pentium4 -pipe -felide-constructors -fno-exceptions -fno-rtti -fomit-frame-pointer” ./configure –enable-memcache –with-zlib-dir –with-php-config=$PHP_PREFIX/bin/php-config</p>
<p>#make &amp;&amp; make install<br>修改php.ini<br>在最末尾增加一行：<br>extension=”/usr/local/php/lib/php/extensions/no-debug-zts-20060613/memcache.so”<br>运行以下命令来启动 memcached：</p>
<p>#/usr/local/memcached/bin/memcached<br>-l 192.168.9.139 -d -p 11211 -u nobody -m 128<br>表示用 daemon 的方式启动 memcached，监听在 192.168.9.19 的 11211 端口上，运行用户为 nobody，为其分配 128MB 的内存。<br>这时查看一下进程，看memcached启动成功没有。<br>top -U nobody<br>可以看到<br>5867 nobody 15 0 2352 684 276 S 0.0 0.1 0:00.00 memcached<br>说明 memcached安装成功，并正在运行。<br>设置成开机自动运行<br>在 /etc/rc.d/rc.local 中加入<br>/usr/local/memcached/bin/memcached -l 192.168.9.150 -d -p 11211 -u nobody -m 128</p>
<p>四、附加功能配置, 包括ssl, mysqlhotcopy, phpmyadmin</p>
<p>15、安装DBI和DBD for mysql</p>
<p>//用于提供perl访问mysql数据库的接口规范,请确认你已经安装了perl,一般默认系统都装上了。<br>因为我们要用到mysqlhotcopy功能，需要这两个小程序的支持。</p>
<h1 id="wget-http-mirrors-xueron-com-CPAN-authors-id-T-TI-TIMB-DBI-1-601-tar-gz"><a href="#wget-http-mirrors-xueron-com-CPAN-authors-id-T-TI-TIMB-DBI-1-601-tar-gz" class="headerlink" title="wget http://mirrors.xueron.com/CPAN/authors/id/T/TI/TIMB/DBI-1.601.tar.gz"></a>wget <a href="http://mirrors.xueron.com/CPAN/authors/id/T/TI/TIMB/DBI-1.601.tar.gz" target="_blank" rel="external">http://mirrors.xueron.com/CPAN/authors/id/T/TI/TIMB/DBI-1.601.tar.gz</a></h1><p>首先，安装DBI包：</p>
<h1 id="tar-zxvf-DBI-1-061-tar-gz"><a href="#tar-zxvf-DBI-1-061-tar-gz" class="headerlink" title="tar zxvf DBI-1.061.tar.gz"></a>tar zxvf DBI-1.061.tar.gz</h1><h1 id="cd-DBI-1-061"><a href="#cd-DBI-1-061" class="headerlink" title="cd DBI-1.061"></a>cd DBI-1.061</h1><h1 id="perl-Makefile-PL"><a href="#perl-Makefile-PL" class="headerlink" title="perl Makefile.PL"></a>perl Makefile.PL</h1><h1 id="make-3"><a href="#make-3" class="headerlink" title="make"></a>make</h1><h1 id="make-test-1"><a href="#make-test-1" class="headerlink" title="make test"></a>make test</h1><h1 id="make-install-3"><a href="#make-install-3" class="headerlink" title="make install"></a>make install</h1><p>wget <a href="http://search.cpan.org/CPAN/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.005.tar.gz" target="_blank" rel="external">http://search.cpan.org/CPAN/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.005.tar.gz</a></p>
<h1 id="tar-zxvf-DBD-mysql-4-005-tar-gz"><a href="#tar-zxvf-DBD-mysql-4-005-tar-gz" class="headerlink" title="tar zxvf DBD-mysql-4.005.tar.gz"></a>tar zxvf DBD-mysql-4.005.tar.gz</h1><h1 id="cp-usr-local-mysql-lib-mysql-libmysqlclient-so-15-usr-lib"><a href="#cp-usr-local-mysql-lib-mysql-libmysqlclient-so-15-usr-lib" class="headerlink" title="cp /usr/local/mysql/lib/mysql/libmysqlclient.so.15 /usr/lib/"></a>cp /usr/local/mysql/lib/mysql/libmysqlclient.so.15 /usr/lib/</h1><h1 id="perl-Makefile-PL-–libs-”-L-usr-local-mysql-lib-mysql-lmysqlclient-L-usr-lib-lz-“-–cflags-I-usr-local-mysql-include-mysql-–mysql-config-usr-local-mysql-bin-mysql-config-–testhost-127-0-0-1–testsocket-tmp-mysql-sock-–testdb-test-–testuser-root-–testpassword-”youpassword”"><a href="#perl-Makefile-PL-–libs-”-L-usr-local-mysql-lib-mysql-lmysqlclient-L-usr-lib-lz-“-–cflags-I-usr-local-mysql-include-mysql-–mysql-config-usr-local-mysql-bin-mysql-config-–testhost-127-0-0-1–testsocket-tmp-mysql-sock-–testdb-test-–testuser-root-–testpassword-”youpassword”" class="headerlink" title="perl Makefile.PL –libs=”-L/usr/local/mysql/lib/mysql -lmysqlclient -L/usr/lib -lz “ –cflags=-I/usr/local/mysql/include/mysql –mysql_config=/usr/local/mysql/bin/mysql_config –testhost=127.0.0.1–testsocket=/tmp/mysql.sock –testdb=test –testuser=root –testpassword=”youpassword”"></a>perl Makefile.PL –libs=”-L/usr/local/mysql/lib/mysql -lmysqlclient -L/usr/lib -lz “ –cflags=-I/usr/local/mysql/include/mysql –mysql_config=/usr/local/mysql/bin/mysql_config –testhost=127.0.0.1–testsocket=/tmp/mysql.sock –testdb=test –testuser=root –testpassword=”youpassword”</h1><h1 id="make-4"><a href="#make-4" class="headerlink" title="make"></a>make</h1><h1 id="make-test-2"><a href="#make-test-2" class="headerlink" title="make test"></a>make test</h1><h1 id="make-instll"><a href="#make-instll" class="headerlink" title="make instll"></a>make instll</h1><p>测试执行 mysqlhotcopy 並出現如下类似錯誤訊息</p>
<p>#/usr/local/mysql/bin/mysqlhotcopy mysql /tmp/test -u root -p ‘password’<br>Invalid db.table name ‘mysql.mysql<code>.</code>activity’ at /usr/local/bin/mysqlhotcopy line 855.<br>Ans:<br>找到了 [MySQL Bugs: #27303: mysqlhotcopy dies with error Invalid db.table name ‘foo.bar<code>.</code>baz’] 说明将 mysqlhotcopy 文件修改一下后即可顺利执行 mysqlhotcopy 了</p>
<p>#vi /usr/local/mysql/bin/mysqlhotcopy //在第 835 下新增一行<br>835 my @dbh_tables = eval { $dbh-&gt;tables() };<br>836 map { s/^.*?.//o } @dbh_tables; //加入此行<br>mysql 5.0.50后已经修正这个错误。</p>
<p>16、配置https<br>vi /usr/local/apache2/conf/httpd.conf</p>
<h1 id="监听443端口-支持https连接"><a href="#监听443端口-支持https连接" class="headerlink" title="监听443端口,支持https连接"></a>监听443端口,支持https连接</h1><p>取消注释 httpd.conf 中的 Include conf/extra/httpd-ssl.conf<br>设置SSL并创建自己的CA</p>
<h1 id="cd-etc-pki-tls-misc"><a href="#cd-etc-pki-tls-misc" class="headerlink" title="cd /etc/pki/tls/misc"></a>cd /etc/pki/tls/misc</h1><h1 id="CA-newca"><a href="#CA-newca" class="headerlink" title="./CA -newca"></a>./CA -newca</h1><p>屏幕上出现如下的提示:CA certificate filename (or enter to create)<br>这是要求输入要创建的CA的证书文件名, 可以直接回车或输入证书文件名。<br>Making CA certificate …<br>Generating a 1024 bit RSA private key<br>………++++++<br>…………………………..++++++<br>writing new private key to ‘./demoCA/private/./cakey.pem’<br>Enter PEM pass phrase:<br>Verifying password - Enter PEM pass phrase:-<br>此时要求输入和验证CA的私钥口令、国家代码（中国是CN）、省份、城市或地区、组织或企业名称、部门名称、CA的名称或服务器的主机名称、管理员电子邮件地址。<br>至此,在当前目录下生成了demoCA的目录,CA的证书就在该目录下,文件名为cacert.pem<br>生成服务器的证书请求</p>
<h1 id="CA-newreq"><a href="#CA-newreq" class="headerlink" title="./CA -newreq"></a>./CA -newreq</h1><p>屏幕上出现如下的提示:<br>Generating a 1024 bit RSA private key<br>……………………………………………..++++++<br>…..++++++<br>writing new private key to ‘newreq.pem’<br>Enter PEM pass phrase:<br>Verifying password - Enter PEM pass phrase:<br>此时要求输入和验证服务器的私钥口令、国家代码（中国是CN）、省份、城市或地区、组织或企业名称、部门名称、CA的名称或服务器的主机名称、管理员电子邮件地址。<br>Please enter the following ‘extra’ attributes<br>to be sent with your certificaterequest<br>A challenge password []:<br>An optional company name []:<br>.Request (and private key) is in newreq.pem<br>这是要求输入服务器的相关信息。<br>此时,在当前目录下生成了一个名为newreq.pem的文件,包含了要生成服务器数字证书的请求。<br>签署证书</p>
<h1 id="CA-sign"><a href="#CA-sign" class="headerlink" title="./CA -sign"></a>./CA -sign</h1><p>屏幕上出现如下的提示:<br>Using configuration from /usr/share/ssl/openssl.cnf<br>Enter PEM pass phrase:<br>此时一样需要输入CA的私钥口令、国家代码（中国是CN）、省份、城市或地区、组织或企业名称、部门名称、CA的名称或服务器的主机名称、管理员电子邮件地址。<br>Certificate is to be certified until Nov 19 13:46:19 2002 GMT (365 days)<br>Sign the certificate? [y/n]:y<br>这时显示证书请求文件中的各项信息,并询问是否要签署证书，回答y，进行签署。<br>1 out of 1 certificate requests certified, commit? [y/n]y<br>回答y,会显示已经签署的证书的信息,并在当前目录下生成服务器的证书文件newcert.pem。</p>
<h1 id="mkdir-usr-local-apache2-conf-ssl-crt"><a href="#mkdir-usr-local-apache2-conf-ssl-crt" class="headerlink" title="mkdir /usr/local/apache2/conf/ssl.crt/"></a>mkdir /usr/local/apache2/conf/ssl.crt/</h1><h1 id="mkdir-usr-local-apache2-conf-ssl-key"><a href="#mkdir-usr-local-apache2-conf-ssl-key" class="headerlink" title="mkdir /usr/local/apache2/conf/ssl.key/"></a>mkdir /usr/local/apache2/conf/ssl.key/</h1><h1 id="cp-newcert-pem-usr-local-apache2-conf-ssl-crt-server-pem"><a href="#cp-newcert-pem-usr-local-apache2-conf-ssl-crt-server-pem" class="headerlink" title="cp newcert.pem /usr/local/apache2/conf/ssl.crt/server.pem"></a>cp newcert.pem /usr/local/apache2/conf/ssl.crt/server.pem</h1><h1 id="cp-newreq-pem-usr-local-apache2-conf-ssl-key-server-pem"><a href="#cp-newreq-pem-usr-local-apache2-conf-ssl-key-server-pem" class="headerlink" title="cp newreq.pem /usr/local/apache2/conf/ssl.key/server.pem"></a>cp newreq.pem /usr/local/apache2/conf/ssl.key/server.pem</h1><p>更改服务器的证书文件的相关配置</p>
<h1 id="vi-usr-local-apache2-conf-extra-httpd-ssl-conf"><a href="#vi-usr-local-apache2-conf-extra-httpd-ssl-conf" class="headerlink" title="vi /usr/local/apache2/conf/extra/httpd-ssl.conf"></a>vi /usr/local/apache2/conf/extra/httpd-ssl.conf</h1><p>查找并修改</p>
<h1 id="Server-Certificate"><a href="#Server-Certificate" class="headerlink" title="Server Certificate:"></a>Server Certificate:</h1><h1 id="Point-SSLCertificateFile-at-a-PEM-encoded-certificate-If"><a href="#Point-SSLCertificateFile-at-a-PEM-encoded-certificate-If" class="headerlink" title="Point SSLCertificateFile at a PEM encoded certificate. If"></a>Point SSLCertificateFile at a PEM encoded certificate. If</h1><h1 id="the-certificate-is-encrypted-then-you-will-be-prompted-for-a"><a href="#the-certificate-is-encrypted-then-you-will-be-prompted-for-a" class="headerlink" title="the certificate is encrypted, then you will be prompted for a"></a>the certificate is encrypted, then you will be prompted for a</h1><h1 id="pass-phrase-Note-that-a-kill-HUP-will-prompt-again-Keep"><a href="#pass-phrase-Note-that-a-kill-HUP-will-prompt-again-Keep" class="headerlink" title="pass phrase. Note that a kill -HUP will prompt again. Keep"></a>pass phrase. Note that a kill -HUP will prompt again. Keep</h1><h1 id="in-mind-that-if-you-have-both-an-RSA-and-a-DSA-certificate-you"><a href="#in-mind-that-if-you-have-both-an-RSA-and-a-DSA-certificate-you" class="headerlink" title="in mind that if you have both an RSA and a DSA certificate you"></a>in mind that if you have both an RSA and a DSA certificate you</h1><h1 id="can-configure-both-in-parallel-to-also-allow-the-use-of-DSA"><a href="#can-configure-both-in-parallel-to-also-allow-the-use-of-DSA" class="headerlink" title="can configure both in parallel (to also allow the use of DSA"></a>can configure both in parallel (to also allow the use of DSA</h1><h1 id="ciphers-etc"><a href="#ciphers-etc" class="headerlink" title="ciphers, etc.)"></a>ciphers, etc.)</h1><p>SSLCertificateFile /usr/local/apache2/conf/ssl.crt/server.pem</p>
<p>#SSLCertificateFile /usr/local/apache2/conf/server-dsa.crt</p>
<h1 id="Server-Private-Key"><a href="#Server-Private-Key" class="headerlink" title="Server Private Key:"></a>Server Private Key:</h1><h1 id="If-the-key-is-not-combined-with-the-certificate-use-this"><a href="#If-the-key-is-not-combined-with-the-certificate-use-this" class="headerlink" title="If the key is not combined with the certificate, use this"></a>If the key is not combined with the certificate, use this</h1><h1 id="directive-to-point-at-the-key-file-Keep-in-mind-that-if"><a href="#directive-to-point-at-the-key-file-Keep-in-mind-that-if" class="headerlink" title="directive to point at the key file. Keep in mind that if"></a>directive to point at the key file. Keep in mind that if</h1><h1 id="you’ve-both-a-RSA-and-a-DSA-private-key-you-can-configure"><a href="#you’ve-both-a-RSA-and-a-DSA-private-key-you-can-configure" class="headerlink" title="you’ve both a RSA and a DSA private key you can configure"></a>you’ve both a RSA and a DSA private key you can configure</h1><h1 id="both-in-parallel-to-also-allow-the-use-of-DSA-ciphers-etc"><a href="#both-in-parallel-to-also-allow-the-use-of-DSA-ciphers-etc" class="headerlink" title="both in parallel (to also allow the use of DSA ciphers, etc.)"></a>both in parallel (to also allow the use of DSA ciphers, etc.)</h1><p>SSLCertificateKeyFile /usr/local/apache2/conf/ssl.key/server.pem</p>
<p>#SSLCertificateKeyFile /usr/local/apache2/conf/server-dsa.key<br>示例文件<br>在SSL的根目录中生成一个index.html,它是如下所示:<br>＜html＞<br>这是SSL示例!<br>＜/html＞<br>测试<br>假如Web服务器的DNS名称是www.cnprint.org.<br>在浏览器的URL地址栏里输入 <a href="http://www.cnprint.org/，浏览器便会显示APACHE安装时确省的Test" target="_blank" rel="external">http://www.cnprint.org/，浏览器便会显示APACHE安装时确省的Test</a> Page.<br>在浏览器的URL地址栏里输入 <a href="https://www.cnprint.org/，注意:是" target="_blank" rel="external">https://www.cnprint.org/，注意:是</a> https 而不是http !<br>浏览器会提示站点已经采用了SSL进行数据的加密传输.由于我们的CA证书不是浏览器缺省的信任的根证书,所以,浏览器会说无法确认服务器的证书可信。暂时不管,一直NEXT,最后,浏览器会显示:这是SSL示例!<br>可以把CA的证书放在非SSL的站点上,让浏览器下载并安装CA证书,并将其设置成可信任的根证书,便可解决上面的问题.8 解除HTTPD起动时的口令输入。<br>由于安全的原因,Web服务器的私钥是口令加密了的，每次重新起动HTTPD或Linux时,都会要求输入Web服务器的私钥的口令。<br>如果要解除HTTPD起动时的口令输入,可以这样:</p>
<h1 id="cd-usr-local-apache2-conf-ssl-key"><a href="#cd-usr-local-apache2-conf-ssl-key" class="headerlink" title="cd /usr/local/apache2/conf/ssl.key/"></a>cd /usr/local/apache2/conf/ssl.key/</h1><h1 id="cp-server-pem-server-pem-org"><a href="#cp-server-pem-server-pem-org" class="headerlink" title="cp server.pem server.pem.org"></a>cp server.pem server.pem.org</h1><h1 id="openssl-rsa-in-server-pem-org-out-server-pem"><a href="#openssl-rsa-in-server-pem-org-out-server-pem" class="headerlink" title="openssl rsa -in server.pem.org -out server.pem"></a>openssl rsa -in server.pem.org -out server.pem</h1><h1 id="chmod-400-server-pem"><a href="#chmod-400-server-pem" class="headerlink" title="chmod 400 server.pem"></a>chmod 400 server.pem</h1><p>另外在网上看到一个方法，我没有试。有兴趣的可以试下。<br>创建SSL密码自动应答文件，否则每次Apache启动的时候，都会要求你输入SSL的密码.<br>创建 /usr/local/apache2/conf/ssl.key/sendsslpwd ,内容如下.</p>
<p>#!/bin/bash<br>SSLpasswd=”YOUR PASSPHRASE”<br>echo $SSLpasswd<br>chmod 755 /usr/local/apache2/conf/ssl.key/sendsslpwd<br>此时，Web服务器的私钥已经没有口令加密,一定要确保server.pem文件除root外,任何用户均无权读取它。</p>
<p>17、安装phpmyadmin，管理mysql数据库</p>
<h1 id="cd-usr-local-apache2-htdocs"><a href="#cd-usr-local-apache2-htdocs" class="headerlink" title="cd /usr/local/apache2/htdocs/"></a>cd /usr/local/apache2/htdocs/</h1><h1 id="wget-http-nchc-dl-sourceforge-net-sourceforge-phpmyadmin-phpMyAdmin-2-11-1-all-languages-utf-8-only-tar-gz"><a href="#wget-http-nchc-dl-sourceforge-net-sourceforge-phpmyadmin-phpMyAdmin-2-11-1-all-languages-utf-8-only-tar-gz" class="headerlink" title="wget http://nchc.dl.sourceforge.net/sourceforge/phpmyadmin/phpMyAdmin-2.11.1-all-languages-utf-8-only.tar.gz"></a>wget <a href="http://nchc.dl.sourceforge.net/sourceforge/phpmyadmin/phpMyAdmin-2.11.1-all-languages-utf-8-only.tar.gz" target="_blank" rel="external">http://nchc.dl.sourceforge.net/sourceforge/phpmyadmin/phpMyAdmin-2.11.1-all-languages-utf-8-only.tar.gz</a></h1><h1 id="tar-zxvf-phpMyAdmin-2-11-1-all-languages-utf-8-only-tar-gz"><a href="#tar-zxvf-phpMyAdmin-2-11-1-all-languages-utf-8-only-tar-gz" class="headerlink" title="tar zxvf phpMyAdmin-2.11.1-all-languages-utf-8-only.tar.gz"></a>tar zxvf phpMyAdmin-2.11.1-all-languages-utf-8-only.tar.gz</h1><h1 id="mv-phpMyAdmin-2-11-1-all-languages-utf-8-only-phpmyadmin"><a href="#mv-phpMyAdmin-2-11-1-all-languages-utf-8-only-phpmyadmin" class="headerlink" title="mv phpMyAdmin-2.11.1-all-languages-utf-8-only phpmyadmin"></a>mv phpMyAdmin-2.11.1-all-languages-utf-8-only phpmyadmin</h1><h1 id="cd-phpmyadmin-libraries"><a href="#cd-phpmyadmin-libraries" class="headerlink" title="cd phpmyadmin/libraries"></a>cd phpmyadmin/libraries</h1><p>修改配置文件</p>
<h1 id="vi-config-default-php"><a href="#vi-config-default-php" class="headerlink" title="vi config.default.php"></a>vi config.default.php</h1><p>找到这几行进行修改：<br>$cfg[‘Servers’][$i][‘auth_type’] = ‘http’; // Authentication method (valid choices: config, http, HTTP, signon or cookie)<br>$cfg[‘Servers’][$i][‘user’] = ‘root’; // MySQL user<br>$cfg[‘Servers’][$i][‘password’] = ‘PASSWORD’; // MySQL password (only needed</p>
<p>五、服务器安全配置</p>
<p>18、编译安装mod_security<br>mod_security是一个集入侵检测和防御引擎功能的开源web应用安全程序(或web应用程序防火墙)。<br>它以Apache Web服务器的模块方式运行, 目标是增强web应用程序的安全性, 防止web应用程序受到已知或未知的攻击。</p>
<h1 id="cd-usr-local-src-8"><a href="#cd-usr-local-src-8" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-http-www-modsecurity-org-download-modsecurity-apache-2-1-3-tar-gz"><a href="#wget-http-www-modsecurity-org-download-modsecurity-apache-2-1-3-tar-gz" class="headerlink" title="wget http://www.modsecurity.org/download/modsecurity-apache_2.1.3.tar.gz"></a>wget <a href="http://www.modsecurity.org/download/modsecurity-apache_2.1.3.tar.gz" target="_blank" rel="external">http://www.modsecurity.org/download/modsecurity-apache_2.1.3.tar.gz</a></h1><h1 id="tar-zxvf-modsecurity-apache-2-1-3-tar-gz"><a href="#tar-zxvf-modsecurity-apache-2-1-3-tar-gz" class="headerlink" title="tar -zxvf modsecurity-apache_2.1.3.tar.gz"></a>tar -zxvf modsecurity-apache_2.1.3.tar.gz</h1><h1 id="cd-modsecurity-apache-2-1-3-apache2"><a href="#cd-modsecurity-apache-2-1-3-apache2" class="headerlink" title="cd modsecurity-apache_2.1.3/apache2"></a>cd modsecurity-apache_2.1.3/apache2</h1><h1 id="cat-usr-local-apache2-conf-httpd-conf-grep-“ServerRoot”-grep-v-“-”"><a href="#cat-usr-local-apache2-conf-httpd-conf-grep-“ServerRoot”-grep-v-“-”" class="headerlink" title="cat /usr/local/apache2/conf/httpd.conf | grep “ServerRoot” | grep -v “#”"></a>cat /usr/local/apache2/conf/httpd.conf | grep “ServerRoot” | grep -v “#”</h1><p>ServerRoot “/usr/local/apache2”<br>#</p>
<p>#vi Makefile<br>top_dir = /usr/local/apache2<br>#</p>
<h1 id="make-5"><a href="#make-5" class="headerlink" title="make"></a>make</h1><h1 id="make-install-4"><a href="#make-install-4" class="headerlink" title="make install"></a>make install</h1><p>vi /usr/local/apache2/conf/httpd.conf<br>加载下列模块<br>LoadModule unique_id_module modules/mod_unique_id.so<br>LoadModule security2_module modules/mod_security2.so<br>添加一行：<br>Include conf/modsecurity/*.conf<br>保存。<br>cd /usr/local/src/modsecurity-apache_2.1.3/rules</p>
<h1 id="mkdir-usr-local-apache2-conf-modsecurity"><a href="#mkdir-usr-local-apache2-conf-modsecurity" class="headerlink" title="mkdir /usr/local/apache2/conf/modsecurity"></a>mkdir /usr/local/apache2/conf/modsecurity</h1><h1 id="cp-conf-usr-local-apache2-conf-modsecurity"><a href="#cp-conf-usr-local-apache2-conf-modsecurity" class="headerlink" title="cp *.conf /usr/local/apache2/conf/modsecurity/"></a>cp *.conf /usr/local/apache2/conf/modsecurity/</h1><p>根据你的需要，You may want to edit and customize modsecurity_crs_10_config.conf.<br>Additionally you may want to edit modsecurity_crs_30_http_policy.conf which enforces an application specific HTTP protocol usage.<br>重启apache</p>
<p>19、Iptables规则<br>vi /usr/local/sbin/fw.sh<br>将以下脚本命令粘贴到 fw.sh 文件中。</p>
<p>#!/bin/bash</p>
<h1 id="Stop-iptables-service-first"><a href="#Stop-iptables-service-first" class="headerlink" title="Stop iptables service first"></a>Stop iptables service first</h1><p>service iptables stop</p>
<h1 id="Load-FTP-Kernel-modules"><a href="#Load-FTP-Kernel-modules" class="headerlink" title="Load FTP Kernel modules"></a>Load FTP Kernel modules</h1><p>/sbin/modprobe ip_conntrack_ftp<br>/sbin/modprobe ip_nat_ftp</p>
<h1 id="Inital-chains-default-policy"><a href="#Inital-chains-default-policy" class="headerlink" title="Inital chains default policy"></a>Inital chains default policy</h1><p>/sbin/iptables -F -t filter<br>/sbin/iptables -P INPUT DROP<br>/sbin/iptables -P OUTPUT ACCEPT</p>
<h1 id="Enable-Native-Network-Transfer"><a href="#Enable-Native-Network-Transfer" class="headerlink" title="Enable Native Network Transfer"></a>Enable Native Network Transfer</h1><p>/sbin/iptables -A INPUT -i lo -j ACCEPT</p>
<h1 id="Accept-Established-Connections"><a href="#Accept-Established-Connections" class="headerlink" title="Accept Established Connections"></a>Accept Established Connections</h1><p>/sbin/iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT</p>
<h1 id="ICMP-Control"><a href="#ICMP-Control" class="headerlink" title="ICMP Control"></a>ICMP Control</h1><p>/sbin/iptables -A INPUT -p icmp -m limit –limit 1/s –limit-burst 10 -j ACCEPT</p>
<h1 id="WWW-Service"><a href="#WWW-Service" class="headerlink" title="WWW Service"></a>WWW Service</h1><p>/sbin/iptables -A INPUT -p tcp –dport 80 -j ACCEPT</p>
<h1 id="FTP-Service"><a href="#FTP-Service" class="headerlink" title="FTP Service"></a>FTP Service</h1><p>/sbin/iptables -A INPUT -p tcp –dport 2121 -j ACCEPT</p>
<h1 id="SSH-Service"><a href="#SSH-Service" class="headerlink" title="SSH Service"></a>SSH Service</h1><p>/sbin/iptables -A INPUT -p tcp –dport 59825 -j ACCEPT</p>
<h1 id="Anti-DDOS"><a href="#Anti-DDOS" class="headerlink" title="Anti DDOS"></a>Anti DDOS</h1><p>/sbin/iptables -I INPUT -p tcp –syn -m ttl –ttl-eq 117 -j DROP<br>/sbin/iptables -I INPUT -p tcp –syn -m length –length :40 -j DROP</p>
<h1 id="chmod-755-usr-local-sbin-fw-sh"><a href="#chmod-755-usr-local-sbin-fw-sh" class="headerlink" title="chmod 755 /usr/local/sbin/fw.sh"></a>chmod 755 /usr/local/sbin/fw.sh</h1><h1 id="echo-‘-usr-local-sbin-fw-sh’-gt-gt-etc-rc-d-rc-local"><a href="#echo-‘-usr-local-sbin-fw-sh’-gt-gt-etc-rc-d-rc-local" class="headerlink" title="echo ‘/usr/local/sbin/fw.sh’ &gt;&gt; /etc/rc.d/rc.local"></a>echo ‘/usr/local/sbin/fw.sh’ &gt;&gt; /etc/rc.d/rc.local</h1><h1 id="usr-local-sbin-fw-sh"><a href="#usr-local-sbin-fw-sh" class="headerlink" title="/usr/local/sbin/fw.sh"></a>/usr/local/sbin/fw.sh</h1><p>20、apachet和 php 优化设置<br>对于访问量稍大的站点，Apache的这些默认配置是无法满足需求的，我们仍需调整Apache的一些参数，使Apache能够在大访问量环境下发挥出更好的性能。以下我们对Apache配置文件httpd.conf中对性能影响较大的参数进行一些说明。<br>(1) Timeout 该参数指定Apache在接收请求或发送所请求内容之前的最长等待时间（秒），若超过该时间Apache则放弃处理该请求，并释放连接。该参数默认值为120，推荐设置为60，对于访问量较大的网站可以设置为30。<br>(2) KeepAlive 该参数控制Apache是否允许在一个连接中有多个请求，默认打开。但对于大多数论坛类型站点来说，通常设置为off以关闭该支持。<br>(3) MPM - prefork.c 在默认情况下Apache使用Prefork（进程）工作模式，可以说这部分的参数设置是对Apache性能影响的核心和关键。<br>查看你的apache运行的模式：</p>
<h1 id="usr-local-apache2-bin-httpd-l"><a href="#usr-local-apache2-bin-httpd-l" class="headerlink" title="/usr/local/apache2/bin/httpd -l"></a>/usr/local/apache2/bin/httpd -l</h1><p>Compiled in modules:<br>core.c<br>prefork.c<br>http_core.c<br>mod_so.c<br>然后用户可以在配置文档中找到以下配置段：<br>&lt;IfModule prefork.c&gt;<br>StartServers 5<br>MinSpareServers 5<br>MaxSpareServers 10<br>MaxClients 15<br>MaxRequestsPerChild 0<br>&lt;/IfModule&gt;<br>这就是控制Apache进程工作的配置段，为了更好的理解上述配置中的各项参数，下面让我们先了解一下Apache是如何控制进程工作的。我们知道，在 Unix系统中，很多服务(Service)的守护进程(Daemon)在启动时会创建一个进程以准备应答可能的连接请求，服务即进入了端口监听状态，当一个来自客户端(Client)的请求被发送至服务所监听的端口时，该服务进程即会处理该请求，在处理过程中，该进程处于独占状态，也就是说如果此时有其他请求到达，这些请求只能“排队”等待当前请求处理完成且服务进程释放。这样就会导致越来越多的请求处于队列等待状态，实际表现就是该服务处理能力非常低下。Apache使用Prefork模式很好的解决了这一问题。下面我们来看看Apache实际上是如何高效率工作的。<br>当Apache启动时，Apache会启动StartSpareServers个空闲进程同时准备接收处理请求，当多个请求到来时， StarSpareServers进行会越来越少，当空闲进程减少到MinSpareServers个时，Apache为了能够继续有充裕的进程处理请求，它会再启动StartsServers个进程备用，这样就大大减少了请求队列等待的可能，使得服务效率提高，这也是为什么叫做Pre-fork的原因；让我们继续跟踪Apache的工作，我们假设Apache已经启动了200个进程来处理请求，理论上来说，此时Apache一共有205个进程，而过了一段时间，假设有100个请求都得到了Apache的响应和处理，那么此时这100个进程就被释放成为空闲进程，那么此时Apache有105个空闲进程。而对于服务而言，启动太多的空闲进程时没有任何意义的，反而会降低服务器的整体性能，那么Apache真的会有105个空闲进程么？当然不会！实际上 Apache随时在检查自己，当发现有超过MaxSpareServers个空闲进程时，则会自动停止关闭一些进程，以保证空闲进程不过过多。说到这里，用户应该对Apache的工作方式有了一定的了解，如果想获得更多更详细的说明请参阅Apache手册文档。<br>我们还有两个参数没有介绍：MaxClients和MaxRequestPerchild；MaxClients指定Apache在同一时间内最多允许有多少客户端能够与其连接，如果超过MaxClients个连接，客户端将会得到一个“服务器繁忙”的错误页面。我们看到默认情况下MaxClients设置为15，这对一些中型站点和大型站点显然是远远不够的！也许您需要同时允许512个客户端连接才能满足应用需求，好吧，那么就让我们把 MaxClients修改为512，保存httpd.conf并退出，重启Apache，很遗憾，在重启过程当中您看到了一些错误提示，Apache重启失败。错误提示中告诉您MaxClients最大只能设定为256，相信您一定很失望。不过不要沮丧，Apache作为世界一流的Web Server一定不会如此单薄的！在默认情况下，MaxClients的确只能设定为不超过256的整数，但是，如果您有需要完全可以随意定制，此时就需要使用ServerLimit参数来配合使用，简单的说ServerLimit就像是水桶，而MaxClients就像是水，您可以通过更换更大的水桶（将ServerLimit设定为一个较大值）来容纳更多的水(MaxClients)，但要注意，MaxClients的设定数值是不能大于 ServerLimit的设定数值的！<br>下面让我们了解一下MaxRequestPerChild参数，该参数指定一个连接进程中可以有多少个线程同时工作。也许这样解释过于专业，那么您只要想想“网络蚂蚁”、“网际快车FlashGet”中的“多点同时下载”即可，该参数实际上就是限制最多可以用几个“点”。默认设置为0，即为：不限制。但需要注意，如果将该值设置的过小会引起访问问题，如果没有特殊需要或者访问量压力并非很大可以保持默认值，如果访问量很大则推荐设置为2048。<br>好了，解释了这么多，让我们看看经过修改后Perfork.c配置段的推荐配置：<br>&lt;IfModule prefork.c&gt;<br>StartServers 5<br>MinSpareServers 5<br>MaxSpareServers 10<br>ServerLimit 1024<br>MaxClients 768<br>MaxRequestsPerChild 0<br>&lt;/IfModule&gt;<br>完成了上述对Apache的调整，Apache已经获得了较大的性能改善。记住，在修改任何参数后都需要重启Apache才能生效的。有关Apache的优化远远不止这些，有兴趣的用户可以阅读Apache手册文档或者寻找一些文献资料学习。<br>2. PHP优化对于PHP的优化主要是对php.ini中的相关主要参数进行合理调整和设置，以下我们就来看看php.ini中的一些对性能影响较大的参数应该如何设置。</p>
<h1 id="vi-etc-php-ini"><a href="#vi-etc-php-ini" class="headerlink" title="vi /etc/php.ini"></a>vi /etc/php.ini</h1><p>(1) PHP函数禁用找到：<br>disable_functions =<br>该选项可以设置哪些PHP函数是禁止使用的，PHP中有一些函数的风险性还是相当大的，可以直接执行一些系统级脚本命令，如果允许这些函数执行，当PHP程序出现漏洞时，损失是非常严重的！以下我们给出推荐的禁用函数设置：<br>disable_functions = phpinfo,passthru,exec,system,popen,chroot,escapeshellcmd,escapeshellarg,shell_exec,proc_open,proc_get_status<br>需注意：如果您的服务器中含有一些系统状态检测的PHP程序，则不要禁用shell_exec,proc_open,proc_get_status等函数。<br>(2) PHP脚本执行时间找到：<br>max_execution_time = 30<br>该选项设定PHP程序的最大执行时间，如果一个PHP脚本被请求，且该PHP脚本在max_execution_time时间内没能执行完毕，则PHP不再继续执行，直接给客户端返回超时错误。没有特殊需要该选项可保持默认设置30秒，如果您的PHP脚本确实需要长执行时间则可以适当增大该时间设置。<br>(3) PHP脚本处理内存占用找到：<br>memory_limit = 8M<br>该选项指定PHP脚本处理所能占用的最大内存，默认为8MB，如果您的服务器内存为1GB以上，则该选项可以设置为12MB以获得更快的PHP脚本处理效率。<br>(4) PHP全局函数声明找到：<br>register_globals = Off<br>网络上很多关于PHP设置的文章都推荐将该选项设置为On，其实这是一种及其危险的设置方法，很可能引起严重的安全性问题。如果没有特殊的需要，强烈推荐保留默认设置！<br>(5) PHP上传文件大小限制找到：<br>upload_max_filesize = 2M<br>该选项设定PHP所能允许最大上传文件大小，默认为2MB。根据实际应用需求，可以适当增大该设置。<br>(6) Session存储介质找到：<br>session.save_path<br>如果你的PHP程序使用Session对话，则可以将Session存储位置设置为/dev/shm，/dev/shm是Linux系统独有的TMPFS 文件系统，是以内存为主要存储方式的文件系统，比RAMDISK更优秀，因为可以使用DISKSWAP作为补充，而且是系统自带的功能模块，不需要另行配置。想想看，从磁盘IO操作到内存操作，速度会快多少？只是需要注意，存储在/dev/shm的数据，在服务器重启后会全部丢失。不过这对于 Session来说是无足轻重的<br>(7)找到short_open_tag = Off<br>修改成short_open_tag = On，一些国内的php程序不标准，关闭可能会出错。</p>
<p>21、mysql优化及安全设置<br>Mysql的优化设置<br>打开/etc/my.cnf文件，修改以下设置，如果没有，可手动添加。调整设置时，请量力而行，这与你的服务器的配置有关，特别是内存大小。以下设置比较适合于1G内存的服务器，但并不绝对。</p>
<p>#指定索引缓冲区的大小，它决定索引处理的速度，尤其是索引读的速度。通过检查状态值Key_read_requests和Key_reads，可以知道 key_buffer_size设置是否合理。比例key_reads / key_read_requests应该尽可能的低，至少是1:100，1:1000更好（上述状态值可以使用show status like ‘key_reads’获得）。key_buffer_size只对MyISAM表起作用。即使你不使用MyISAM表，但是内部的临时磁盘表是 MyISAM表，也要使用该值。可以使用检查状态值created_tmp_disk_tables得知详情。<br>key_buffer = 384M</p>
<p>#要求MySQL能有的连接数量。当主要MySQL线程在一个很短时间内得到非常多的连接请求，这就起作用，然后主线程花些时间(尽管很短)检查连接并且启动一个新线程。back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。只有如果期望在一个短时间内有很多连接，你需要增加它，换句话说，这值对到来的TCP/IP连接的侦听队列的大小。你的操作系统在这个队列大小上有它自己的限制。试图设定back_log高于你的操作系统的限制将是无效的。默认数值是50<br>back_log = 200</p>
<p>#一个包的最大尺寸。消息缓冲区被初始化为net_buffer_length字节，但是可在需要时增加到max_allowed_packet个字节。缺省地，该值太小必能捕捉大的(可能错误)包。如果你正在使用大的BLOB列，你必须增加该值。它应该象你想要使用的最大BLOB的那么大。<br>max_allowed_packet = 4M</p>
<p>#允许的同时客户的数量。增加该值增加 mysqld要求的文件描述符的数量。这个数字应该增加，否则，你将经常看到 Too many connections 错误。 默认数值是100<br>max_connections = 1024</p>
<p>#指定表高速缓存的大小。每当MySQL访问一个表时，如果在表缓冲区中还有空间，该表就被打开并放入其中，这样可以更快地访问表内容。通过检查峰值时间的状态值Open_tables和Opened_tables，可以决定是否需要增加table_cache的值。如果你发现open_tables等于 table_cache，并且opened_tables在不断增长，那么你就需要增加table_cache的值了（上述状态值可以使用show status like ‘Open_tables’获得）。注意，不能盲目地把table_cache设置成很大的值。如果设置得太高，可能会造成文件描述符不足，从而造成性能不稳定或者连接失败。<br>table_cache = 512</p>
<p>#每个线程排序所需的缓冲<br>sort_buffer_size = 4M</p>
<p>#当一个查询不断地扫描某一个表，MySQL会为它分配一段内存缓冲区。read_buffer_size变量控制这一缓冲区的大小。如果你认为连续扫描进行得太慢，可以通过增加该变量值以及内存缓冲区大小提高其性能。<br>read_buffer_size = 4M</p>
<p>#加速排序操作后的读数据，提高读分类行的速度。如果正对远远大于可用内存的表执行GROUP BY或ORDER BY操作，应增加read_rnd_buffer_size的值以加速排序操作后面的行读取。仍然不明白这个选项的用处……<br>read_rnd_buffer_size = 8M</p>
<p>#用于REPAIR TABLE。不明白这个选项的用处，百度上找到的设置方向也是五花八门，有128M、64M、32M等，折中选一个。<br>myisam_sort_buffer_size = 64M</p>
<p>#可以复用的保存在中的线程的数量。如果有，新的线程从缓存中取得，当断开连接的时候如果有空间，客户的线置在缓存中。如果有很多新的线程，为了提高性能可以这个变量值。通过比较 Connections 和 Threads_created 状态的变量，可以看到这个变量的作用。<br>thread_cache_size = 128</p>
<p>#查询结果缓存。第一次执行某条SELECT语句的时候，服务器记住该查询的文本内容和它返回的结果。服务器下一次碰到这个语句的时候，它不会再次执行该语句。作为代替，它直接从查询缓存中的得到结果并把结果返回给客户端。<br>query_cache_size = 32M</p>
<p>#最大并发线程数,cpu数量*2<br>thread_concurrency = 2</p>
<p>#设置超时时间,能避免长连接<br>wait_timeout = 120</p>
<p>#关闭不需要的表类型,如果你需要,就不要加上这个<br>skip-innodb<br>skip-bdb<br>关于mysql的优化设置及检查，这篇文章很值得一看 <a href="http://tech.itdb.cn/n/200607/27/n20060727_30398.shtml" target="_blank" rel="external">http://tech.itdb.cn/n/200607/27/n20060727_30398.shtml</a><br>Mysql的安全设置<br>打开/etc/my.cnf文件，修改以下设置，如果没有，可手动添加。</p>
<p>#取消文件系统的外部锁<br>skip-locking</p>
<p>#不进行域名反解析,注意由此带来的权限/授权问题<br>skip-name-resolve</p>
<p>#禁止MySQL中用“LOAD DATA LOCAL INFILE”命令。这个命令会利用MySQL把本地文件读到数据库中，然后用户就可以非法获取敏感信息了。网络上流传的一些攻击方法中就有用它的，它也是很多新发现的SQL Injection攻击利用的手段！<br>local-infile = 0</p>
<p>#关闭远程连接，即3306端口。这是MySQL的默认监听端口。由于此处MySQL只服务于本地脚本，所以不需要远程连接。尽管MySQL内建的安全机制很严格，但监听一个TCP端口仍然是危险的行为，因为如果MySQL程序本身有问题，那么未授权的访问完全可以绕过MySQL的内建安全机制。（你必须确定，你是否真的不需要远程连接mysql）<br>skip-networking<br>修改完my.cnf后，还需要对mysql的用户名、帐号、及默认数据库进行调整<br>首先先登录mysql，在终端窗口输入 /usr/local/mysql/bin/mysql -u root -p<br>然后会提示输入密码，输入正确密码后，会出现mysql&gt;提示符。<br>输入以下命令：<br>mysql&gt;use mysql;<br>mysql&gt;update user set user=”centos” where user=”root”; (将mysql的root用户名修改成centos，防止root的密码被暴力破解)<br>mysql&gt;select Host,User,Password,Select_priv,Grant_priv from user;<br>mysql&gt;delete from user where user=’’; （删除user用户）<br>mysql&gt;delete from user where password=’’; （删除user用户）<br>mysql&gt;delete from user where host=’’; （删除user用户）<br>mysql&gt;drop database test; (删除默认的test数据库)<br>mysql&gt;flush privileges; （刷新mysql的缓存，让以上设置立即生效）<br>mysql&gt;quit;<br>为了使以上优化和安全设置生效，请重启Mysql服务或Linux。<br>关于Mysql的安全设置，这篇文章很值得一看<br><a href="http://www.unixren.com/linux/bencandy.php?fid=21&amp;id=459" target="_blank" rel="external">http://www.unixren.com/linux/bencandy.php?fid=21&amp;id=459</a></p>
<p>22、操作系统安全调整<br>1、 CentOS或Red Had Enterprise Linux 4 的用户要首先要打开SElinux，方法是修改/etc/selinux/config文件中的SELINUX=”” 为enforcing 。它可以保证你的系统不会非正常的崩溃。有些人认为应该关闭，我强烈不推荐，当然只是将centos用来玩玩，不是用于实际服务器则无所谓了。<br>2、启用iptables 防火墙，对增加系统安全有许多好处。设置好防火墙的规则。<br>3、执行setup 关闭那些不需要的服务 ,记住少开一个服务，就少一个危险。<br>4、禁止Control-Alt-Delete　键盘关闭命令<br>在”/etc/inittab”　文件中注释掉下面这行（使用#）：<br>ca::ctrlaltdel:/sbin/shutdown　-t3　-r　now　<br>改为：</p>
<p>#ca::ctrlaltdel:/sbin/shutdown　-t3　-r　now　<br>为了使这项改动起作用，输入下面这个命令：</p>
<p>#　/sbin/init　q<br>5、给”/etc/rc.d/init.d”　下script文件设置权限<br>给执行或关闭启动时执行的程序的script文件设置权限。</p>
<p>#　chmod　-R　700　/etc/rc.d/init.d/*　<br>这表示只有root才允许读、写、执行该目录下的script文件。<br>6、修改”/etc/host.conf”文件<br>“/etc/host.conf”说明了如何解析地址。编辑”/etc/host.conf”文件（vi　/etc/host.conf），加入下面这行：</p>
<p>#　Lookup　names　via　DNS　first　then　fall　back　to　/etc/hosts.　<br>order　bind,hosts　</p>
<p>#　We　have　machines　with　multiple　IP　addresses.　<br>multi　on　</p>
<p>#　Check　for　IP　address　spoofing.　<br>nospoof　on　<br>第一项设置首先通过DNS解析IP地址，然后通过hosts文件解析。第二项设置检测是否”/etc/hosts”文件中的主机是否拥有多个IP地址（比如有多个以太口网卡）。第三项设置说明要注意对本机未经许可的电子欺骗。<br>7、使”/etc/services”文件免疫<br>使”/etc/services”文件免疫，防止未经许可的删除或添加服务：</p>
<p>#　chattr　+i　/etc/services<br>8.阻止你的系统响应任何从外部/内部来的ping请求。<br>既然没有人能ping通你的机器并收到响应，你可以大大增强你的站点的安全性。你可以加下面的一行命令到/etc/rc.d/rc.local，以使每次启动后自动运行。<br>echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all<br>9、对你的系统上所有的用户设置资源限制可以防止DoS类型攻击（denial of service attacks）<br>如最大进程数，内存数量等。例如，对所有用户的限制象下面这样：<br>vi /etc/security/limits.conf<br>下面的代码示例中，所有用户每个会话都限制在 10 MB，并允许同时有四个登录。第三行禁用了每个人的内核转储。第四行除去了用户 bin 的所有限制。ftp 允许有 10 个并发会话（对匿名 ftp 帐号尤其实用）；managers 组的成员的进程数目限制为 40 个。developers 有 64 MB 的 memlock 限制，wwwusers 的成员不能创建大于 50 MB 的文件。<br>清单 3. 设置配额和限制</p>
<ul>
<li>hard rss 10000</li>
<li>hard maxlogins 4</li>
<li>hard core 0<br>bin -<br>ftp hard maxlogins 10<br>@managers hard nproc 40<br>@developers hard memlock 64000<br>@wwwusers hard fsize 50000<br>要激活这些限制，您需要在 /etc/pam.d/login 底部添加下面一行： session required /lib/security/pam_limits.so。<br>10、注释掉不需要的用户和用户组。<br>vipw<br>root:x:0:0:root:/root:/bin/bash<br>bin:x:1:1:bin:/bin:/sbin/nologin<br>daemon:x:2:2:daemon:/sbin:/sbin/nologin<br>adm:x:3:4:adm:/var/adm:/sbin/nologin<br>lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin<br>sync:x:5:0:sync:/sbin:/bin/sync<br>shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown<br>halt:x:7:0:halt:/sbin:/sbin/halt<br>mail:x:8:12:mail:/var/spool/mail:/sbin/nologin<br>news:x:9:13:news:/etc/news:<br>uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin<br>operator:x:11:0:operator:/root:/sbin/nologin<br>games:x:12:100:games:/usr/games:/sbin/nologin<br>gopher:x:13:30:gopher:/var/gopher:/sbin/nologin<br>ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin<br>nobody:x:99:99:Nobody:/:/sbin/nologin<br>dbus:x:81:81:System message bus:/:/sbin/nologin<br>vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin<br>rpm:x:37:37::/var/lib/rpm:/sbin/nologin<br>haldaemon:x:68:68:HAL daemon:/:/sbin/nologin<br>netdump:x:34:34:Network Crash Dump user:/var/crash:/bin/bash<br>nscd:x:28:28:NSCD Daemon:/:/sbin/nologin<br>sshd:x:74:74:Privilerpc:x:32:32:Portmapper RPC user:/:/sbin/nologin<br>rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin<br>nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin<br>mailnull:x:47:47::/var/spool/mqueue:/sbin/nologin<br>smmsp:x:51:51::/var/spool/mqueue:/sbin/nologin<br>pcap:x:77:77::/var/arpwatch:/sbin/nologin<br>xfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologin<br>ntp:x:38:38::/etc/ntp:/sbin/nologin<br>gdm:x:42:42::/var/gdm:/sbin/nologin<br>pegasus:x:66:65:tog-pegasus OpenPegasus WBEM/CIM services:/var/lib/Pegasus:/sbin/nologin<br>htt:x:100:101:IIIMF Htt:/usr/lib/im:/sbin/nologin<br>wangjing:x:500:500::/home/wangjing:/bin/bash<br>mysql:x:101:102:MySQL server:/var/lib/mysql:/bin/bash<br>apache:x:48:48:Apache:/var/www:/sbin/nologin<br>ge-separated SSH:/var/empty/sshd:/sbin/nologin<br>对于不需要的用户全部加 # 注释掉。注意，我不建议直接删除，当你某种原因需要某个用户时，自己重新会很麻烦。<br>vi /etc/group<br>root:x:0:root<br>bin:x:1:root,bin,daemon<br>daemon:x:2:root,bin,daemon<br>sys:x:3:root,bin,adm<br>adm:x:4:root,adm,daemon<br>tty:x:5:<br>disk:x:6:root<br>lp:x:7:daemon,lp<br>mem:x:8:<br>kmem:x:9:<br>wheel:x:10:root<br>mail:x:12:mail<br>news:x:13:news<br>uucp:x:14:uucp<br>man:x:15:<br>games:x:20:<br>gopher:x:30:<br>dip:x:40:<br>ftp:x:50:<br>lock:x:54:<br>nobody:x:99:<br>users:x:100:<br>dbus:x:81:<br>floppy:x:19:<br>vcsa:x:69:<br>rpm:x:37:<br>haldaemon:x:68:<br>utmp:x:22:<br>netdump:x:34:<br>nscd:x:28:<br>slocate:x:21:<br>sshd:x:74:<br>rpc:x:32:<br>rpcuser:x:29:<br>nfsnobody:x:65534:<br>mailnull:x:47:<br>smmsp:x:51:<br>pcap:x:77:<br>xfs:x:43:<br>ntp:x:38:<br>gdm:x:42:<br>pegasus:x:65:<br>htt:x:101:<br>wangjing:x:500:<br>mysql:x:102:<br>apache:x:48:<br>对于不需要的用户组全部加 # 注释掉。注意，我不建议直接删除，当你某种原因需要某个用户组时，自己重新会很麻烦。<br>11、用chattr命令给下面的文件加上不可更改属性。<h1 id="chattr-i-etc-passwd"><a href="#chattr-i-etc-passwd" class="headerlink" title="chattr +i /etc/passwd"></a>chattr +i /etc/passwd</h1><h1 id="chattr-i-etc-shadow"><a href="#chattr-i-etc-shadow" class="headerlink" title="chattr +i /etc/shadow"></a>chattr +i /etc/shadow</h1><h1 id="chattr-i-etc-group"><a href="#chattr-i-etc-group" class="headerlink" title="chattr +i /etc/group"></a>chattr +i /etc/group</h1><h1 id="chattr-i-etc-gshadow"><a href="#chattr-i-etc-gshadow" class="headerlink" title="chattr +i /etc/gshadow"></a>chattr +i /etc/gshadow</h1>注意执行这个操作后，以root身份都不能向系统增加用户或者修改密码了。如果我们要增加用户或者修改密码的。应该先用chattr -i /etc/passwd等命令解除不可写设置，再进行操作。<br>12、修改sshd的端口。<br>修改/etc/ssh/sshd_config，将里面的 Port 改为 59825，（具体的端口你随意。当然不能和其他程序的端口冲突了）。并注释掉前面的#号，然后<br>pkill sshd<br>service sshd start<br>就行了<br>注意最好在本地修改这个端口，否则容易出现把自己锁在外面的情况。修改了本处端口后，还要注意修改防火墙的ssh端口。<br>13、 内核参数调整<br>vi /etc/sysctl.conf<br>net.ipv4.conf.default.accept_source_route=0<br>net.ipv4.icmp_echo_ignore_broadcasts=1<br>#net.ipv4.icmp_echo_ignore_all=1<br>net.ipv4.icmp_ignore_bogus_error_responses=1<br>net.ipv4.ip_conntrack_max=65535<br>net.ipv4.tcp_syn_retries=1<br>net.ipv4.tcp_fin_timeout=5<br>net.ipv4.tcp_synack_retries=1<br>net.ipv4.tcp_syncookies=1<br>net.ipv4.route.gc_timeout=100<br>net.ipv4.tcp_keepalive_time=500<br>net.ipv4.tcp_max_syn_backlog=10000<h1 id="sysctl-p-查看"><a href="#sysctl-p-查看" class="headerlink" title="sysctl -p //查看"></a>sysctl -p //查看</h1>14、经常检查系统日志。系统日志主要位于/var/log/目录下。防患于未然。<br>通过以上设置你的系统一般来说就比较安全了。当然安全与不安全是道与魔的斗争。<br>经过这几个步骤，我们一个比较安全的LAMP服务器就环境基本建立成功啦。感觉上也不是很难，是吧？</li>
</ul>
<p>六、日常常用的管理功能</p>
<h1 id="cd-usr-local-src-9"><a href="#cd-usr-local-src-9" class="headerlink" title="cd /usr/local/src"></a>cd /usr/local/src</h1><h1 id="wget-ftp-ftp-ncftp-com-ncftp-ncftp-3-2-1-src-tar-gz"><a href="#wget-ftp-ftp-ncftp-com-ncftp-ncftp-3-2-1-src-tar-gz" class="headerlink" title="wget ftp://ftp.ncftp.com/ncftp/ncftp-3.2.1-src.tar.gz"></a>wget ftp://ftp.ncftp.com/ncftp/ncftp-3.2.1-src.tar.gz</h1><h1 id="tar-zxvf-ncftp-3-2-1-src-tar-gz"><a href="#tar-zxvf-ncftp-3-2-1-src-tar-gz" class="headerlink" title="tar zxvf ncftp-3.2.1-src.tar.gz"></a>tar zxvf ncftp-3.2.1-src.tar.gz</h1><h1 id="cd-ncftp-3-2-1-src"><a href="#cd-ncftp-3-2-1-src" class="headerlink" title="cd ncftp-3.2.1-src"></a>cd ncftp-3.2.1-src</h1><h1 id="configure-–prefix-usr-local-ncftp"><a href="#configure-–prefix-usr-local-ncftp" class="headerlink" title="./configure –prefix=/usr/local/ncftp"></a>./configure –prefix=/usr/local/ncftp</h1><h1 id="make-amp-amp-make-install-4"><a href="#make-amp-amp-make-install-4" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>23、mysql数据库自动备份并上传到服务器<br>服务器数据的备份<br>1、数据备份<br>为了防止意外情况的发生造成数据的丢失，关键数据或整个系统或对有选择的系统部分，在本地和异地进行定时备份，以保证系统全部或部分在灾害出现时也能持续运行。<br>2、具体方案<br>1）、数据库每日备份<br>每天4:00，将Cnprintbbs数据库拷贝至/root/back后进行压缩，然后上传至192.168.1.9服务器上，/root/back留有压缩版本。<br>运行脚本/root/scripts/back.sh<br>例子：</p>
<p>#!/bin/bash<br>rm /root/back/Cnprintbbs/* -rf<br>/usr/local/mysql/bin/mysqlhotcopy Cnprintbbs /root/back/Cnprintbbs -u root -p uefer77693<br>sleep 5<br>cd /root/back<br>tar zcf <code>hostname</code>-Cnprintbbs<code>date +%Y%m%d</code>.tar.gz Cnprintbbs<br>sleep 5<br>echo “tar ok!”<br>/usr/local/ncftp/bin/ncftpput -u gamebak -p gamebak@root 192.168.1.9 / /root/back/<code>hostname</code>-Cnprintbbs<code>date +%Y%m%d</code>.tar.gz<br>sleep 10<br>echo “upload Cnprintbbs ok!”<br>保存，并设置计划任务。</p>
<h1 id="crontab-e-1"><a href="#crontab-e-1" class="headerlink" title="crontab -e"></a>crontab -e</h1><p>增加一行：<br>00 4 <em> </em> * /root/scripts/back.sh<br>每天凌晨4点将自动备份数据库并上传。<br>2)、数据库即时备份<br>每隔1小时，将Cnprintbbs数据库拷贝至/root/back/hour目录进行备份，然后将压缩文件传给特定服务器。<br>例子：</p>
<p>#!/bin/bash<br>hottime=<code>date +%Y%m%d%H%M</code><br>mkdir /root/back/hour/Cnprintbbs”$hottime”<br>/usr/local/mysql/bin/mysqlhotcopy Cnprintbbs /root/back/hour/Cnprintbbs”$hottime” -u root -p uefer77693<br>sleep 5<br>cd /root/back/hour<br>tar zcf <code>hostname</code>-Cnprintbbs”$hottime”.tar.gz Cnprintbbs”$hottime”<br>sleep 5<br>echo “tar ok!”<br>/usr/local/ncftp/bin/ncftpput -u backupdb -p backupdb 192.168.102.119 / /root/back/hour/<code>hostname</code>-Cnprintbbs”$hottime”.tar.gz<br>sleep 20<br>echo “upload Cnprintbbs ok!”<br>rm <code>hostname</code>-Cnprintbbs”$hottime”.tar.gz -f<br>3）、日志备份<br>每天02:00，将/log/下前一天的日志，进行压缩，然后上传至192.168.9.1服务器。<br>运行脚本/root/scripts/upload_daily<br>例子：</p>
<p>#!/bin/bash<br>cd /log/<br>mkdir log<code>date --date &#39;1 days ago&#39; +%Y%m%d</code><br>mv <em>.log.<code>date --date &#39;1 days ago&#39; +%y%m%d</code>-</em> log<code>date --date &#39;1 days ago&#39; +%Y%m%d</code><br>sleep 10<br>tar zcvf <code>hostname</code>-log<code>date --date &#39;1 days ago&#39; +%Y%m%d</code>.tar.gz log<code>date --date &#39;1 days ago&#39; +%Y%m%d</code><br>/usr/local/ncftp/bin/ncftpput -u log -p log@root 218.80.198.234 / /log/<code>hostname</code>-log<code>date --date &#39;1 days ago&#39; +%Y%m%d</code>.tar.gz<br>rm <code>hostname</code>-log<code>date --date &#39;1 days ago&#39; +%Y%m%d</code>.tar.gz<br>注：计划任务通过/etc/crontab –e来进行设置<br>4）、即时日志备份<br>直接运行/home/root/tools/upload 将最新日志上传至192.168.1.9服务器,方便研发部门查看。<br>运行脚本/home/root/tools/upload，（如果所有服务器的日志都需要上传，可以运行网关服务器上的/home/root/tools/allupload）<br>24、Squid缓存删除及重启<br>1. squid使用时间长了，速度会变慢，我的建议是每2小时kill掉squid 进程，RunAccel脚本会自动再启动的它。<br>2. 写一脚本，放进crontab中，每天凌晨4点左右把cache目录清空。</p>
<p>#!/bin/sh</p>
<h1 id="squid-clean-swap-and-restart-script-by-marco-lu"><a href="#squid-clean-swap-and-restart-script-by-marco-lu" class="headerlink" title="squid clean swap and restart scrīpt by marco lu"></a>squid clean swap and restart scrīpt by marco lu</h1><p>SQUID_DIR=/usr/local/squid/<br>PID_FILE=${SQUID_DIR}var/logs/squid.pid<br>CACHE_DIR=${SQUID_DIR}var/cache<br>PPID=<code>ps aux | grep -i squid | grep -v grep|awk &#39;{print $2}&#39;</code><br>kill -9 ${PPID} &gt; /dev/null<br>kill -9 <code>cat ${PID_FILE}</code> &gt; /dev/null<br>rm -rf $CACHE_DIR/<em><br>${SQUID_DIR}sbin/squid -z &gt; /dev/null<br>if [ $? -eq 0 ]<br>then<br>${SQUID_DIR}bin/RunAccel &amp; &gt; /dev/null<br>fi<br>七、安装vBulletin 3.6.8和vBseo 3.1.0<br>vBulletin和vbseo 3.0.1都是商业软件，本地址的下载链接仅供试用，请于下载后24小时内删除，购买正版请联系相应官方。<br>25、安装vBulletin 3.6.8<br>vBulletin 是一个强大的论坛社区解决方案，使用它您可以轻易为您的网站创建论坛系统。vBulletin 基于 PHP 和 MySQL (一个高效开源的数据库引擎)。这些坚固后台技术使我们开发的产品有着不同凡响的速度和可靠的稳定性。<br>wget <a href="http://www.cnprint.org/bbs/blogs/1/attachments/14d1194582909-phpforce_vbulletin3.6.8_patch2_zhplus3.1.5_vb1234567890.zip" target="_blank" rel="external">http://www.cnprint.org/bbs/blogs/1/attachments/14d1194582909-phpforce_vbulletin3.6.8_patch2_zhplus3.1.5_vb1234567890.zip</a><br>安装教程请见：<a href="http://www.vbulletin-china.cn/docs/html?manualversion=30608602" target="_blank" rel="external">http://www.vbulletin-china.cn/docs/html?manualversion=30608602</a><br>特别提醒：请打开config.php有关memcache设置。<br>26、安装vBseo 3.1.0<br>vBSEO为vBulletin(最流行的网站论坛)搜索优化程序, 用它可很容易地为你的vBulletin网站提供强大的搜索功能。<br>下载vBseo安装程序：<br>wget <a href="http://www.cnprint.org/bbs/blogs/1/attachments/23d1195552798-vbseo.v3.1.0.for.vbulletin.3.x.php.nullified.incl.keygen-gysn.zip" target="_blank" rel="external">http://www.cnprint.org/bbs/blogs/1/attachments/23d1195552798-vbseo.v3.1.0.for.vbulletin.3.x.php.nullified.incl.keygen-gysn.zip</a><br>1、打开vBseo压缩包，解压缩，FTP以二进制方式上传upload文件夹下所有文件及目录至vbb对应目录。<br>2、Linux系统下需首先修改”vB-root/includes/config_vbseo.php” 文件属性为可写（CHMOD 666）<br>3、确认vbb控制台启动插件功能, 在插件与产品栏目–产品管理–添加/管理产品，import导入’Product’目录中的crawlability_vbseo.xml （如果中文UTF-8版个别情况下导入错误则可以把此文件用编辑软件另存为utf-8编码），产品添加完毕。<br>4、将’htaccess’目录中.htaccess 文件上传至论坛根目录，有些操作系统下.htaccess 不可见，这时可以只将htaccess.txt文件上传到vbb根目录，删除刚才上传的.htaccess文件，将刚才上传的txt文件更名为. htaccess。<br>5、在浏览器中输入http: //你的网址/你的VBB目录/vbseocp.php配置你的vbseo，输入两次你的Vbseo管理面板密码，也可以事先编辑upload includesconfig_vbseo.php文件，在define(‘VBSEO_ADMIN_PASSWORD’, ‘ABC’)中加入你想要的管理密码（就在后面的引号中间加入，比如ABC）。<br>6、vbseo管理界面下如果需要输入授权码请用附带的keygen为你的Domain算号并拷贝32位授权码即可，配置完毕后将第二步中’config_vbseo.php’ 文件属性改回只读（CHMOD 644）<br>7、开始使用你的VBSEO，第一次安装以后可以直接通过VBB后台进入Vbseo管理界面。<br>8、如果有必要，将htacess规则移到httpd.conf中。可以大大降低apache的负载。<br>NameVirtualHost </em>:80<br>&lt;VirtualHost *:80&gt;<br>ServerName www.cnprint.org<br>DocumentRoot “/usr/local/apache2/htdocs”</p>
<p>#ErrorLog logs/error_log</p>
<h1 id="CustomLog-logs-access-log-combined"><a href="#CustomLog-logs-access-log-combined" class="headerlink" title="CustomLog logs/access_log combined"></a>CustomLog logs/access_log combined</h1><p>&lt;/VirtualHost&gt;<br>&lt;Directory “/usr/local/apache2/htdocs”&gt;<br>Options Indexes FollowSymLinks<br>AllowOverride none<br>Order allow,deny<br>Allow from all<br>&lt;/Directory&gt;<br>&lt;Directory “/usr/local/apache2/htdocs/bbs”&gt;<br>Options Indexes FollowSymLinks<br>AllowOverride all<br>RewriteEngine On</p>
<p>#RewriteBase /bbs<br>RewriteCond %{HTTP_HOST} !^www.cnprint.org<br>RewriteRule (.*) <a href="http://www.cnprint.org/bbs/$1" target="_blank" rel="external">http://www.cnprint.org/bbs/$1</a> [L,R=301]</p>
<p>#RewriteRule ^((urllist|sitemap_).<em>.(xml|txt)(.gz)?)$ vbseo_sitemap/vbseo_getsitemap.php?sitemap=$1 [L]<br>RewriteCond %{QUERY_STRING} !vbseourl=<br>RewriteCond %{REQUEST_URI} !(admincp/|modcp/|chat|cron)<br>RewriteRule ^(.</em>.php)$ vbseo.php?vbseourl=$1 [L,QSA]<br>RewriteCond %{REQUEST_FILENAME} !.(jpg|gif)$<br>RewriteRule ^(archive/.*)$ vbseo.php?vbseourl=$1 [L,QSA]<br>RewriteCond %{REQUEST_FILENAME} !-f<br>RewriteCond %{REQUEST_FILENAME} !-d<br>RewriteCond %{REQUEST_FILENAME} !^(admincp|modcp|clientscript|cpstyles|images)/<br>RewriteRule ^(.+)$ vbseo.php?vbseourl=$1 [L,QSA]<br>Order allow,deny<br>Allow from all<br>&lt;/Directory&gt;</p>
<!-- attachments -->
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/10/f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/10/f/" itemprop="url">
                  自己的PHP和apache安装步骤
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-10T17:46:03+08:00">
                2008-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Apache/" itemprop="url" rel="index">
                    <span itemprop="name">Apache</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>第一步：yum安装一些需要使用的软件</p>
<h1 id="yum-upgrade"><a href="#yum-upgrade" class="headerlink" title="yum upgrade"></a>yum upgrade</h1><h1 id="yum-install-–y-ntp"><a href="#yum-install-–y-ntp" class="headerlink" title="yum install –y ntp"></a>yum install –y ntp</h1><h1 id="crontab-e"><a href="#crontab-e" class="headerlink" title="crontab -e"></a>crontab -e</h1><p>0 23 <em> </em> * /usr/sbin/ntpdate 210.72.145.44<br>以上命令设置好后存盘。</p>
<h1 id="sbin-service-crond-reload"><a href="#sbin-service-crond-reload" class="headerlink" title="/sbin/service crond reload"></a>/sbin/service crond reload
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2008/01/10/f/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/10/proftp-e4-b8-ad-e6-97-b6-e9-97-b4-e4-b8-8e-e5-8c-97-e4-ba-ac-e6-97-b6-e9-97-b4-e7-9b-b8-e5-b7-ae8-e5-b0-8f-e6-97-b6-e7-9a-84-e8-a7-a3-e5-86-b3-e5-8a-9e-e6-b3-95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/10/proftp-e4-b8-ad-e6-97-b6-e9-97-b4-e4-b8-8e-e5-8c-97-e4-ba-ac-e6-97-b6-e9-97-b4-e7-9b-b8-e5-b7-ae8-e5-b0-8f-e6-97-b6-e7-9a-84-e8-a7-a3-e5-86-b3-e5-8a-9e-e6-b3-95/" itemprop="url">
                  proftp中时间与北京时间相差8小时的解决办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-10T16:59:40+08:00">
                2008-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天在测试PROFTP的时候发现居然上传的文件的时间戳比北京时间晚了8小时，google一下才发现不只我一个，很多都出现了这个问题</p>
<p>解决方法1</p>
<p>做一个软链接<br>ln -s /usr/share/zoneinfo/Asia/Shanghai /usr/share/zoneinfo/CST</p>
<p>但我的是centos系统，好像这样改了还是没解决问题</p>
<p>方法2</p>
<p>在proftp.conf中添加</p>
<p><span style="color: red">TimesGMT  off</span></p>
<p>OK,搞定。不过我估计这种解决方法是治标不治本，因为这样FTP就不打时间戳了。有时间再仔细研究</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/10/ftp-e6-9d-83-e9-99-90-e8-ae-be-e7-bd-ae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/10/ftp-e6-9d-83-e9-99-90-e8-ae-be-e7-bd-ae/" itemprop="url">
                  ftp权限设置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-10T16:41:37+08:00">
                2008-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天狼说FTP里不能更改文件的属性，亲自试了一下，确实不能更改属性，查了一下资料，发现是由于安装的时候太匆忙了，居然连FTP的一些常用设置都没设置好。嘎嘎，赶紧动手修改。</p>
<p>增加chmod权限，被动模式以及切换目录等权限</p>
<p>AllowRetrieveRestart on<br>AllowStoreRestart on<br>UseReverseDNS off<br>    &lt;Limit CDUP CWD XCWD XCUP&gt;<br>      AllowAll<br>    &lt;/Limit&gt;</p>
<pre><code>&amp;lt;Limit STOR STOU&amp;gt;
  AllowAll
&amp;lt;/Limit&amp;gt;
</code></pre><p>&lt;Limit SITE_CHMOD&gt;</p>
<p>  #DenyAll<br>AllowAll<br>&lt;/Limit&gt;</p>
<p>OK，可以正常使用了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/01/09/centos-51-server-setup-lamp-email-dns-ftp-ispconfig-aka-the-perfect-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="九王爷">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九王爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2008/01/09/centos-51-server-setup-lamp-email-dns-ftp-ispconfig-aka-the-perfect-server/" itemprop="url">
                  CentOS 5.1 Server Setup: LAMP, Email, DNS, FTP, ISPConfig (a.k.a. The Perfect Server)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-01-09T17:28:23+08:00">
                2008-01-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Server/" itemprop="url" rel="index">
                    <span itemprop="name">Server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方网站实在是太慢了，弄到这里来加快点浏览速度</p>
<p>Version 1.0<br>Author: Falko Timme &lt;ft [at] falkotimme [dot] com&gt;<br>Last edited 12/04/2007</p>
<p>This tutorial shows how to set up a <strong>CentOS 5.1</strong> based server that offers all services needed by ISPs and web hosters: Apache web server (SSL-capable), Postfix mail server with SMTP-AUTH and TLS, BIND DNS server, Proftpd FTP server, MySQL server, Dovecot POP3/IMAP, Quota, Firewall, etc. This tutorial is written for the 32-bit version of CentOS 5.1, but should apply to the 64-bit version with very little modifications as well.</p>
<p>I will use the following software:</p>
<ul>
<li>Web Server: Apache 2.2 with PHP 5.1.6</li>
<li>Database Server: MySQL 5.0</li>
<li>Mail Server: Postfix</li>
<li>DNS Server: BIND9 (chrooted)</li>
<li>FTP Server: Proftpd</li>
<li>POP3/IMAP server: Dovecot</li>
<li>Webalizer for web site statistics<br>In the end you should have a system that works reliably, and if you like you can install the free webhosting control panel <a href="http://www.ispconfig.org/" target="_blank" rel="external">ISPConfig</a> (i.e., ISPConfig runs on it out of the box).</li>
</ul>
<p>I want to say first that this is not the only way of setting up such a system. There are many ways of achieving this goal but this is the way I take. I do not issue any guarantee that this will work for you!</p>
<h3 id="1-Requirements"><a href="#1-Requirements" class="headerlink" title="1 Requirements"></a>1 Requirements</h3><p>To install such a system you will need the following:</p>
<ul>
<li>Download the CentOS 5.1 DVD or the six CentOS 5.1 CDs from a mirror next to you (the list of mirrors can be found here: <a href="http://isoredirect.centos.org/centos/5/isos/i386/" target="_blank" rel="external">http://isoredirect.centos.org/centos/5/isos/i386/</a>).</li>
<li>a fast internet connection.</li>
</ul>
<h3 id="2-Preliminary-Note"><a href="#2-Preliminary-Note" class="headerlink" title="2 Preliminary Note"></a>2 Preliminary Note</h3><p>In this tutorial I use the hostname <span class="system">server1.example.com</span> with the IP address <span class="system">192.168.0.100</span> and the gateway <span class="system">192.168.0.1</span>. These settings might differ for you, so you have to replace them where appropriate.</p>
<h3 id="3-Install-The-Base-System"><a href="#3-Install-The-Base-System" class="headerlink" title="3 Install The Base System"></a>3 Install The Base System</h3><p>Boot from your first CentOS 5.1 CD (CD 1) or the CentOS 5.1 DVD. Press <span class="system">&lt;ENTER&gt;</span> at the boot prompt:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/1.png" target="_blank" rel="external"><img src="http://www.howtoforge.com/images/click_to_enlarge.png" alt="Click to enlarge"></a></p>
<p><noscript style="font-size: 7pt"></noscript>It can take a long time to test the installation media so we skip this test here:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/2.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>The welcome screen of the CentOS installer appears. Click on <span class="system">Next</span>:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/3.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Choose your language next:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/4.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Select your keyboard layout:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/5.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>I’m installing CentOS 5.1 on a fresh system, so I answer <span class="system">Yes</span> to the question <span class="system">Would you like to initialize this drive, erasing ALL DATA?</span></p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/6.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Now we must select a partitioning scheme for our installation. For simplicity’s sake I select <span class="system">Remove linux partitions on selected drives and create default layout</span>. This will result in a small <span class="system">/boot</span> and a large <span class="system">/</span> partition as well as a swap partition. Of course, you’re free to partition your hard drive however you like it. Then I hit <span class="system">Next</span>:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/7.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Answer the following question (<span class="system">Are you sure you want to do this?</span>) with <span class="system">Yes</span>:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/8.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>On to the network settings. The default setting here is to configure the network interfaces with <span class="system">DHCP</span>, but we are installing a server, so static IP addresses are not a bad idea… Click on the <span class="system">Edit </span>button at the top right.</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/9.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>In the window that pops up uncheck <span class="system">Use dynamic IP configuration (DHCP)</span> and <span class="system">Enable IPv6 support </span>and give your network card a static IP address (in this tutorial I’m using the IP address <span class="system">192.168.0.100 </span>for demonstration purposes) and a suitable netmask (e.g. <span class="system">255.255.255.0</span>; if you are not sure about the right values, <a href="http://www.subnetmask.info/" target="_blank" rel="external">http://www.subnetmask.info</a> might help you):</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/10.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Set the hostname manually, e.g. <span class="system">server1.example.com</span>, and enter a gateway (e.g. <span class="system">192.168.0.1</span>) and up to two DNS servers (e.g. <span class="system">145.253.2.75</span> and <span class="system">193.174.32.18</span>):</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/11.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Choose your time zone:</p>
<p><a href="http://www.howtoforge.com/images/perfect_server_centos_5.1/big/12.png" target="_blank" rel="external"></a></p>
<p><noscript style="font-size: 7pt"></noscript>Give <span class="system">root </span>a password:</p>
<p>Now we select the software we want to install. Select nothing but <span class="system">Server</span> (uncheck everything else). Also don’t check <span class="system">Packages from CentOS Extras</span>. Then check <span class="system">Customize now</span>, and click on <span class="system">Next</span>:</p>
<p>Now we must select the package groups we want to install. Select <span class="system">Editors</span>, <span class="system">Text-based Internet</span>, <span class="system">Development Libraries</span>, <span class="system">Development Tools</span>, <span class="system">DNS Name Server</span>, <span class="system">FTP Server</span>, <span class="system">Mail Server</span>, <span class="system">MySQL Database</span>, <span class="system">Server Configuration Tools</span>, <span class="system">Web Server</span>, <span class="system">Administration Tools</span>, <span class="system">Base,</span> and <span class="system">System Tools</span> (unselect all other package groups) and click on <span class="system">Next</span>:</p>
<p><script type="text/javascript">      &lt;!–  document.write(\’</p>
<p><div align="center">\’);  //–&gt;</script> The installer checks the dependencies of the selected packages:</p>
<p>Click on <span class="system">Next</span> to start the installation:</p>
<p>The hard drive is being formatted:</p>
<p>The installation begins. This will take a few minutes:</p>
<p>Finally, the installation is complete, and you can remove your CD or DVD from the computer and reboot it:</p>
<p>After the reboot, you will see this screen. Select <span class="system">Firewall configuration</span> and hit <span class="system">Run Tool</span>:</p>
<p>I want to install ISPConfig at the end of this tutorial which comes with its own firewall. That’s why I disable the default CentOS firewall now. Of course, you are free to leave it on and configure it to your needs (but then you shouldn’t use any other firewall later on as it will most probably interfere with the CentOS firewall).</p>
<p>SELinux is a security extension of CentOS that should provide extended security. In my opinion you don’t need it to configure a secure system, and it usually causes more problems than advantages (think of it after you have done a week of trouble-shooting because some service wasn’t working as expected, and then you find out that everything was ok, only SELinux was causing the problem). Therefore I disable it, too (this is a must if you want to install ISPConfig later on). Hit <span class="system">OK</span> afterwards:</p>
<p>Then leave the <span class="system">Setup Agent</span> by selecting <span class="system">Exit</span>:</p>
<p>Then log in as root and reboot the system so that your changes can be applied:</p>
<p>shutdown -r now</p>
<p>Now, on to the configuration…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="九王爷" />
          <p class="site-author-name" itemprop="name">九王爷</p>
           
              <p class="site-description motion-element" itemprop="description">这里是外宅，备份用的</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">269</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">九王爷</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
